[
    {
        "id": "af6617e3.50aa38",
        "type": "tab",
        "label": "Login API "
    },
    {
        "id": "e49ea6ba.2c95f8",
        "type": "tab",
        "label": "Generic Save"
    },
    {
        "id": "84d8e4c3.e48e3",
        "type": "tab",
        "label": "Generic Get"
    },
    {
        "id": "49d0aa55.a20f54",
        "type": "tab",
        "label": "Test"
    },
    {
        "id": "26c98005.8e65c",
        "type": "tab",
        "label": "demo"
    },
    {
        "id": "4ee2e89.d849098",
        "type": "subflow",
        "name": "F to C",
        "info": "",
        "in": [
            {
                "x": 44,
                "y": 63,
                "wires": [
                    {
                        "id": "3f422cff.a7875c"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 309,
                "y": 57,
                "wires": [
                    {
                        "id": "3f422cff.a7875c",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "649e959.6a7e56c",
        "type": "subflow",
        "name": "dimmer to switch",
        "info": "",
        "in": [
            {
                "x": 25,
                "y": 86,
                "wires": [
                    {
                        "id": "5fe5154b.ac4a5c"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 437,
                "y": 83,
                "wires": [
                    {
                        "id": "5fe5154b.ac4a5c",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "6792e2c8.89f8d4",
        "type": "subflow",
        "name": "currState to payload",
        "info": "",
        "in": [
            {
                "x": 139,
                "y": 133,
                "wires": [
                    {
                        "id": "a1a35048.33e2f8"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 448,
                "y": 131,
                "wires": [
                    {
                        "id": "a1a35048.33e2f8",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "4e5ed81f.ae199",
        "type": "twilio-api",
        "z": "af6617e3.50aa38",
        "sid": "AC909f1981261f4461abbc7985bd202897",
        "from": "12312259665 ",
        "name": "DoMeNowApp Twilio Service"
    },
    {
        "id": "3f422cff.a7875c",
        "type": "function",
        "z": "4ee2e89.d849098",
        "name": "F to C",
        "func": "msg.payload = (Math.round((msg.payload - 32) * 50 / 9)/10)\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 158,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "5fe5154b.ac4a5c",
        "type": "function",
        "z": "649e959.6a7e56c",
        "name": "Dimmer value to switch",
        "func": "if(msg.payload === 0) {\n    msg.payload = false;\n}\nelse {\n    msg.payload = true;\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 220,
        "y": 85,
        "wires": [
            []
        ]
    },
    {
        "id": "a1a35048.33e2f8",
        "type": "function",
        "z": "6792e2c8.89f8d4",
        "name": "currState to payload",
        "func": "msg.payload = JSON.parse(msg.payload)\nvar msg2 = {}\nmsg2.payload = msg.payload.currState;\nreturn msg2;\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "x": 289,
        "y": 132,
        "wires": [
            []
        ]
    },
    {
        "id": "d7cb8afc.eacc3",
        "type": "function",
        "z": "af6617e3.50aa38",
        "name": "phone",
        "func": "msg.payload = {\n    query: \"table:users AND virtual_phone:\" + msg.user_data.phone\n};\n\nnode.warn(msg.payload);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 490,
        "y": 180,
        "wires": [
            [
                "d49b343d.4ad9b"
            ]
        ]
    },
    {
        "id": "6069f984.4c20a",
        "type": "debug",
        "z": "af6617e3.50aa38",
        "name": "Going to save user if not found in db",
        "active": true,
        "console": "false",
        "complete": "payload",
        "x": 760.0000381469727,
        "y": 287.000018119812,
        "wires": []
    },
    {
        "id": "5fe1c16.5cdf44",
        "type": "function",
        "z": "af6617e3.50aa38",
        "name": "Merge data for update",
        "func": "var db_data = msg.db_output, user_data = msg.user_data, payload = {};\n\nmsg.verification_code = rand();\nmsg.access_token = token();\n\n\nif(isEmpty(db_data)) {\n    payload = {\n        table       : \"users\",\n        access_token:  msg.access_token,\n        phone       :  parseInt(user_data.phone),\n        virtual_phone: parseInt(user_data.phone),\n        security_level: 0,\n        code:         msg.verification_code,\n        type: {\n            \"public\": \"public\"\n        },\n        device_id: \"\",\n        push_accepted: 0\n    };\n}\nelse {\n    payload ={\n      _id               : db_data[0]._id,\n      _rev              : db_data[0]._rev,\n      table             : \"users\",\n      long_url          : db_data[0].long_url || \"\",\n      access_token      : msg.access_token,\n      security_level    : db_data[0].security_level ,\n      phone             : db_data[0].phone || parseInt(user_data.phone) ,\n      virtual_phone     : db_data[0].virtual_phone || parseInt(user_data.phone),\n      email             : db_data[0].email || \"\",\n      converstation_id  : db_data[0].converstation_id || \"\",\n      firstname         : db_data[0].firstname || \"\",\n      lastname          : db_data[0].lastname || \"\",\n      code              : msg.verification_code,\n      password          : db_data[0].password || \"\",\n      image             : db_data[0].image || \"\",\n      type              : db_data[0].type ,\n      device_id         : db_data[0].device_id,\n      push_accepted     : db_data[0].push_accepted\n    };\n}\n\nmsg.security_level = payload.security_level ;\nmsg.payload = payload;\n\nreturn msg;\n\nfunction rand() {\n    return Math.floor(1000 + Math.random() * 9000);\n}\n\nfunction token() {\n    return new Date().getTime() + \".\" +Math.random().toString(36).substr(2) ;\n}\n\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}\n",
        "outputs": 1,
        "noerr": 0,
        "x": 180,
        "y": 320,
        "wires": [
            [
                "fafd7a63.6e9",
                "f9a8744d.6d2528",
                "a6c6e916.aae368"
            ]
        ]
    },
    {
        "id": "e2bcfba9.72a66",
        "type": "http in",
        "z": "af6617e3.50aa38",
        "name": "",
        "url": "/api/login",
        "method": "get",
        "swaggerDoc": "",
        "x": 110,
        "y": 180,
        "wires": [
            [
                "e46b79fc.56d3a",
                "e0350137.dc90a"
            ]
        ]
    },
    {
        "id": "e46b79fc.56d3a",
        "type": "change",
        "z": "af6617e3.50aa38",
        "name": "Move to user_data",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "user_data",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 310,
        "y": 180,
        "wires": [
            [
                "d7cb8afc.eacc3"
            ]
        ]
    },
    {
        "id": "d49b343d.4ad9b",
        "type": "cloudant in",
        "z": "af6617e3.50aa38",
        "name": "get user by phone",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 668.9999694824219,
        "y": 178.99999237060547,
        "wires": [
            [
                "ed2cd55f.867fb8"
            ]
        ]
    },
    {
        "id": "ed2cd55f.867fb8",
        "type": "change",
        "z": "af6617e3.50aa38",
        "name": "Move to db_output",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "db_output",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 950,
        "y": 180,
        "wires": [
            [
                "5fe1c16.5cdf44"
            ]
        ]
    },
    {
        "id": "f9a8744d.6d2528",
        "type": "cloudant out",
        "z": "af6617e3.50aa38",
        "name": "save user to db",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "payonly": true,
        "operation": "insert",
        "x": 420,
        "y": 340,
        "wires": []
    },
    {
        "id": "3a1dafc2.8399e8",
        "type": "http in",
        "z": "af6617e3.50aa38",
        "name": "",
        "url": "/api/verify",
        "method": "get",
        "swaggerDoc": "",
        "x": 102,
        "y": 763,
        "wires": [
            [
                "a686f087.32f17",
                "62f8c1d6.ad07c"
            ]
        ]
    },
    {
        "id": "a686f087.32f17",
        "type": "change",
        "z": "af6617e3.50aa38",
        "name": "Move to request_data",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "request_data",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 327,
        "y": 764,
        "wires": [
            [
                "572786df.fc17f"
            ]
        ]
    },
    {
        "id": "572786df.fc17f",
        "type": "function",
        "z": "af6617e3.50aa38",
        "name": "2. access_token",
        "func": "if(isEmpty(msg.request_data.access_token)){\n    msg.api_status = \"API_ERROR\";\n    msg.statusCode = 400 ;\n    msg.payload    = {status: 400, error: true, msg: \"`access_token` is required to fullfil request\", data: null};\n}else if(isEmpty(msg.request_data.code)){\n    msg.api_status = \"API_ERROR\";\n    msg.statusCode = 400 ;\n    msg.payload    = {status: 400, error: true, msg: \"`code` is required to fullfil request\", data: null};\n}\n// }else if(isEmpty(msg.request_data.device_id)){\n//     msg.api_status = \"API_ERROR\";\n//     msg.payload    = {status: 400, error: true, msg: \"`device_id` is required to fullfil request\", data: null};\n// }else if(isEmpty(msg.request_data.push_accepted)){\n//     msg.api_status = \"API_ERROR\";\n//     msg.payload    = {status: 400, error: true, msg: \"`push_accepted` is required to fullfil request\", data: null};\n// }\nelse{\n    msg.api_status = \"API_SUCCESS\";\n    msg.access_token = msg.request_data.access_token; \n    msg.payload = {\n        query: \"table: users AND access_token:\"+ msg.request_data.access_token\n    };    \n}\nreturn msg;\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 527,
        "y": 764,
        "wires": [
            [
                "ca78d31a.4ecc58"
            ]
        ]
    },
    {
        "id": "fafd7a63.6e9",
        "type": "switch",
        "z": "af6617e3.50aa38",
        "name": "security_level",
        "property": "security_level",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 420,
        "y": 400,
        "wires": [
            [
                "b7ed909e.e3f52"
            ],
            [
                "9574ab75.cfca18"
            ]
        ]
    },
    {
        "id": "9574ab75.cfca18",
        "type": "function",
        "z": "af6617e3.50aa38",
        "name": "2. return menu page",
        "func": "//node.warn(\"comes in this case.....\");\nvar response = {\n    \"page_id\":      2,\n    \"access_token\": msg.access_token\n};\nmsg.payload = response;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 673,
        "y": 442,
        "wires": [
            [
                "8db04ca3.f31fd8",
                "fe9697e6.d86228"
            ]
        ]
    },
    {
        "id": "8db04ca3.f31fd8",
        "type": "http response",
        "z": "af6617e3.50aa38",
        "name": "API Result",
        "x": 933,
        "y": 480,
        "wires": []
    },
    {
        "id": "7594a021.c3e068",
        "type": "cloudant in",
        "z": "af6617e3.50aa38",
        "name": "get user by token",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 908.9999694824219,
        "y": 802.0000305175781,
        "wires": [
            [
                "bc27d81e.67155"
            ]
        ]
    },
    {
        "id": "bc27d81e.67155",
        "type": "change",
        "z": "af6617e3.50aa38",
        "name": "Move to db_user",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "db_user",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 209,
        "y": 844,
        "wires": [
            [
                "59d10cda.473b74"
            ]
        ]
    },
    {
        "id": "59d10cda.473b74",
        "type": "function",
        "z": "af6617e3.50aa38",
        "name": "check verify code",
        "func": "var db_data = msg.db_user, request_data = msg.request_data;\nvar response = {};\n\nfunction check_obj(obj){\n    if(obj === null || obj === undefined){\n        return 0;\n    }else{\n        return Object.keys(obj).length;\n    }\n}\n\nif(check_obj(db_data) > 0) {\n    var db_code = db_data[0].code;\n    //db_code = \"1234\";\n    if(String(db_data[0].virtual_phone).length == 4){\n        if(request_data.code == 1234){\n            response.status = \"success\";\n        }else{\n            response.status = \"fail\";\n            response.msg = \"Invalid Code\";\n        } \n    }else if(String(db_data[0].virtual_phone).length > 7 &&  String(db_data[0].virtual_phone).length <= 12){\n        if(parseInt(request_data.code) == db_code){\n            response.status = \"success\";\n        }else{\n            response.status = \"fail\";\n            response.msg = \"Invalid Code\";\n        } \n    }else{\n        if(request_data.code == db_code){\n            response.status = \"success\";\n        }else{\n            response.status = \"fail\";\n            response.msg = \"Invalid Code\";\n        }    \n    }\n}\nelse{\n    response.status = \"fail\";\n    response.msg = \"Invalid Token\";\n}\n\nmsg.payload = response;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 469,
        "y": 844,
        "wires": [
            [
                "c7732d00.f11668"
            ]
        ]
    },
    {
        "id": "aeb52998.2dfa38",
        "type": "http response",
        "z": "af6617e3.50aa38",
        "name": "API Result",
        "x": 989,
        "y": 1004,
        "wires": []
    },
    {
        "id": "c7732d00.f11668",
        "type": "switch",
        "z": "af6617e3.50aa38",
        "name": "Status",
        "property": "payload.status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "success",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "fail",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 249,
        "y": 924,
        "wires": [
            [
                "d9ec42b6.aac03"
            ],
            [
                "a12606e4.792cf8"
            ]
        ]
    },
    {
        "id": "eacd6c40.764dc8",
        "type": "function",
        "z": "af6617e3.50aa38",
        "name": "2. return menu page",
        "func": "var response = {\n    \"page_id\":  2,\n    \"user_id\":  msg.payload._id,\n    \"status\":   \"valid\"\n};\nmsg.payload = response;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 759,
        "y": 944,
        "wires": [
            [
                "aeb52998.2dfa38",
                "4e71a5c9.e274ec"
            ]
        ]
    },
    {
        "id": "a39dd0c9.3c077",
        "type": "cloudant out",
        "z": "af6617e3.50aa38",
        "name": "update security level",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "payonly": true,
        "operation": "insert",
        "x": 779,
        "y": 884,
        "wires": []
    },
    {
        "id": "d9ec42b6.aac03",
        "type": "function",
        "z": "af6617e3.50aa38",
        "name": "Merge data for update",
        "func": "var db_data = msg.db_user[0] ,\n    body    = msg.request_data ;\n\ndb_data.security_level = 1 ;\ndb_data.device_id = body.device_id || \"\";\ndb_data.push_accepted = parseInt(body.push_accepted) || 1 ;\n\nmsg.payload = db_data;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 479,
        "y": 924,
        "wires": [
            [
                "eacd6c40.764dc8",
                "a39dd0c9.3c077"
            ]
        ]
    },
    {
        "id": "a12606e4.792cf8",
        "type": "function",
        "z": "af6617e3.50aa38",
        "name": "1. return login page",
        "func": "var payload = {\n    \"page_id\":  1,\n    \"status\":   \"invalid\"\n};\nmsg.payload = payload;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 479,
        "y": 1004,
        "wires": [
            [
                "aeb52998.2dfa38",
                "d69c3893.3b6158"
            ]
        ]
    },
    {
        "id": "2c1f03b3.2b7ffc",
        "type": "debug",
        "z": "af6617e3.50aa38",
        "name": "API Login ",
        "active": true,
        "console": "false",
        "complete": "true",
        "x": 565.0000915527344,
        "y": 136.000018119812,
        "wires": []
    },
    {
        "id": "fe3ef29d.c82998",
        "type": "debug",
        "z": "af6617e3.50aa38",
        "name": "Verify screeen",
        "active": true,
        "console": "false",
        "complete": "true",
        "x": 588.0000305175781,
        "y": 680.000075340271,
        "wires": []
    },
    {
        "id": "f8ecc878.bc0618",
        "type": "debug",
        "z": "af6617e3.50aa38",
        "name": "menu page",
        "active": true,
        "console": "false",
        "complete": "payload",
        "x": 1191.0000381469727,
        "y": 472.0000433921814,
        "wires": []
    },
    {
        "id": "b7ed909e.e3f52",
        "type": "function",
        "z": "af6617e3.50aa38",
        "name": "11. return verify page & ac",
        "func": "var req_body = msg.user_data ;\nif(msg.user_data.phone){\n  \n    if(String(msg.user_data.phone).length === 4){\n        msg.sendverification = \"no_need_to_send\";\n        msg.api_response = {\n            \"page_id\":      11,\n            \"access_token\": msg.access_token,\n            \"code\" : msg.verification_code\n        };\n    }else{\n        if(String(msg.user_data.phone).length >= 7 && String(msg.user_data.phone).length <= 12){\n            msg.sendverification = \"need_to_send_verification\" ;\n            msg.api_response = {\n                \"page_id\":      11,\n                \"access_token\": msg.access_token,\n                \"code\" : msg.verification_code\n            };    \n        }else{\n            msg.sendverification = \"no_need_to_send\" ;\n            msg.api_response = {\n                \"page_id\":      1,\n                \"access_token\": msg.access_token,\n                \"code\" : msg.verification_code,\n                \"msg\"  : \"Invalid phone number\"\n            };\n        }\n    }\n}else{\n    msg.sendverification = \"no_need_to_send\" ;\n    msg.api_response = {\n                \"page_id\":      1,\n                \"access_token\": msg.access_token,\n                \"code\" : msg.verification_code,\n                \"msg\"  : \"Invalid phone number\"\n            };\n}\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 675.88671875,
        "y": 343.48828125,
        "wires": [
            [
                "101bef1a.fa29f1"
            ]
        ]
    },
    {
        "id": "101bef1a.fa29f1",
        "type": "switch",
        "z": "af6617e3.50aa38",
        "name": "",
        "property": "sendverification",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "need_to_send_verification",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 937.515625,
        "y": 361.25,
        "wires": [
            [
                "26695563.bff2fa"
            ],
            [
                "b8f6b0db.8e34e8"
            ]
        ]
    },
    {
        "id": "26695563.bff2fa",
        "type": "function",
        "z": "af6617e3.50aa38",
        "name": "send sms code",
        "func": "var user_data = msg.user_data;\nvar code = msg.verification_code || 1234;\nmsg.topic = user_data.phone || 12145644732;\nmsg.payload = \"Your verification code for DRI.lists is: \" + code;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1120.515625,
        "y": 313,
        "wires": [
            [
                "8c3678bd.dc44b",
                "8a22d44d.1a0708",
                "a8e74667.379d28"
            ]
        ]
    },
    {
        "id": "8c3678bd.dc44b",
        "type": "twilio out",
        "z": "af6617e3.50aa38",
        "service": "_ext_",
        "twilio": "4e5ed81f.ae199",
        "from": "+12317146495",
        "number": "",
        "name": "SMS verify Code",
        "x": 1389.515625,
        "y": 292,
        "wires": []
    },
    {
        "id": "b545c0d0.cebe58",
        "type": "debug",
        "z": "af6617e3.50aa38",
        "name": "Responded via Twilio",
        "active": true,
        "console": "false",
        "complete": "true",
        "x": 1695.5156555175781,
        "y": 332.0000419616699,
        "wires": []
    },
    {
        "id": "c8a1b1ee.17e2d8",
        "type": "http response",
        "z": "af6617e3.50aa38",
        "name": "API Result",
        "x": 1535.5156517028809,
        "y": 238.24999904632568,
        "wires": []
    },
    {
        "id": "8a22d44d.1a0708",
        "type": "change",
        "z": "af6617e3.50aa38",
        "name": "change",
        "rules": [
            {
                "t": "move",
                "p": "api_response",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1357.3828392028809,
        "y": 238.16796779632568,
        "wires": [
            [
                "c8a1b1ee.17e2d8"
            ]
        ]
    },
    {
        "id": "b8f6b0db.8e34e8",
        "type": "change",
        "z": "af6617e3.50aa38",
        "name": "change",
        "rules": [
            {
                "t": "move",
                "p": "api_response",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1099.640625,
        "y": 370.1640625,
        "wires": [
            [
                "8934c7d9.f835",
                "bf2647f3.c91ff8"
            ]
        ]
    },
    {
        "id": "8934c7d9.f835",
        "type": "http response",
        "z": "af6617e3.50aa38",
        "name": "Api result",
        "x": 1371.62499076128,
        "y": 387.15234177559614,
        "wires": []
    },
    {
        "id": "6ddfebdd.0b9ac4",
        "type": "debug",
        "z": "af6617e3.50aa38",
        "name": "api_response ",
        "active": true,
        "console": "false",
        "complete": "payload",
        "x": 1685.0000305175781,
        "y": 425.0000066757202,
        "wires": []
    },
    {
        "id": "b881eb6f.f0ff5",
        "type": "http in",
        "z": "e49ea6ba.2c95f8",
        "name": "API HANDLER",
        "url": "/master_api_handler",
        "method": "post",
        "swaggerDoc": "",
        "x": 219,
        "y": 291,
        "wires": [
            [
                "6b3a8e04.2867f",
                "fa80cf16.25c888"
            ]
        ]
    },
    {
        "id": "6b3a8e04.2867f",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "Handler",
        "func": "var req = msg.payload;\nif(isEmpty(req)){\n    msg.api_response = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, msg: \"req body must be specified.\", data: null};\n}else{\n    msg.api_response = \"API_SUCCESS\";\n    msg.req_body = msg.payload;\n}\n\nreturn msg;\n\nfunction isEmpty(obj){\n    if(typeof obj === \"object\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 411,
        "y": 291,
        "wires": [
            [
                "1c5fe8b4.c62507"
            ]
        ]
    },
    {
        "id": "1c5fe8b4.c62507",
        "type": "switch",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "property": "api_response",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_ERROR",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 574,
        "y": 291,
        "wires": [
            [
                "a51fc6df.615ba8"
            ],
            [
                "64b05df3.e796c4"
            ]
        ]
    },
    {
        "id": "a51fc6df.615ba8",
        "type": "http response",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "x": 716,
        "y": 253,
        "wires": []
    },
    {
        "id": "64b05df3.e796c4",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "validate body",
        "func": "var body = msg.payload;\nnode.warn(body);\nif(isEmpty(body.table)){\n    msg.api_response = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, msg: \"`table` parameter must be set to save record\", data: null};\n}else if(isEmpty(body.table_data)){\n    msg.api_response = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, msg: \"`table_data` parameter must be set to save record\", data: null};    \n}else{\n    msg.api_response = \"API_SUCCESS\";\n    msg.payload_table = body.table ;\n    msg.payload_data  = body.table_data ;\n    msg.access_token  = body.access_token ;\n}\n\nreturn msg;\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 735,
        "y": 309,
        "wires": [
            [
                "30298bc4.1dcb94"
            ]
        ]
    },
    {
        "id": "30298bc4.1dcb94",
        "type": "switch",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "property": "api_response",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_ERROR",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 908,
        "y": 309,
        "wires": [
            [
                "32fc7240.255c66"
            ],
            [
                "64655570.a3fd5c"
            ]
        ]
    },
    {
        "id": "32fc7240.255c66",
        "type": "http response",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "x": 1056,
        "y": 265,
        "wires": []
    },
    {
        "id": "64655570.a3fd5c",
        "type": "switch",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "property": "payload_table",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "users",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "template",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "task_table",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "timeout",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "location",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "add_detail",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "delete_detail",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "update_task",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "update_user",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "update_short_detail",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 11,
        "x": 1069,
        "y": 566,
        "wires": [
            [
                "50476ceb.db9554"
            ],
            [
                "95317b97.74af68"
            ],
            [
                "187eedad.b0a102"
            ],
            [
                "a8eb038a.606ff8"
            ],
            [
                "aa52fef5.025338"
            ],
            [
                "b0a78c0.57441f8"
            ],
            [
                "ab53b3a6.85b95"
            ],
            [
                "7b07167e.c074f8"
            ],
            [
                "c7dad7ff.16c6a8"
            ],
            [
                "48e7d63a.0774d8"
            ],
            [
                "dbd9fefc.aeb8b8"
            ]
        ]
    },
    {
        "id": "50476ceb.db9554",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "User Table",
        "func": "var body = msg.req_body ;\nmsg.payload = {\n    table               : body.table,\n    long_url            : null,\n    access_token        : access_token(),\n    security_level      : body.security_level || 0,\n    virtual_phone       : body.phone,\n    email               : body.email,\n    converstation_id    : null,\n    firstname           : body.firstname,\n    lastname            : body.firstname,\n    code                : 1234,\n    password            : body.password,\n    image               : body.image || \"https://upload.wikimedia.org/wikipedia/commons/2/26/512pxIcon-sunset_photo_not_found.png\"\n};\nmsg.response = {status: 200, error: false, msg: \"Record created successfully\", data: msg.payload};\nreturn msg;\n\nfunction rand() {\n    return Math.random().toString(36).substr(2); // remove `0.`\n}\n\nfunction time() {\n    //return new Date().getTime().toString(36);\n    return new Date().getTime();\n}\n\nfunction access_token() {\n    return time()+'.'+rand(); // to make it longer\n}",
        "outputs": 1,
        "noerr": 0,
        "x": 1298,
        "y": 84,
        "wires": [
            [
                "d25fc310.1c6ac",
                "d5b35fc1.f4f95"
            ]
        ]
    },
    {
        "id": "95317b97.74af68",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "Template Table",
        "func": "var body = msg.req_body ;\nmsg.payload = {\n    _id         : body.table_data._id,\n    table       : body.table,\n    name        : body.table_data.name || \"\",\n    html        : body.table_data.html || \"\",\n    js          : body.table_data.js   || \"\"\n};\nmsg.response = {status: 200, error: false, msg: \"Record created successfully\", data: msg.payload};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1307,
        "y": 167,
        "wires": [
            [
                "d5b35fc1.f4f95",
                "d25fc310.1c6ac"
            ]
        ]
    },
    {
        "id": "187eedad.b0a102",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "Task Table",
        "func": "var body        = msg.req_body.table_data,\n    table_name  = msg.req_body.table,\n    page_id     = generate_page_id();\n\nmsg.payload = {\n    _id                     : body._id,\n    table                   : table_name, \n    task_name               : body.name || \"\", \n    page_id                 : page_id, \n    from_page_id            : page_id,\n    parent_id               : page_id, \n    user_id                 : body.user_id || \"\",\n    header_template_id      : body.header_template_id || \"\",\n    detail_template_id      : body.details_template_id || \"\",\n    footer_template_id      : body.footer_template_id || \"\",\n    timeout_id              : body.timeout_id || \"\",\n    location_id             : body.location_id || \"\",\n    child_default_task_id   : body.child_default_task_id || \"\",\n    child_default_task_name : body.child_default_task_name || \"\",\n    date_created            : body.date_created || new Date().toJSON(),\n    status                  : body.status || 0,\n    category                : body.category || \"\",\n    additional_data_fn      : body.additional_data_fn || \"\",\n    optional_data           : body.optional_data || {},\n    required_data           : body.required_data || {},\n    offline_expiration_time : body.offline_expiration_time || 0,\n    display_if_empty        : body.display_if_empty || 1 ,\n    type                    : {\n        public              : body.type  || \"public\"\n    },\n    image                   : body.image || \"https://upload.wikimedia.org/wikipedia/commons/2/26/512pxIcon-sunset_photo_not_found.png\",\n    count_status\t: {\n\t   active       : 1,\n\t   unread       : 0,\n\t},\n\tcount\t\t\t: {\n\t    active      : 1,\n\t    unread      : 0,\n\t},\n\tcount_if\t\t: {\n\t    active      : 1,\n\t    unread      : 0\n\t},\n    defaults                : {\n        parent              : null,\n        next_child          : null,\n        all_children        : null,\n        user                : body.user_id\n    }\n    \n};\nmsg.response = {status: 200, error: false, msg: \"Record created successfully\", data: msg.payload};\nreturn msg;\n\nfunction generate_page_id() {\n    return new Date().getTime();\n}",
        "outputs": 1,
        "noerr": 0,
        "x": 1299,
        "y": 254,
        "wires": [
            [
                "d25fc310.1c6ac",
                "d5b35fc1.f4f95"
            ]
        ]
    },
    {
        "id": "a8eb038a.606ff8",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "Timeout Table",
        "func": "var body        = msg.req_body ,\n    table_name  = msg.req_body.table;\nmsg.payload = {\n    table: table_name,\n    name: msg.timeout_data.name || \"\",\n    timeout_list: create_delivery_obj(body) \n};\nmsg.response = {status: 200, error: false, msg: \"Record created successfully\", data: msg.payload};\nreturn msg;\n\nfunction create_delivery_obj(body){\n    var obj = {};\n    var user_id = body.delivery_user_ids ? body.delivery_user_ids.split(',') : \"\";\n    \n    for(var i=0; i < body.delivery_count; i++){\n        obj[i] = {\n            delivery_count      : i , \n            delivery_status     :   body.delivery_status || 0, \n            delivery_due        :   body.delivery_due || new Date.toJSON(),\n            delivery_user_ids   :   user_id[i] ? user_id[i] : body.delivery_user_ids,\n            delivery_via        :   body.delivery_via || \"\",\n            delivery_task_id    :   body.delivery_task_id || \"\",\n            delivery_task_name  :   body.delivery_task_name || \"\", \n            message_id          :   body.message_id || \"\",\n            from_user_id        :   body.from_user_id || \"\"\n        };\n    }\n    return obj ;\n}",
        "outputs": 1,
        "noerr": 0,
        "x": 1312,
        "y": 343,
        "wires": [
            [
                "d25fc310.1c6ac",
                "d5b35fc1.f4f95"
            ]
        ]
    },
    {
        "id": "aa52fef5.025338",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "Location Table",
        "func": "var body = msg.req_body ;\nmsg.payload = {\n    table         : body.table,\n    location_name : body.name,\n    location_type : body.type,\n    location_data : {\n        lat : body.lat ? Number(body.lat) : 0,\n        lon : body.lon ? Number(body.lon) : 0,\n        dist: body.dist ? Number(body.dist) : 0,\n        web: body.web || \"\"\n    }\n};\nmsg.response = {status: 200, error: false, msg: \"Record created successfully\", data: msg.payload};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1311,
        "y": 443,
        "wires": [
            [
                "d25fc310.1c6ac",
                "d5b35fc1.f4f95"
            ]
        ]
    },
    {
        "id": "b0a78c0.57441f8",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "Create Detail",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1298,
        "y": 545,
        "wires": [
            [
                "a1c530fa.97043"
            ]
        ]
    },
    {
        "id": "dbd9fefc.aeb8b8",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "UnExpacted Case",
        "func": "msg.payload = {status: 400, error: true, msg: \"`table` field value is unexpacted.\", data: null};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1315.0000305175781,
        "y": 1095.0000610351562,
        "wires": [
            [
                "3180762f.00baca"
            ]
        ]
    },
    {
        "id": "3180762f.00baca",
        "type": "http response",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "x": 1503.0000305175781,
        "y": 1108.0000610351562,
        "wires": []
    },
    {
        "id": "d25fc310.1c6ac",
        "type": "cloudant out",
        "z": "e49ea6ba.2c95f8",
        "name": "Master Table",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "payonly": true,
        "operation": "insert",
        "x": 1757,
        "y": 209.99999523162842,
        "wires": []
    },
    {
        "id": "fa80cf16.25c888",
        "type": "debug",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "false",
        "x": 420,
        "y": 219,
        "wires": []
    },
    {
        "id": "9e407434.07586",
        "type": "http response",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "x": 1939,
        "y": 270,
        "wires": []
    },
    {
        "id": "d5b35fc1.f4f95",
        "type": "change",
        "z": "e49ea6ba.2c95f8",
        "name": "API_RESPONSE",
        "rules": [
            {
                "t": "move",
                "p": "response",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1780,
        "y": 269,
        "wires": [
            [
                "9e407434.07586"
            ]
        ]
    },
    {
        "id": "8cbe3379.99055",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "detail_calculation",
        "func": "var big_record_tables   = {} , \n    detail              = {},\n    templates_arr       = msg.templates_arr ,\n    child_task          = msg.child_task ? msg.child_task[0] : null,\n    timeout             = msg.timeout ? msg.timeout[0] : null ,\n    location            = msg.location ? msg.location[0] : null,\n    user                = msg.user_obj ? msg.user_obj[0] : null ,\n    task                = msg.task_obj ? msg.task_obj[0] : null,\n    user_arr            = msg.user_arr ,\n    form_data           = msg.form_data ,\n    details_arr         = [];\n    msg.doCreate_optional_detail = false ;\n     \n     \n    //sort the detail_arr as by created at\n    details_arr =  msg.details_arr.sort(function(a,b){\n        details_arr = details_arr.sort(function(a,b){\n        \treturn (a.createdAt - b.createdAt);\t\n        });\n    });\n    \nbig_record_tables.user  = user ;\nbig_record_tables.task  = task ;\n\n//setting up some obj from big_record_tables\nbig_record_tables.task.details = {\n    timeout : create_timeout_list_obj(timeout, templates_arr, user_arr, \"timeout\") ,\n    user_calculated: create_timeout_list_obj(timeout, templates_arr, user_arr, \"user_calculated\"),\n    location : get_location_obj(location) \n} ;\n\n\n//create detail obj to save into master_table;\ndetail.table                            = \"details\";\ndetail.task_id                          = task._id || null;\ndetail.child_task_id                    = task.child_default_task_id || null;\ndetail.user_id                          = user._id || null;\ndetail.from_user_id                     = set_from_user(form_data.from_user_id) ;\n\ndetail.page_id                          = check_number(form_data.page_id) || generate_page_id();\ndetail.from_page_id                     = check_number(form_data.from_page_id) || generate_page_id();\ndetail.to_page_id                       = return_page_id(form_data.page_id);\n\ndetail.synchronized                     = 0 ;\ndetail.processed                        = 0 ;\ndetail.status                           = 0 ;\ndetail.read                             = 0 ;\ndetail.display_if_empty                 = task.display_if_empty || 1;\ndetail.date_created                     = new Date().toJSON() ;\ndetail.due_date                         = big_record_tables.task.details.user_calculated.delivery_due;\ndetail.offline_expiration_seconds       = task.offline_expiration_time ;\ndetail.priority                         = 1;\ndetail.type                             = {\n                                            \"public\" : task.type || \"public\"\n                                        };\ndetail.image                            = task.image ;\ndetail.from_user                        = {\n                                            firstname   : user.firstname || \"\" ,\n                                            lastname    : user.lastname || \"\" ,\n                                            email       : user.email || \"\",\n                                            phone       : user.phone || \"\"\n                                        };\ndetail.user_incoming                    = {\n                                            note    :   form_data.note ,\n                                            message :   form_data.note\n                                        } ;\n\ndetail.watson_incoming                  = {\n                                            message :   \"Watson response to : \" + form_data.note,\n                                            response : {},\n                                            \n                                        } ;\ndetail.template                         = {\n                                            details : get_template(task.detail_template_id, templates_arr)\n                                        };\n\ndetail.timeout                          = big_record_tables.task.details.timeout ;\ndetail.user_calculate                   = big_record_tables.task.details.user_calculated ;\ndetail.location                         = big_record_tables.task.details.location ;\ndetail.default                          = {\n                                            parent : null,\n                                            allchildren: null\n                                        };\ndetail.count_status\t                    = {\n                                            active : 1,\n                                            unread : 0\n                                        };\ndetail.count\t                        = {\n                                            active : 1,\n                                            unread : 1\n                                        };\ndetail.count_if                         = {\n                                            active : 1,\n                                            unread : 0\n                                        };\ndetail.createdAt                        = Number(new Date().getTime()) ;\n\nmsg.template_arr = templates_arr ;\nmsg.payload      = detail ;\n\nif(check_need_to_create_second_detail(form_data.from_user_id)){\n    var second_detail  = JSON.parse(JSON.stringify(detail));\n        second_detail.from_user_id  = form_data.from_user_id[1];\n        second_detail.user_incoming = {\n            note    :   form_data.to_note ,\n            message :   form_data.to_note\n        } ;\n\n        second_detail.watson_incoming = {\n            message :   \"Watson response to : \" + form_data.to_note,\n            response : {},\n        } ;\n        msg.doCreate_optional_detail = true;\n        msg.option_detail = second_detail;\n}\n\nmsg.api_response = {status:200, error: false, msg: \"Record created successfully\", data: detail};\nreturn msg;\n\nfunction create_timeout_list_obj(timeout_obj, templates, users, type){\n    if(timeout_obj === undefined || timeout_obj === null){\n        return {};\n    }\n    \n    switch(type){\n        case \"timeout\" : {\n            if(check_obj(timeout_obj.timeout_list) > 1){\n                var update_obj = JSON.parse(JSON.stringify(timeout_obj)) ;\n                \n                for(var list in timeout_obj.timeout_list){\n                    if(list !== getAttributeByIndex(timeout_obj.timeout_list, 0)){\n                        update_obj.timeout_list[list].delivery_user_ids = get_obj_from_array(timeout_obj.timeout_list[list].delivery_user_ids, users);\n                        update_obj.timeout_list[list].message = timeout_obj.timeout_list[list].message_id ? get_template(timeout_obj.timeout_list[list].message_id, templates) : null;\n                        update_obj.timeout_list[list].from = timeout_obj.timeout_list[list].from_id ? get_template(timeout_obj.timeout_list[list].from_id, templates) : null;\n                    }\n                }\n                delete update_obj.timeout_list[getAttributeByIndex(timeout_obj.timeout_list, 0)];\n                return update_obj ;   \n            }else{\n                return {} ;\n            }\n            break;\n        }\n        \n        case \"user_calculated\" : {\n\n            if(timeout_obj.timeout_list){\n                for(var key in timeout_obj.timeout_list){\n                    if(key == getAttributeByIndex(timeout_obj.timeout_list, 0)){\n                        timeout_obj.timeout_list[key].delivery_user_ids = get_obj_from_array(timeout_obj.timeout_list[key].delivery_user_ids, users);\n                        timeout_obj.timeout_list[key].template = {\n                            message : timeout_obj.timeout_list[key].message_id ? get_template(timeout_obj.timeout_list[key].message_id, templates) : null ,\n                            from    : timeout_obj.timeout_list[key].from_id ? get_template(timeout_obj.timeout_list[key].from_id, templates) : null\n                        };\n                    }\n                }\n\n                return timeout_obj.timeout_list[getAttributeByIndex(timeout_obj.timeout_list, 0)] ; \n            }else{\n                return {} ; \n            }\n            break;\n        }\n        \n        default: {\n            return {};\n        }\n    }\n}\n\nfunction check_obj(obj){\n    if(typeof obj === \"object\"){\n        return Object.keys(obj).length;\n    }else{\n        return 0 ;\n    }\n}\n\nfunction get_location_obj(locations){\n    if(locations === undefined || locations === null){\n        return {};\n    }\n    var obj = {};\n\n    if(locations !== null && locations !== undefined){\n        for(var i=0; i< locations.length; i++){\n            if(locations[i]){\n                obj[locations[i]._id] = locations[i] ;\n            }\n        }\n        return obj ;\n    }else{\n        return obj ;\n    }\n}\n\nfunction get_template(id, template){\n    if(template === undefined || template === null){\n        return {};\n    }\n    \n    var obj = {} ;\n    if(template !== null){\n        for(var i=0; i< template.length; i++){\n            if(id === template[i]._id){\n                obj = template[i] ;\n            }\n        }    \n        return obj ;\n    }else{\n        return obj ;\n    }\n}\n\nfunction check_number(n){\n    if(typeof n === \"string\" && n !== \"\"){\n        return parseInt(n);\n    }else{\n        return n ;\n    }\n}\n\nfunction generate_page_id(){\n    return new Date().getTime();\n}\n\nfunction getAttributeByIndex(obj, index){\n  var i = 0;\n  for (var attr in obj){\n    if (index === i){\n      return attr;\n    }\n    i++;\n  }\n  return null;\n}\n\nfunction get_obj_from_array(id, arr){\n    if(arr === null || arr === undefined){\n        return {};\n    }\n\n    if(id instanceof Object){\n        return id ;    \n    }\n\n    var obj = {} ;\n    if(arr !== null && arr.length){\n        for(var i=0; i< arr.length; i++){\n            if(arr[i]._id === id){\n                obj[arr[i]._id] = arr[i] ;\n            }\n        }\n        return obj ;\n    }else{\n        return obj ;\n    }\n}\n\nfunction calculate_to_page_id(task_obj, details_arr){\n\n    var page_id = false ;\n    if(task_obj !== null && details_arr !== undefined){\n        var task_id = task_obj._id ;\n        if(details_arr.length){\n            for(var i=0; i < details_arr.length; i++){\n                if(details_arr[i].task_id === task_id){\n                  page_id = details_arr[i].to_page_id ;\n                }\n            }\n            if(!page_id){\n              return generate_page_id(6);\n            }else{\n              return page_id;\n            }\n        }else{\n            page_id = task_obj.page_id ;\n        }\n    }else{\n        return generate_page_id(6);\n    }\n}\n\n\nfunction return_page_id(page_id){\n    return generate_page_id() ;\n}\n\nfunction set_from_user(item){\n    if(Object.prototype.toString.call(item) === \"[object Array]\"){\n        // node.warn(\">>>>>>>>>>>>>>>>>>>>>>> set_from_user\");\n        // node.warn(item);\n        return item[0] ;\n    }else{\n        // node.warn(\"set_from_user else case\");\n        return item || null;\n    }\n}\n\nfunction check_need_to_create_second_detail(item){\n    if(Object.prototype.toString.call(item) === \"[object Array]\"){\n        // node.warn(\"check_need_to_create_second_detail >>>>\");\n        // node.warn(item);\n        return true ;\n    }else{\n        // node.warn(\"else case >>>>\");\n        return false ;\n    }\n}\n",
        "outputs": 1,
        "noerr": 0,
        "x": 2323.03125,
        "y": 404.046875,
        "wires": [
            [
                "aa20bcb9.1a12c",
                "1ef612e9.7ce815",
                "70fa400b.617578",
                "14dbeffe.488bf8"
            ]
        ]
    },
    {
        "id": "d9b938ed.85f9e",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "log",
        "func": "node.warn(\"There isn't any Location for task obj\");\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2964.03125,
        "y": 303.046875,
        "wires": [
            [
                "8cbe3379.99055"
            ]
        ]
    },
    {
        "id": "c19f98d.4a08de8",
        "type": "change",
        "z": "e49ea6ba.2c95f8",
        "name": "location",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "location",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3378.03125,
        "y": 362.046875,
        "wires": [
            [
                "8cbe3379.99055"
            ]
        ]
    },
    {
        "id": "aa20bcb9.1a12c",
        "type": "switch",
        "z": "e49ea6ba.2c95f8",
        "name": "optional task",
        "property": "child_task_id",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2521.03125,
        "y": 521.046875,
        "wires": [
            [
                "4afd4c02.0a4dc4"
            ],
            [
                "c1cebdea.81e9f"
            ]
        ]
    },
    {
        "id": "628652f9.06cdcc",
        "type": "switch",
        "z": "e49ea6ba.2c95f8",
        "name": "location",
        "property": "location_id",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2827.03125,
        "y": 309.046875,
        "wires": [
            [
                "d9b938ed.85f9e"
            ],
            [
                "52fcf0d1.0cc5e"
            ]
        ]
    },
    {
        "id": "62b490b0.6e6788",
        "type": "cloudant in",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 3156.03125,
        "y": 360.046875,
        "wires": [
            [
                "c19f98d.4a08de8"
            ]
        ]
    },
    {
        "id": "4afd4c02.0a4dc4",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "log",
        "func": "node.warn(\"No need to create optional task\");\nmsg.detail = msg.payload ;\nmsg.isCreateOptionalTask = false ;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2697.03125,
        "y": 542.046875,
        "wires": [
            [
                "7e179226.7ca37c"
            ]
        ]
    },
    {
        "id": "c1cebdea.81e9f",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "optional task",
        "func": "var default_task        = msg.child_task ? msg.child_task[0] : null ,\n    detail              = msg.payload ,\n    optional_task       = {}; \n    \nif(!isEmpty(default_task)){\n    optional_task = {\n        table                   : \"task_table\",\n        task_name               : detail.user_incoming.message, \n        user_id                 : default_task.user_id || null,\n        page_id                 : detail.to_page_id, \n        from_page_id            : detail.page_id,\n        parent_id               : detail.task_id, \n        header_template_id      : default_task.header_template_id || null,\n        detail_template_id      : default_task.detail_template_id || null,\n        footer_template_id      : default_task.footer_template_id || null,\n        timeout_id              : default_task.timeout_id || null,\n        location_id             : default_task.location_id || null,\n        child_default_task_id   : default_task.child_default_task_id || null,\n        child_default_task_name : default_task.child_default_task_name || null,\n        date_created            : new Date().toJSON(),\n        type                    : default_task.type || null,\n        status                  : default_task.status || 0,\n        category                : default_task.category || null,\n        additional_data_fn      : default_task.additional_data_fn || null,\n        optional_data           : default_task.optional_data || {},\n        required_data           : default_task.required_data || {},\n        offline_expiration_time : default_task.offline_expiration_time || 0,\n        display_if_empty        : default_task.display_if_empty || 1 ,\n        count_status : {\n            active : 1,\n            unread : 0,\n        },\n        count : {\n            active : 1,\n            unread : 0,\n        },\n        count_if : {\n            active : 1,\n            unread : 0,\n        }\n    };\n    msg.isCreateOptionalTask = true ;\n    msg.detail = detail ;\n    msg.payload = optional_task ;\n}else{\n    msg.isCreateOptionalTask = false ;\n    msg.detail = detail ;\n    msg.payload = \"No need to create optional task\";\n}\n\nnode.warn(\"Before going to init loop method\");\nnode.warn(msg);\nreturn msg;\n\nfunction isEmpty(obj){\n    if(obj instanceof Object){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(obj instanceof Array){\n        if(obj.length){\n            return false ;\n        }else {\n            return true ;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 2718.03125,
        "y": 584.046875,
        "wires": [
            [
                "7e179226.7ca37c"
            ]
        ]
    },
    {
        "id": "70c63822.61c6d8",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "log",
        "func": "node.warn(\"There isn't any timeout for this task\");\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2368.03125,
        "y": 300.046875,
        "wires": [
            [
                "628652f9.06cdcc"
            ]
        ]
    },
    {
        "id": "9586b57c.78972",
        "type": "change",
        "z": "e49ea6ba.2c95f8",
        "name": "timeout",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "timeout",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2735.03125,
        "y": 356.046875,
        "wires": [
            [
                "628652f9.06cdcc"
            ]
        ]
    },
    {
        "id": "52fcf0d1.0cc5e",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "location",
        "func": "msg.payload = {\n    query: \"table:location AND _id:\" + msg.location_id\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2971.03125,
        "y": 362.046875,
        "wires": [
            [
                "62b490b0.6e6788"
            ]
        ]
    },
    {
        "id": "7e179226.7ca37c",
        "type": "switch",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "property": "isCreateOptionalTask",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2880.03125,
        "y": 555.046875,
        "wires": [
            [
                "68160e10.63b3d",
                "2ee752ff.9264fe"
            ],
            [
                "35a19ecc.5e09b2",
                "68160e10.63b3d"
            ]
        ]
    },
    {
        "id": "bfcd18cc.dd545",
        "type": "switch",
        "z": "e49ea6ba.2c95f8",
        "name": "timeout",
        "property": "timeout_id",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2224.03125,
        "y": 307.046875,
        "wires": [
            [
                "70c63822.61c6d8"
            ],
            [
                "848bfb6c.b9f208"
            ]
        ]
    },
    {
        "id": "ae8b00e3.f0ab68",
        "type": "cloudant in",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 2562.03125,
        "y": 357.046875,
        "wires": [
            [
                "9586b57c.78972"
            ]
        ]
    },
    {
        "id": "68160e10.63b3d",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "init loop",
        "func": "var detail_obj = msg.detail ;\nif(isEmpty(detail_obj.timeout)){\n    msg.timeoutLength = 0;\n}else{\n    msg.timeoutLength = check_obj(detail_obj.timeout.timeout_list) ;    \n}\nmsg.count = 0;\nreturn msg;\n\n\nfunction check_obj(obj){\n    if(obj !== undefined && obj !== null && obj !== \"\"){\n        return Object.keys(obj).length ;\n    }else{\n        return 0;\n    }\n}\n\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 3272.03125,
        "y": 541.046875,
        "wires": [
            [
                "942a897a.8571c8"
            ]
        ]
    },
    {
        "id": "35a19ecc.5e09b2",
        "type": "debug",
        "z": "e49ea6ba.2c95f8",
        "name": "Optional task log",
        "active": true,
        "console": "false",
        "complete": "payload",
        "x": 3073.03125,
        "y": 582.046875,
        "wires": []
    },
    {
        "id": "e6410e26.7ce48",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "log",
        "func": "node.warn(\"there isn't any child default_task\");\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 3272.03125,
        "y": 203.046875,
        "wires": [
            [
                "bfcd18cc.dd545"
            ]
        ]
    },
    {
        "id": "9354e8c7.79d778",
        "type": "change",
        "z": "e49ea6ba.2c95f8",
        "name": "child_task",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "child_task",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3669.03125,
        "y": 258.046875,
        "wires": [
            [
                "bfcd18cc.dd545"
            ]
        ]
    },
    {
        "id": "848bfb6c.b9f208",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "timeout",
        "func": "msg.payload = {\n    query: \"table:timeout AND _id:\" + msg.timeout_id\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2378.03125,
        "y": 358.046875,
        "wires": [
            [
                "ae8b00e3.f0ab68"
            ]
        ]
    },
    {
        "id": "942a897a.8571c8",
        "type": "switch",
        "z": "e49ea6ba.2c95f8",
        "name": "counter",
        "property": "count",
        "propertyType": "msg",
        "rules": [
            {
                "t": "lt",
                "v": "timeoutLength",
                "vt": "msg"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 3470.03125,
        "y": 539.046875,
        "wires": [
            [
                "6f4473b7.0dedf4"
            ],
            [
                "cdd37dfd.7a7b2"
            ]
        ]
    },
    {
        "id": "c13a571b.ae9f88",
        "type": "switch",
        "z": "e49ea6ba.2c95f8",
        "name": "child_task",
        "property": "child_task_id",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 3123.03125,
        "y": 227.046875,
        "wires": [
            [
                "e6410e26.7ce48"
            ],
            [
                "70e4f031.d6413"
            ]
        ]
    },
    {
        "id": "f9b0dcb2.3d21b",
        "type": "cloudant in",
        "z": "e49ea6ba.2c95f8",
        "name": "master_table",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 3467.03125,
        "y": 259.046875,
        "wires": [
            [
                "9354e8c7.79d778"
            ]
        ]
    },
    {
        "id": "c56dc5b1.ce4d3",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "count++",
        "func": "msg.count++ ;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 3626.03125,
        "y": 479.046875,
        "wires": [
            [
                "942a897a.8571c8"
            ]
        ]
    },
    {
        "id": "6f4473b7.0dedf4",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "Timeout Processor",
        "func": "var detail_obj      = msg.payload ,\n    template_arr    = msg.templates,\n    users_arr       = msg.user_arr;\n\nif(compare_dates(detail_obj.due_date)){\n    msg.payload = create_detail_by_timeout_processor();\n}else{\n  msg.apiStatus = {status: 400, msg: \"Due date already passout so cann't be processed details\"};\n}\n\nreturn msg;\n\nfunction compare_dates(due_date){\n    var current_unix_date   = new Date().getTime(),\n        due_unix_date       = new Date(due_date).getTime();\n        \n    if(due_unix_date > current_unix_date){\n        return true ;\n    }else{\n        return false ;\n    }\n}\n\nfunction create_detail_by_timeout_processor(){\n    var detail = JSON.parse(JSON.stringify(detail_obj));  \n    \n    if(detail.timeout !== null){\n        if(check_obj(detail.timeout.timeout_list) > 0){\n            var clone_obj = {\n                table                       : \"details\",\n                task_id                     : detail_obj.task_id ,\n                child_task_id               : detail_obj.child_task_id,\n                user_id                     : detail_obj.user_id,\n                page_id                     : detail_obj.page_id,\n                synchronized                : detail_obj.synchronized,\n                processed                   : detail_obj.processed,\n                status                      : detail_obj.status,\n                read                        : detail_obj.read,\n                display_if_empty            : detail_obj.display_if_empty,\n                date_created                : detail_obj.date_created,\n                due_date                    : detail_obj.due_date,\n                offline_expiration_seconds  : detail_obj.offline_expiration_seconds,\n                priority                    : detail_obj.priority,\n                user_incoming               : detail_obj.user_incoming ,\n                watson_incoming             : detail_obj.watson_incoming,\n                template                    : detail_obj.template,\n                timeout                     : create_timeout_list_obj(detail.timeout, template_arr, users_arr, \"timeout\") ,\n                user_calculated             : create_timeout_list_obj(detail_obj.timeout, template_arr, users_arr, \"user_calculated\"),\n                location                    : detail_obj.location,\n                default                     : detail_obj.default,\n                createdAt                   : detail_obj.createdAt,\n                count                       : detail_obj.count\n            };\n   \n            return clone_obj ;\n        }else{\n            return {} ;\n        }   \n    }else{\n        return {};\n    }\n}\n\nfunction create_timeout_list_obj(timeout_obj, templates, users, type){\n    switch(type){\n        case \"timeout\" : {\n            if(check_obj(timeout_obj.timeout_list) > 1){\n                \n                for(var list in timeout_obj.timeout_list){\n                    if(parseInt(list) !== getAttributeByIndex(timeout_obj.timeout_list, 0)){\n                        timeout_obj.timeout_list[list].delivery_user_ids = get_obj_from_array(timeout_obj.timeout_list[list].delivery_user_ids, users);\n                        timeout_obj.timeout_list[list].message = timeout_obj.timeout_list[list].message_id ? get_template(timeout_obj.timeout_list[list].message_id, templates) : null;\n                        timeout_obj.timeout_list[list].from = timeout_obj.timeout_list[list].from_id ? get_template(timeout_obj.timeout_list[list].from_id, templates) : null;\n                    }\n                }\n                \n                delete timeout_obj.timeout_list[getAttributeByIndex(timeout_obj.timeout_list, 0)];\n                return timeout_obj ;   \n            }else{\n                return {} ;\n            }\n            break;\n        }\n        \n        case \"user_calculated\" : {\n            if(timeout_obj.timeout_list){\n                for(var key in timeout_obj.timeout_list){\n                    if(parseInt(key) == getAttributeByIndex(timeout_obj.timeout_list, 0)){\n                        timeout_obj.timeout_list[key].delivery_user_ids = get_obj_from_array(timeout_obj.timeout_list[key].delivery_user_ids, users);\n                        timeout_obj.timeout_list[key].template = {\n                            message : timeout_obj.timeout_list[key].message_id ? get_template(timeout_obj.timeout_list[key].message_id, templates) : null ,\n                            from    : timeout_obj.timeout_list[key].from_id ? get_template(timeout_obj.timeout_list[key].from_id, templates) : null\n                        };\n                    }\n                }\n\n                return timeout_obj.timeout_list[getAttributeByIndex(timeout_obj.timeout_list, 0)] ; \n            }else{\n                return {} ; \n            }\n            break;\n        }\n        \n        default: {\n            return {};\n        }\n    }\n}\n\nfunction check_obj(obj){\n    return Object.keys(obj).length ;\n}\n\nfunction get_template(id, template){\n    var obj = {} ;\n    if(template !== null){\n        for(var i=0; i< template.length; i++){\n            if(id === template[i]._id){\n                obj = template[i] ;\n            }\n        }    \n        return obj ;\n    }else{\n        return obj ;\n    }\n}\n\nfunction get_obj_from_array(id, arr){\n\n    if(id instanceof Object){\n        return id ;    \n    }\n    \n    var obj = {} ;\n    if(arr !== null && arr.length){\n        for(var i=0; i< arr.length; i++){\n            if(arr[i]._id === id){\n                obj[arr[i]._id] = arr[i] ;\n            }\n        }\n        return obj ;\n    }else{\n        return obj ;\n    }\n}\n\nfunction getAttributeByIndex(obj, index){\n  var i = 0;\n  for (var attr in obj){\n    if (index === i){\n      return parseInt(attr);\n    }\n    i++;\n  }\n  return null;\n}",
        "outputs": 1,
        "noerr": 0,
        "x": 3690.03125,
        "y": 533.046875,
        "wires": [
            [
                "c56dc5b1.ce4d3",
                "b92b2e6c.a46218"
            ]
        ]
    },
    {
        "id": "cdd37dfd.7a7b2",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "indicator",
        "func": "msg.payload = \"Timeout processor executes sucessfully\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 3664.03125,
        "y": 585.046875,
        "wires": [
            [
                "e49d0f63.b4c548",
                "a9bfd576.59dc8"
            ]
        ]
    },
    {
        "id": "391fca6a.75a3ce",
        "type": "switch",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "property": "api_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_ERROR",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2953.03125,
        "y": 169.046875,
        "wires": [
            [
                "88e7cf5.5c3a73"
            ],
            [
                "c13a571b.ae9f88"
            ]
        ]
    },
    {
        "id": "70e4f031.d6413",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "child task",
        "func": "msg.payload = {\n    query : \"table:task_table AND _id:\" + msg.child_task_id \n};\nnode.warn(msg.payload);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 3280.03125,
        "y": 260.046875,
        "wires": [
            [
                "f9b0dcb2.3d21b"
            ]
        ]
    },
    {
        "id": "e49d0f63.b4c548",
        "type": "debug",
        "z": "e49ea6ba.2c95f8",
        "name": "Timeout processor",
        "active": true,
        "console": "false",
        "complete": "payload",
        "x": 3901.03125,
        "y": 565.046875,
        "wires": []
    },
    {
        "id": "1d413366.c144e5",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "validate",
        "func": "var task = msg.task_obj , user = msg.user_obj, detail = msg.details_obj;\n\nif(isEmpty(task)){\n    msg.api_status = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, msg: \"Unable to find `task obj` with `task_id`\", data: null};\n}else if(isEmpty(user)){\n    msg.api_status = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, msg: \"Unable to find `user obj` with `access_token`\", data: null};\n}else{\n    msg.api_status      = \"API_SUCCESS\";\n    msg.child_task_id   = msg.task_obj[0].child_default_task_id || null;\n    msg.timeout_id      = msg.task_obj[0].timeout_id || null;\n    msg.location_id     = msg.task_obj[0].location_id || null;\n}\nreturn msg;\n\n    \nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 2790.03125,
        "y": 178.046875,
        "wires": [
            [
                "391fca6a.75a3ce"
            ]
        ]
    },
    {
        "id": "88e7cf5.5c3a73",
        "type": "http response",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "x": 3129.03125,
        "y": 173.046875,
        "wires": []
    },
    {
        "id": "274ee9dd.7167ee",
        "type": "change",
        "z": "e49ea6ba.2c95f8",
        "name": "user arr",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "user_arr",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3375.03125,
        "y": 38.046875,
        "wires": [
            [
                "838bf1ee.c1fd88"
            ]
        ]
    },
    {
        "id": "a3366bf3.032f78",
        "type": "cloudant in",
        "z": "e49ea6ba.2c95f8",
        "name": "master_table",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 3217.03125,
        "y": 32.046875,
        "wires": [
            [
                "274ee9dd.7167ee"
            ]
        ]
    },
    {
        "id": "8b4f23a6.ef8d8",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "payload",
        "func": "msg.payload = {\n    query: \"table:users\",\n    sort: \"_id<string>\"\n};\n\nmsg.detail_payload = {\n    query: \"table:details\",\n    sort : \"_id<string>\"\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 3052.03125,
        "y": 32.046875,
        "wires": [
            [
                "a3366bf3.032f78"
            ]
        ]
    },
    {
        "id": "e3e09c4e.94eb98",
        "type": "change",
        "z": "e49ea6ba.2c95f8",
        "name": "user_obj",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "user_obj",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2894.03125,
        "y": 33.046875,
        "wires": [
            [
                "8b4f23a6.ef8d8"
            ]
        ]
    },
    {
        "id": "8aa913d0.c5f0c8",
        "type": "cloudant in",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 2720.03125,
        "y": 34.046875,
        "wires": [
            [
                "e3e09c4e.94eb98"
            ]
        ]
    },
    {
        "id": "ceec9550.98cfa8",
        "type": "change",
        "z": "e49ea6ba.2c95f8",
        "name": "payload",
        "rules": [
            {
                "t": "move",
                "p": "user_payload",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2552.0313720703125,
        "y": 35.046875,
        "wires": [
            [
                "8aa913d0.c5f0c8"
            ]
        ]
    },
    {
        "id": "1bc5fea7.ebdd81",
        "type": "change",
        "z": "e49ea6ba.2c95f8",
        "name": "task_obj",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "task_obj",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2390.0313720703125,
        "y": 35.046875,
        "wires": [
            [
                "ceec9550.98cfa8"
            ]
        ]
    },
    {
        "id": "e5a1a29a.2f2bc8",
        "type": "cloudant in",
        "z": "e49ea6ba.2c95f8",
        "name": "master_table",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 2223.03125,
        "y": 35.046875,
        "wires": [
            [
                "1bc5fea7.ebdd81"
            ]
        ]
    },
    {
        "id": "1b76687e.209498",
        "type": "change",
        "z": "e49ea6ba.2c95f8",
        "name": "payload",
        "rules": [
            {
                "t": "move",
                "p": "task_payload",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1949.03125,
        "y": 413.046875,
        "wires": [
            [
                "e5a1a29a.2f2bc8"
            ]
        ]
    },
    {
        "id": "a1c530fa.97043",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "validate",
        "func": "var access_token = msg.payload.access_token ;\nvar table_data = msg.payload.table_data ;\n\nif(table_data === null || table_data === undefined){\n    msg.flow_status = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, type: \"Validation error\", msg: \"Please provide valid json object as api request body.\"};\n    return msg;\n}else if(access_token === null || access_token === undefined || access_token === \"\"){\n    msg.flow_status = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, type: \"Validation error\", msg: \"Please provide `access_token` in api request body\"};\n    return msg;\n}else if(table_data.note === null || table_data.note === undefined || table_data.note === \"\"){\n    msg.flow_status = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, type: \"Validation error\", msg: \"Please provide `note` in api request body\"};\n    return msg;\n}else if(table_data.page_id === null || table_data.page_id === undefined || table_data.page_id === \"\"){\n    msg.flow_status = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, type: \"Validation error\", msg: \"Please provide `page_id` in api request body\"};\n    return msg;\n}else if(table_data.from_page_id === null || table_data.from_page_id === undefined ){\n    msg.flow_status = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, type: \"Validation error\", msg: \"Please provide `from_page_id` in api request body\"};\n    return msg;\n}else if(table_data.task_id === null || table_data.task_id === undefined ){\n    msg.flow_status = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, type: \"Validation error\", msg: \"Please provide `task_id` in api request body\"};\n    return msg;\n}else{\n    msg.flow_status = \"API_SUCCESS\";\n    msg.form_data    = table_data ;\n    msg.task_payload = { \n        query: \"table:task_table AND _id:\" + table_data.task_id \n    };\n    msg.user_payload = {\n        query: \"table:users AND access_token:\" + access_token \n    };\n    msg.page_payload = {\n        query: \"table:details AND page_id:\" + table_data.page_id  \n    };\n    return msg;\n}\n\n\nfunction check_number(n){\n    if(!isNaN(parseInt(n))){\n        return parseInt(n);\n    }else{\n        return n ;\n    }\n}\n",
        "outputs": 1,
        "noerr": 0,
        "x": 1544.03125,
        "y": 466.046875,
        "wires": [
            [
                "7ec7fa99.7066b4"
            ]
        ]
    },
    {
        "id": "c8af2e68.1fd53",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "template",
        "func": "msg.payload = {\n    query: \"table:template\",\n    sort: \"_id<string>\"\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2240.5390625,
        "y": 168.5703125,
        "wires": [
            [
                "a32189ee.f1b998"
            ]
        ]
    },
    {
        "id": "a32189ee.f1b998",
        "type": "cloudant in",
        "z": "e49ea6ba.2c95f8",
        "name": "Templates",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 2383.5390625,
        "y": 168.5703125,
        "wires": [
            [
                "9f22cf4a.0c4048"
            ]
        ]
    },
    {
        "id": "9f22cf4a.0c4048",
        "type": "change",
        "z": "e49ea6ba.2c95f8",
        "name": "template arr",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "templates_arr",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2614.2734375,
        "y": 176.9921875,
        "wires": [
            [
                "1d413366.c144e5",
                "96c62f5d.c1b21"
            ]
        ]
    },
    {
        "id": "36c945a.43e87ba",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "update_create_user_task",
        "func": "var detail_obj          = msg.detail ,\n    ancesstor_arr       = [] ,\n    user_task_arr       = msg.payload ,\n    task_obj            = msg.task_obj[0] ;\n    calculate_user_task = get_user_taskBy_id(detail_obj.user_id, detail_obj.task_id);\n    \nif(check_obj(calculate_user_task) > 0){\n    msg.payload = update_user_task(msg.payload[0], detail_obj.user_id, detail_obj.task_id, 0, 1);\n    \n}else{\n    if(task_obj.parent_id){\n        var user_task = get_user_taskBy_id(detail_obj.user_id, task_obj.parent_id);\n        \n        if(check_obj(user_task) > 0){\n            ancesstor_arr = user_task.ancestors ;   \n            ancesstor_arr.push(task_obj.parent_id);\n        }else{\n            ancesstor_arr.push(task_obj.parent_id);\n        }\n    }\n    \n    msg.payload = {\n        table           : \"user_task\",\n    \ttask_id \t\t: detail_obj.task_id,\n    \tuser_id\t\t\t: detail_obj.user_id,\n    \tpage_id         : parseInt(detail_obj.page_id),\n    \tupdate_read     : 0,\n    \tupdate_active   : 0, \n    \tsynchronized    : 0,\n        status          : 0, \n    \tdate_updated\t: null,\t\n    \tparent_id\t\t: detail_obj.task_id,\n    \tancestors       : ancesstor_arr,\n    \tcount_status\t: {\n    \t   active       : 1,\n    \t   unread       : 0,\n    \t},\n    \tcount\t\t\t: {\n    \t    active      : 0,\n    \t    unread      : 0,\n    \t},\n    \tcount_if\t\t: {\n    \t    active      : 1,\n    \t    unread      : 0\n    \t},\n    \ttemplates\t\t: {},\n    \ttimeout\t\t\t: {},\n    \tcreatedAt       : new Date().getTime()\n    };\n}\nreturn msg;\n\nfunction update_user_task(user_task, user_id, task_id, status, synchronized){\n\n    user_task.synchronized          = synchronized  ;\n    user_task.date_updated          = new Date().toJSON();\n    user_task.templates             = detail_obj.template ;\n    user_task.timeout               = detail_obj.timeout ;\n    user_task.count_status.unread   = detail_obj.read ;\n    user_task.page_id               = parseInt(detail_obj.to_page_id) ;\n    user_task.status                = detail_obj.status || status;\n\n    if(!user_task.update_read){\n        if( ( user_task.count_status.unread === 1 || user_task.count_status.unread === \"1\") && !user_task.count_if.unread ){\n            user_task.count.unread += 1 ;  \n        }\n    }\n\n    if(!user_task.update_active){\n        if( user_task.count_status.active && user_task.count_if.active){\n            user_task.count.active += 1 ;  \n        }\n    }\n    \n    //if(user_task.parent_id) update_user_task(user_task, user_id, user_task.parent_id, 0, 1);\n    \n    user_task.update_read   = 1 ;\n    user_task.update_active = 1 ;\n    \n    return user_task;\n}\n\nfunction get_user_taskBy_id(user_id, task_id){\n    var obj = {};\n    if(user_task_arr !== null && user_task_arr !== undefined){\n        for(var i=0; i< user_task_arr.length; i++){\n            if(\n                user_task_arr[i].user_id        === user_id &&\n                user_task_arr[i].parent_id      === task_id\n            ){\n                    obj = user_task_arr[i];\n            }\n        }\n    }\n    return obj ;\n}\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}\n\n\nfunction check_obj(obj){\n    return Object.keys(obj).length;\n}",
        "outputs": 1,
        "noerr": 0,
        "x": 4253.03125,
        "y": 621.046875,
        "wires": [
            [
                "81e3892f.e8eb6",
                "b763ab20.37e378"
            ]
        ]
    },
    {
        "id": "a9bfd576.59dc8",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "payload",
        "func": "var task_id = msg.detail.task_id ,\n    user_id = msg.detail.user_id ;\n    \nmsg.payload = {\n    query: \"table:user_task AND user_id:\" + user_id ,\n    sort : \"_id<string>\"\n};\n\nnode.warn(msg.payload);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 3873.03125,
        "y": 624.046875,
        "wires": [
            [
                "d5e499e8.95e89"
            ]
        ]
    },
    {
        "id": "d5e499e8.95e89",
        "type": "cloudant in",
        "z": "e49ea6ba.2c95f8",
        "name": "master_table",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 4039.03125,
        "y": 623.046875,
        "wires": [
            [
                "36c945a.43e87ba"
            ]
        ]
    },
    {
        "id": "7ec7fa99.7066b4",
        "type": "switch",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "property": "flow_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_ERROR",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 1744,
        "y": 385,
        "wires": [
            [
                "b5b54e2b.c50588"
            ],
            [
                "1b76687e.209498"
            ]
        ]
    },
    {
        "id": "b5b54e2b.c50588",
        "type": "http response",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "x": 1942,
        "y": 355,
        "wires": []
    },
    {
        "id": "81e3892f.e8eb6",
        "type": "cloudant out",
        "z": "e49ea6ba.2c95f8",
        "name": "User Task",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "payonly": true,
        "operation": "insert",
        "x": 4467,
        "y": 552,
        "wires": []
    },
    {
        "id": "b92b2e6c.a46218",
        "type": "cloudant out",
        "z": "e49ea6ba.2c95f8",
        "name": "Details",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "payonly": true,
        "operation": "insert",
        "x": 3911,
        "y": 515,
        "wires": []
    },
    {
        "id": "2ee752ff.9264fe",
        "type": "cloudant out",
        "z": "e49ea6ba.2c95f8",
        "name": "Optional Task",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "payonly": true,
        "operation": "insert",
        "x": 3051,
        "y": 522,
        "wires": []
    },
    {
        "id": "1ef612e9.7ce815",
        "type": "cloudant out",
        "z": "e49ea6ba.2c95f8",
        "name": "Details",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "payonly": true,
        "operation": "insert",
        "x": 2503,
        "y": 438,
        "wires": []
    },
    {
        "id": "70fa400b.617578",
        "type": "change",
        "z": "e49ea6ba.2c95f8",
        "name": "API_RESPONSE",
        "rules": [
            {
                "t": "move",
                "p": "api_response",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2541,
        "y": 478,
        "wires": [
            [
                "dae84910.9c08b"
            ]
        ]
    },
    {
        "id": "dae84910.9c08b",
        "type": "http response",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "x": 2697,
        "y": 499,
        "wires": []
    },
    {
        "id": "706b661b.ea07a",
        "type": "http in",
        "z": "84d8e4c3.e48e3",
        "name": "API HANDLER",
        "url": "/master_api_handler",
        "method": "get",
        "swaggerDoc": "",
        "x": 87.765625,
        "y": 195.74999237060547,
        "wires": [
            [
                "ed3bd821.69465"
            ]
        ]
    },
    {
        "id": "ed3bd821.69465",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "Handler",
        "func": "var req = msg.payload ;\n\nif(isEmpty(req)){\n    msg.api_response = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, msg: \"req params must be specified.\", data: null};\n}else{\n    msg.api_response = \"API_SUCCESS\";\n    msg.req_params = req;\n}\n\nreturn msg;\n\nfunction isEmpty(obj){\n    if(typeof obj === \"object\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 267.765625,
        "y": 281.74999237060547,
        "wires": [
            [
                "4be90772.8aca"
            ]
        ]
    },
    {
        "id": "4be90772.8aca",
        "type": "switch",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "property": "api_response",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_ERROR",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 418.765625,
        "y": 279.74999237060547,
        "wires": [
            [
                "70b09f8e.9734f"
            ],
            [
                "6ca9bca3.1e94c4"
            ]
        ]
    },
    {
        "id": "70b09f8e.9734f",
        "type": "http response",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "x": 569.7655944824219,
        "y": 241.74999237060547,
        "wires": []
    },
    {
        "id": "6ca9bca3.1e94c4",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "validate body",
        "func": "var params = msg.req_params;\n\nif(isEmpty(params.type)){\n    msg.api_response = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, msg: \"`type` parameter must be set to get record\", data: null};\n}else if(isEmpty(params.content)){\n    msg.api_response = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, msg: \"`content` parameter must be set to get record\", data: null};    \n}else{\n    msg.api_response = \"API_SUCCESS\";\n    var obj = populate_content(params.content) ;\n    if(obj.error){\n      msg.api_response = \"API_ERROR\";\n      msg.payload = {status: 400, error: true, msg: \"Unable to parse `content` param json.\", data: null};\n    }else{\n        msg.payload_type    = params.type ;\n        msg.payload_content = obj.data ;\n    }\n}\n\nreturn msg;\n\nfunction isEmpty(obj){\n    if(typeof obj === \"object\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}\n\nfunction populate_content(obj){\n    console.log(\"obj >>>\", obj);\n    if(typeof obj === \"string\"){\n        try{\n           var response = JSON.parse(obj);\n           return {error: false, data: response , msg: \"Json parse successfully\"};\n        }catch(e){\n            node.warn(e);\n            return {error: true, data: null, msg: JSON.stringify(e) };\n        }\n    }else{\n       return {error: true, msg: \"Param content must be of `string` class.\", data: null} ;\n    }\n}",
        "outputs": 1,
        "noerr": 0,
        "x": 587.7655944824219,
        "y": 295.74999237060547,
        "wires": [
            [
                "a58aa247.5d3f1"
            ]
        ]
    },
    {
        "id": "a58aa247.5d3f1",
        "type": "switch",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "property": "api_response",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_ERROR",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 739.7655944824219,
        "y": 356.74999237060547,
        "wires": [
            [
                "eacd62ff.9c3fc8"
            ],
            [
                "33278fc4.04b828"
            ]
        ]
    },
    {
        "id": "eacd62ff.9c3fc8",
        "type": "http response",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "x": 942.7655944824219,
        "y": 286.74999237060547,
        "wires": []
    },
    {
        "id": "33278fc4.04b828",
        "type": "switch",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "property": "payload_type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "get_page",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "update_get_pages",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "update_get_user_tasks",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "get_task",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "formatted_user",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "formatted_timeout",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "formatted_location",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "formatted_task",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "get_all_templates",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "search",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 11,
        "x": 787.765625,
        "y": 688.75,
        "wires": [
            [
                "c92a77cf.a4c088"
            ],
            [
                "a90c86c0.dfa5f8"
            ],
            [
                "2fb552c6.980fe6"
            ],
            [
                "7e0622b8.f560f4"
            ],
            [
                "ceff2481.58ec4"
            ],
            [
                "81a9737c.8c3538"
            ],
            [
                "7169cd86.26438c"
            ],
            [
                "348f0a42.759d4e"
            ],
            [
                "cd835384.849fd"
            ],
            [
                "6b3a000a.158e98"
            ],
            [
                "a4f13815.b0fe48"
            ]
        ]
    },
    {
        "id": "c92a77cf.a4c088",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "get_page",
        "func": "var params = msg.payload_content ;\nif(isEmpty(params.access_token)){\n    msg.api_status    = \"API_ERROR\";\n    msg.payload       = {status: 400, error: true, msg: \"`access_token` is required to get_page.\", data: null};\n}else if(isEmpty(params.page_id)){\n    msg.api_status    = \"API_ERROR\";\n    msg.payload       = {status: 400, error: true, msg: \"`page_id` is required to get_page.\", data: null};\n}else{\n    msg.api_status    = \"API_SUCCESS\";\n}\nreturn msg;\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 1231.3828125,
        "y": 192.9882583618164,
        "wires": [
            [
                "367952ef.69bbde"
            ]
        ]
    },
    {
        "id": "a90c86c0.dfa5f8",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "update_get_pages",
        "func": "var params = msg.payload_content ;\n\nif(isEmpty(params.access_token)){\n    msg.api_status    = \"API_ERROR\";\n    msg.payload       = {status: 400, error: true, msg: \"`access_token` is required to get_page.\", data: null};\n}else{\n    msg.api_status    = \"API_SUCCESS\";\n    msg.payload       = {\n        query   : \"table:users AND access_token:\" + params.access_token ,\n        sort    : \"_id<string>\"\n    };\n}\nreturn msg;\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}\n",
        "outputs": 1,
        "noerr": 0,
        "x": 1263.5001220703125,
        "y": 297.33336639404297,
        "wires": [
            [
                "191960b1.1eced7"
            ]
        ]
    },
    {
        "id": "191960b1.1eced7",
        "type": "switch",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "property": "api_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_ERROR",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 1474.8334350585938,
        "y": 372.00008392333984,
        "wires": [
            [
                "cedc2bbd.1660d8"
            ],
            [
                "1d1098cc.fad2ef"
            ]
        ]
    },
    {
        "id": "cedc2bbd.1660d8",
        "type": "http response",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "x": 1618.8333740234375,
        "y": 320.33336639404297,
        "wires": []
    },
    {
        "id": "1d1098cc.fad2ef",
        "type": "cloudant in",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 1642.1666259765625,
        "y": 421.33333587646484,
        "wires": [
            [
                "2e842b07.a32b24"
            ]
        ]
    },
    {
        "id": "2e842b07.a32b24",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "validate user",
        "func": "if(isEmpty(msg.payload)){\n    msg.api_status  = \"API_ERROR\";\n    msg.payload     = {status: 400, error: true, msg: \"Unable to fetch user with this `access_token`\", data:null};\n}else{\n    msg.api_status  = \"API_SUCCESS\";\n    msg.user_obj    = msg.payload[0] ;\n    msg.payload     = {\n        selector    : {\n            synchronized : {\n                $eq : 0\n            }\n        },\n        query       : \"table:user_task AND user_id:\" + msg.user_obj._id ,\n        sort        : \"_id<string>\" \n    };\n}\nreturn msg;\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 1830.1666259765625,
        "y": 421.0000762939453,
        "wires": [
            [
                "646039f0.bc2c2",
                "c722593b.a9d16"
            ]
        ]
    },
    {
        "id": "646039f0.bc2c2",
        "type": "switch",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "property": "api_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_ERROR",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 1984.5,
        "y": 421.00001525878906,
        "wires": [
            [
                "b7935b86.0d7068"
            ],
            [
                "4cf49afc.3665c4"
            ]
        ]
    },
    {
        "id": "b7935b86.0d7068",
        "type": "http response",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "x": 2105.5001220703125,
        "y": 385.33338928222656,
        "wires": []
    },
    {
        "id": "4cf49afc.3665c4",
        "type": "cloudant in",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 2128.1666259765625,
        "y": 453.33338928222656,
        "wires": [
            [
                "598c48a4.ba8f"
            ]
        ]
    },
    {
        "id": "598c48a4.ba8f",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "user_task",
        "func": "var users_task = msg.payload ,\n    req_body   = msg.payload_content ;\n\nvar filtred_user_task = get_filter_user_task(users_task);\nmsg.filtred_user_task_length = filtred_user_task.length;\nmsg.counter = 0 ;\nmsg.page_list = [];\nmsg.filtred_payload = filtred_user_task ;\nmsg.payload = {status: 200, data:null};\nreturn msg;\n\nfunction get_req_user_task(user_task){\n    try{\n        return JSON.parse(user_task);\n    }catch(e){\n        return {} ;\n    }\n}\n\nfunction check_obj(obj){\n    return Object.keys(obj).length ;\n}\n\nfunction get_filter_user_task(user_task){\n    var result = [];\n    if(!isEmpty(user_task)){\n        for(var itr = 0; itr < user_task.length; itr++){\n            if(user_task[itr].synchronized === 0){\n                result.push(user_task[itr]);\n            }   \n        }\n    }\n    return result ;\n}\n\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 2292.8333435058594,
        "y": 453.00000762939453,
        "wires": [
            [
                "e793704e.110a58"
            ]
        ]
    },
    {
        "id": "c722593b.a9d16",
        "type": "debug",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "false",
        "x": 2000,
        "y": 350,
        "wires": []
    },
    {
        "id": "e793704e.110a58",
        "type": "switch",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "property": "counter",
        "propertyType": "msg",
        "rules": [
            {
                "t": "lt",
                "v": "filtred_user_task_length",
                "vt": "msg"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2471,
        "y": 454,
        "wires": [
            [
                "7a31f943.367268"
            ],
            [
                "6feba65c.a0bfe"
            ]
        ]
    },
    {
        "id": "c019aa06.222098",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "counter++",
        "func": "msg.counter++ ;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2700,
        "y": 377,
        "wires": [
            [
                "e793704e.110a58"
            ]
        ]
    },
    {
        "id": "3197aad8.57c5de",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "api_res",
        "func": "msg.page_list.push(msg.payload);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2963,
        "y": 459,
        "wires": [
            [
                "c019aa06.222098"
            ]
        ]
    },
    {
        "id": "6feba65c.a0bfe",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "res",
        "func": "if(msg.page_list.length){\n    msg.payload = {\n        status : 200,\n        error  : false ,\n        msg    : \"Record fecthed successfully\" ,\n        data   : msg.page_list \n    };\n    return msg;    \n}else{\n    msg.payload = {\n        status : 204,\n        error  : false ,\n        msg    : \"No record with current request\" ,\n        data   : null\n    };\n    return msg;    \n}\n",
        "outputs": 1,
        "noerr": 0,
        "x": 2614.7421875,
        "y": 519.1640625,
        "wires": [
            [
                "d6815812.b7ad"
            ]
        ]
    },
    {
        "id": "d6815812.b7ad",
        "type": "http response",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "x": 2755.2421875,
        "y": 515.9609375,
        "wires": []
    },
    {
        "id": "7a31f943.367268",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "create_url",
        "func": "msg.url = msg.req.headers.host + '/master_api_handler?type=get_page&content={\"access_token\":\"' + msg.payload_content.access_token + '\", \"page_id\":' + msg.filtred_payload[msg.counter].page_id + '}';\nmsg.method  = \"GET\";\nnode.warn(msg.url);\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 2627.5078125,
        "y": 450.5234375,
        "wires": [
            [
                "8a82eb88.dae4d8"
            ]
        ]
    },
    {
        "id": "8a82eb88.dae4d8",
        "type": "http request",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "method": "use",
        "ret": "obj",
        "url": "",
        "tls": "",
        "x": 2799.5078125,
        "y": 454.5234375,
        "wires": [
            [
                "3197aad8.57c5de"
            ]
        ]
    },
    {
        "id": "2fb552c6.980fe6",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "update_get_user_tasks",
        "func": "node.warn(msg.payload_content);\nmsg.payload = {\n    query : \"table:users AND access_token:\" + msg.payload_content.access_token ,\n    sort  : \"_id<string>\"\n};\n\nnode.warn(msg.payload);\nreturn msg ;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 1257.7421875,
        "y": 411.66405487060547,
        "wires": [
            [
                "cf7769d.f268f98"
            ]
        ]
    },
    {
        "id": "5ed8853f.f9f6e4",
        "type": "debug",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "payload",
        "x": 2170.2421875,
        "y": 535.0625,
        "wires": []
    },
    {
        "id": "cf7769d.f268f98",
        "type": "cloudant in",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 1444.7421875,
        "y": 502.2734375,
        "wires": [
            [
                "e571e29.70d22a"
            ]
        ]
    },
    {
        "id": "e571e29.70d22a",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "validate user",
        "func": "if(isEmpty(msg.payload)){\n    msg.api_status = \"API_ERROR\";\n    msg.payload    = {status: 400, error: true , msg: \"Unable to find user with access_token\", data: null};\n}else{\n    msg.api_status      = \"API_SUCCESS\";\n    msg.filter_obj      = msg.payload_content.filter ;\n    msg.user_task_list  = msg.payload_content.user_task_list ;\n    msg.user            = msg.payload[0];\n}\nreturn msg;\n\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 1630.7578125,
        "y": 502.65625,
        "wires": [
            [
                "ccc71ee2.604f"
            ]
        ]
    },
    {
        "id": "ccc71ee2.604f",
        "type": "switch",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "property": "api_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_ERROR",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 1794.7578125,
        "y": 553.9765625,
        "wires": [
            [
                "d2c5c361.c71d1"
            ],
            [
                "39574993.44654e"
            ]
        ]
    },
    {
        "id": "d2c5c361.c71d1",
        "type": "http response",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "x": 1966.2578125,
        "y": 484.4609375,
        "wires": []
    },
    {
        "id": "39574993.44654e",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "payload",
        "func": "var filter          = msg.filter_obj ,\n    user_task_list  = msg.user_task_list ;\n    user            = msg.user ;\n    \n    msg.payload = {\n        selector    : create_selector(filter),\n        query       : create_filtred_query(user._id, filter)\n    };    \n    node.warn(msg.payload);\nreturn msg;\n\nfunction create_selector(filter){\n    var obj = {};\n    if(\"synchronized\" in filter){\n        if(parseInt(filter.synchronized) === 0){\n            obj.synchronized = {\n               \"$ne\" : 1\n            };\n            delete filter.synchronized ;\n        }\n    }\n    \n    if(\"status\" in filter){\n        if(parseInt(filter.status) === 0){\n            obj.status = {\n               \"$ne\" : 1\n            };\n            delete filter.status ;\n        }\n    }\n    return obj ;\n}\n\nfunction create_filtred_query(user_id, filter_obj){\n    var filter_string = \"\";\n    if(obj_length(filter_obj) > 0){\n\n        if(!(\"user_id\" in filter_obj)){\n            filter_string = create_query(filter_obj) + \" user_id:\" + user_id;\n        }\n\n        if((\"user_id\" in filter_obj)){\n            filter_string = create_query(filter_obj);\n        }\n\n    }else{\n        filter_string = \"user_id:\" + user_id  ;\n    }\n    return filter_string;\n}\n\nfunction check_obj_count(obj){\n    var length = Object.keys(obj).length ;\n    \n    if( (\"user_id\" in obj) ){\n        length = length - 1 ;\n    }\n    \n    return length;\n}\n\nfunction create_query(obj){\n    var length = check_obj_count(obj),\n        counter = 0,\n        string = \"\";\n\n    for(var key in obj){\n        if(counter < length){\n            string += key + \":\" + obj[key] + \" AND \";    \n        }else{\n            string += key + \":\" + obj[key] ;\n        }\n        counter++ ;\n    }\n    return string;    \n}\n\nfunction obj_length(obj){\n    return Object.keys(obj).length ;\n}\n\n",
        "outputs": 1,
        "noerr": 0,
        "x": 1977.2421875,
        "y": 569.1640625,
        "wires": [
            [
                "5ed8853f.f9f6e4",
                "1952edf7.fb88f2"
            ]
        ]
    },
    {
        "id": "1952edf7.fb88f2",
        "type": "cloudant in",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 2171.242142617704,
        "y": 605.7656131535772,
        "wires": [
            [
                "2b67e636.cad80a",
                "3270e6fc.7ecb5a"
            ]
        ]
    },
    {
        "id": "2b67e636.cad80a",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "payload",
        "func": "msg.filtred_user_task_list = msg.payload ;\nmsg.payload = {\n    query : \"table:user_task\",\n    sort  : \"_id<string>\"\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2340.7421525865802,
        "y": 604.1718702614309,
        "wires": [
            [
                "2ed73bd5.d20f9c"
            ]
        ]
    },
    {
        "id": "2ed73bd5.d20f9c",
        "type": "cloudant in",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 2530.7421875,
        "y": 617.2734375,
        "wires": [
            [
                "3c2400e3.b606a8"
            ]
        ]
    },
    {
        "id": "3c2400e3.b606a8",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "populate",
        "func": "\nmsg.updated_content = return_user_task_filtred_arr(msg.user_task_list, msg.payload) ;\nmsg.updated_content_length = msg.updated_content.length;\nmsg.res_user_task = [];\nmsg.counter = 0 ;\nmsg.api_response = {status : 200, error: false, msg: \"Record updated successfully\", data: msg.res_user_task, filtred: msg.filtred_user_task_list};\nreturn msg;\n\n\nfunction return_user_task_filtred_arr(req_user_task_list, user_tasks_list){\n    var selected_arr = [];\n    if(\n        user_tasks_list !== undefined && \n        user_tasks_list !== null &&\n        req_user_task_list !== undefined &&\n        req_user_task_list !== null \n    ){\n        for(var i=0; i< req_user_task_list.length; i++){\n            for(j =0; j<user_tasks_list.length; j++){\n                if(\n                    req_user_task_list[i].user_id == user_tasks_list[j].user_id &&\n                    req_user_task_list[i].task_id == user_tasks_list[j].task_id &&\n                    req_user_task_list[i].page_id == user_tasks_list[j].page_id \n                ){\n                  \n                  \n                    user_tasks_list[j].synchronized = req_user_task_list[i].synchronized ;\n                    user_tasks_list[j].status = req_user_task_list[i].status;\n                    user_tasks_list[j].date_updated = req_user_task_list[i].date_updated;\n                    user_tasks_list[j].count = req_user_task_list[i].count;\n                    selected_arr.push(user_tasks_list[j]);\n                }\n            }\n        }    \n        \n        return selected_arr;\n    }else{\n        return selected_arr ;\n    }\n}",
        "outputs": 1,
        "noerr": 0,
        "x": 2688.7421875,
        "y": 618.671875,
        "wires": [
            [
                "797fbf37.c67508"
            ]
        ]
    },
    {
        "id": "797fbf37.c67508",
        "type": "switch",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "property": "counter",
        "propertyType": "msg",
        "rules": [
            {
                "t": "lt",
                "v": "updated_content_length",
                "vt": "msg"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2858.5078125,
        "y": 604.0234375,
        "wires": [
            [
                "d810bbb4.76fe4"
            ],
            [
                "693e84b.de7e47c"
            ]
        ]
    },
    {
        "id": "ae22ef64.9454c8",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "counter",
        "func": "msg.counter++ ;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2959.5078125,
        "y": 546.0234375,
        "wires": [
            [
                "797fbf37.c67508"
            ]
        ]
    },
    {
        "id": "d810bbb4.76fe4",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "payload",
        "func": "    var counter = msg.counter ;\n    msg.payload = msg.updated_content[counter];\n    msg.res_user_task.push(msg.payload);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 3048.5078125,
        "y": 593.0234375,
        "wires": [
            [
                "8bfe6e04.140ff",
                "ae22ef64.9454c8"
            ]
        ]
    },
    {
        "id": "693e84b.de7e47c",
        "type": "change",
        "z": "84d8e4c3.e48e3",
        "name": "api_res",
        "rules": [
            {
                "t": "move",
                "p": "api_response",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3039.515625,
        "y": 682.546875,
        "wires": [
            [
                "4b3e8bdc.c225fc"
            ]
        ]
    },
    {
        "id": "4b3e8bdc.c225fc",
        "type": "http response",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "x": 3220.515625,
        "y": 680.546875,
        "wires": []
    },
    {
        "id": "8bfe6e04.140ff",
        "type": "cloudant out",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "payonly": true,
        "operation": "insert",
        "x": 3240.515625,
        "y": 625.546875,
        "wires": []
    },
    {
        "id": "3270e6fc.7ecb5a",
        "type": "debug",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "false",
        "x": 2351.7578125,
        "y": 659.0546875,
        "wires": []
    },
    {
        "id": "ab53b3a6.85b95",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "delete_detail",
        "func": "var body = msg.payload.table_data ,\n    token = msg.payload.access_token ;\n        \n    if(isEmpty(body)){\n        msg.api_status  = \"API_ERROR\";\n        msg.payload     = {status: 400, error: true, msg: \"Table data should be valid json object.\", data: null};\n    }else if(isEmpty(token)){\n        msg.api_status  = \"API_ERROR\";\n        msg.payload     = {status: 400, error: true, msg: \"`access_token` must be provided.\", data: null};\n    }else if(isEmpty(body.id)){\n        msg.api_status  = \"API_ERROR\";\n        msg.payload     = {status: 400, error: true, msg: \"`id` must be provided to remove detail.\", data: null};\n    }else{\n        msg.access_token    = token ;\n        msg.detail_id       = body.id ;\n        msg.api_status      = \"API_SUCCESS\";\n        msg.payload         = {\n                query   : \"table:users AND access_token:\" + token ,\n                sort    : \"_id<string>\"\n        };\n        node.warn(msg.payload);\n    }\nreturn msg;\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 1296.7578125,
        "y": 634.171875,
        "wires": [
            [
                "f5e5fd20.14671"
            ]
        ]
    },
    {
        "id": "f5e5fd20.14671",
        "type": "switch",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "property": "api_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_ERROR",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 1542.7423095703125,
        "y": 548.9765625,
        "wires": [
            [
                "9872c3de.a4bea"
            ],
            [
                "31798f0c.76dcd8"
            ]
        ]
    },
    {
        "id": "9872c3de.a4bea",
        "type": "http response",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "x": 1683.7422844916591,
        "y": 503.46093276143085,
        "wires": []
    },
    {
        "id": "31798f0c.76dcd8",
        "type": "cloudant in",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 1705.7423095703125,
        "y": 575.7734375,
        "wires": [
            [
                "8768ed39.110008"
            ]
        ]
    },
    {
        "id": "8768ed39.110008",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "validate",
        "func": "var user = msg.payload ;\n    \n    if(isEmpty(user)){\n        msg.api_status  = \"API_ERROR\"    ;\n        msg.payload     = {status: 400, error: true, msg: \"Unable to find user with `access_token`\", data: null};\n    }else{\n        msg.user_obj    = user[0];\n        msg.payload     = {\n            query   : \"table:details AND _id:\" + msg.detail_id.toString() ,\n            sort    : \"_id<string>\"\n        };\n    }\n    \nnode.warn(msg.payload);\nreturn msg;\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 1875.7579345703125,
        "y": 602.1640625,
        "wires": [
            [
                "e177499a.95318"
            ]
        ]
    },
    {
        "id": "e177499a.95318",
        "type": "switch",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "property": "api_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_ERROR",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2032.7500827759516,
        "y": 600.9843702614309,
        "wires": [
            [
                "fda734d0.9f05b"
            ],
            [
                "68861d21.8da8e4"
            ]
        ]
    },
    {
        "id": "fda734d0.9f05b",
        "type": "http response",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "x": 2156.7423095703125,
        "y": 569.953125,
        "wires": []
    },
    {
        "id": "68861d21.8da8e4",
        "type": "cloudant in",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 2174.7579345703125,
        "y": 625.765625,
        "wires": [
            [
                "d572f1bb.7c351"
            ]
        ]
    },
    {
        "id": "d572f1bb.7c351",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "validate detail",
        "func": "var detail = msg.payload ;\n\n    if(isEmpty(detail)){\n        msg.api_status  = \"API_ERROR\";\n        msg.payload     = {status: 400, error: true, msg: \"Unable to find detail with this id\", data: null};\n    }else{\n        msg.api_status  = \"API_SUCCESS\";\n        msg.detail_obj      = detail[0] ;\n    }\nreturn msg;\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 2374.257883161308,
        "y": 625.1718678921463,
        "wires": [
            [
                "3c1e3fe9.6913a8"
            ]
        ]
    },
    {
        "id": "3c1e3fe9.6913a8",
        "type": "switch",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "property": "api_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_ERROR",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2538.742264375092,
        "y": 669.9843678921463,
        "wires": [
            [
                "87a3a22c.233588"
            ],
            [
                "435e75ce.440c4c"
            ]
        ]
    },
    {
        "id": "87a3a22c.233588",
        "type": "http response",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "x": 2675.1668701171875,
        "y": 638.6666870117188,
        "wires": []
    },
    {
        "id": "435e75ce.440c4c",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "isAuthorized",
        "func": "var detail_obj = msg.detail_obj;\n    user_obj   = msg.user_obj ;\n\nif(detail_obj.user_id === user_obj._id){\n    msg.api_status  = \"VALID_CONTENT\";\n    msg.payload     = {\n        _id                             : detail_obj._id,\n        _rev                            : detail_obj._rev,\n        table                           : \"details\",\n        task_id                         : detail_obj.task_id,\n        child_task_id                   : detail_obj.child_task_id,\n        user_id                         : detail_obj.user_id,\n        from_user_id                    : detail_obj.from_user_id,\n        page_id                         : detail_obj.page_id,\n        from_page_id                    : detail_obj.from_page_id,\n        to_page_id                      : detail_obj.to_page_id,\n        synchronized                    : detail_obj.synchronized,\n        processed                       : detail_obj.processed ,\n        status                          : detail_obj.status ,\n        read                            : detail_obj.read ,\n        display_if_empty                : 0 ,\n        date_created                    : detail_obj.date_created ,\n        offline_expiration_seconds      : detail_obj.offline_expiration_seconds ,\n        priority                        : detail_obj.priority ,\n        type                            : detail_obj.type,\n        image                           : detail_obj.image ,\n        from_user                       : detail_obj.from_user,\n        user_incoming                   : detail_obj.user_incoming,\n        watson_incoming                 : detail_obj.watson_incoming,\n        template                        : detail_obj.template ,\n        user_calculate                  : detail_obj.user_calculate,\n        location                        : detail_obj.location,\n        default                         : detail_obj.default,\n        createdAt                       : detail_obj.createdAt\n    };\n    msg.response    = {status: 200, error: false, msg: \"Record deleted successfully\", data: msg.payload};\n}else{\n    msg.api_status = \"INVALID_CONTENT\";\n    msg.statusCode = 403 ;\n    msg.payload = {status: 403, error: false, msg: \"You are not authorized to remove record\", data: null};    \n}\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 2695.8333740234375,
        "y": 696.3333740234375,
        "wires": [
            [
                "a2692ad3.49c638"
            ]
        ]
    },
    {
        "id": "a2692ad3.49c638",
        "type": "switch",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "property": "api_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "INVALID_CONTENT",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2852.8333740234375,
        "y": 696,
        "wires": [
            [
                "3830e3d8.82f1c4"
            ],
            [
                "2ae9e53b.388b9a",
                "e6290484.e7d098",
                "bea4f539.1d345",
                "838252a7.49064"
            ]
        ]
    },
    {
        "id": "3830e3d8.82f1c4",
        "type": "http response",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "x": 3038.500071207682,
        "y": 649.333356221517,
        "wires": []
    },
    {
        "id": "2ae9e53b.388b9a",
        "type": "cloudant out",
        "z": "e49ea6ba.2c95f8",
        "name": "save detail to master table",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "payonly": true,
        "operation": "insert",
        "x": 3099.500071207682,
        "y": 711.333371480306,
        "wires": []
    },
    {
        "id": "e6290484.e7d098",
        "type": "change",
        "z": "e49ea6ba.2c95f8",
        "name": "payload",
        "rules": [
            {
                "t": "move",
                "p": "response",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3053.500071207682,
        "y": 758.333371480306,
        "wires": [
            [
                "566b4020.f2f0b8"
            ]
        ]
    },
    {
        "id": "566b4020.f2f0b8",
        "type": "http response",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "x": 3211.500081380208,
        "y": 755.0000203450521,
        "wires": []
    },
    {
        "id": "bea4f539.1d345",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "payload",
        "func": "var detail = msg.payload ;\nmsg.payload = {\n    query   : \"table:details AND to_page_id:\" + detail.page_id ,\n    sort    : \"_id<string>\"\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 3057.500071207682,
        "y": 816.3332951863607,
        "wires": [
            [
                "572259f4.792e68"
            ]
        ]
    },
    {
        "id": "572259f4.792e68",
        "type": "cloudant in",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 3217.166748046875,
        "y": 817,
        "wires": [
            [
                "9e86d6f.c525128"
            ]
        ]
    },
    {
        "id": "9e86d6f.c525128",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "init",
        "func": "var filtered_details = msg.payload ;\n\nmsg.filtredArr = filtered_details || [] ;\nmsg.counter = 0;\nmsg.detail_length = filtered_details.length;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 3379.500081380208,
        "y": 816,
        "wires": [
            [
                "9f2fe801.a11128"
            ]
        ]
    },
    {
        "id": "9f2fe801.a11128",
        "type": "switch",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "property": "counter",
        "propertyType": "msg",
        "rules": [
            {
                "t": "lt",
                "v": "detail_length",
                "vt": "msg"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 3553.666819254557,
        "y": 753.3333867390951,
        "wires": [
            [
                "7a75112f.8b8788"
            ],
            [
                "fb1c96dc.ab4398"
            ]
        ]
    },
    {
        "id": "1a241ebb.a0d6f9",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "counter++",
        "func": "msg.counter++ ;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 3631.666819254557,
        "y": 674.3333867390951,
        "wires": [
            [
                "9f2fe801.a11128"
            ]
        ]
    },
    {
        "id": "7a75112f.8b8788",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "payload",
        "func": "msg.payload = msg.filtredArr[msg.counter];\nmsg.payload.display_if_empty = 0;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 3713.666819254557,
        "y": 744.3334172566732,
        "wires": [
            [
                "1a241ebb.a0d6f9",
                "69b1bbe8.d5020c"
            ]
        ]
    },
    {
        "id": "fb1c96dc.ab4398",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "Finish",
        "func": "msg.payload = \"Update all child details as well.\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 3703.666819254557,
        "y": 786.3334172566732,
        "wires": [
            [
                "d51f6fe0.0c5ed8"
            ]
        ]
    },
    {
        "id": "d51f6fe0.0c5ed8",
        "type": "debug",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "false",
        "x": 3880.666819254557,
        "y": 790.3334172566732,
        "wires": []
    },
    {
        "id": "69b1bbe8.d5020c",
        "type": "cloudant out",
        "z": "e49ea6ba.2c95f8",
        "name": "Update Detail",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "payonly": true,
        "operation": "insert",
        "x": 3898.666819254557,
        "y": 712.3333867390951,
        "wires": []
    },
    {
        "id": "838252a7.49064",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "payload",
        "func": "var detail = msg.payload ;\nmsg.payload = {\n    query   : \"table:user_task AND page_id:\" + detail.to_page_id + \"user_id:\" + detail.user_id ,\n    sort    : \"_id<string>\"\n};\n\nnode.warn(msg.payload);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 3057.500071207682,
        "y": 883.6667607625326,
        "wires": [
            [
                "a0fb287.78cf158"
            ]
        ]
    },
    {
        "id": "a0fb287.78cf158",
        "type": "cloudant in",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "cloudant": "",
        "database": "msater_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 3215.500071207682,
        "y": 881.3333257039388,
        "wires": [
            [
                "e8d96d70.4c5cf8"
            ]
        ]
    },
    {
        "id": "e8d96d70.4c5cf8",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "init",
        "func": "var user_tasks = msg.payload ;\n\nmsg.calculated_task = user_tasks || [];\nmsg.user_task_length = msg.calculated_task.length ;\nmsg.counter = 0 ;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 3378.500071207682,
        "y": 881.0000127156576,
        "wires": [
            [
                "74639e71.23066"
            ]
        ]
    },
    {
        "id": "74639e71.23066",
        "type": "switch",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "property": "counter",
        "propertyType": "msg",
        "rules": [
            {
                "t": "lt",
                "v": "user_task_length",
                "vt": "msg"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 3518.333567301432,
        "y": 879.3333867390951,
        "wires": [
            [
                "943ae80c.933918"
            ],
            [
                "699730bf.f78f3"
            ]
        ]
    },
    {
        "id": "c28a108d.53139",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "counter++",
        "func": "msg.counter++ ;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 3579.333567301432,
        "y": 827.3333867390951,
        "wires": [
            [
                "74639e71.23066"
            ]
        ]
    },
    {
        "id": "943ae80c.933918",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "payload",
        "func": "var user_task_obj = msg.calculated_task[msg.counter] ;\n\nuser_task_obj.status = 0   ;\nif(user_task_obj.count){\n    if(user_task_obj.count)    user_task_obj.count.active = 0 ;\n    if(user_task_obj.count)    user_task_obj.count.unread = 0 ;\n}\n\nmsg.payload = user_task_obj;\nreturn msg;\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "x": 3665.333567301432,
        "y": 871.3334172566732,
        "wires": [
            [
                "c28a108d.53139",
                "ff942491.18c6d8"
            ]
        ]
    },
    {
        "id": "699730bf.f78f3",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "Finish",
        "func": "msg.payload = \"User tasks updated successfully\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 3659.333567301432,
        "y": 916.3333867390951,
        "wires": [
            [
                "373611a7.7e01be"
            ]
        ]
    },
    {
        "id": "ff942491.18c6d8",
        "type": "cloudant out",
        "z": "e49ea6ba.2c95f8",
        "name": "user_task",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "payonly": true,
        "operation": "insert",
        "x": 3849.333567301432,
        "y": 870.3333867390951,
        "wires": []
    },
    {
        "id": "373611a7.7e01be",
        "type": "debug",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "false",
        "x": 3858.333567301432,
        "y": 914.3333867390951,
        "wires": []
    },
    {
        "id": "7e0622b8.f560f4",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "get_task",
        "func": "var params = msg.payload_content ;\n\nif(isEmpty(params.access_token)){\n    msg.api_status  = \"API_ERROR\";\n    msg.payload     = {status:400, error: true,  msg: \"`access_token` is required\", data: null};\n}else if(isEmpty(params.task_id)){\n    msg.api_status  = \"API_ERROR\";\n    msg.payload     = {status:400, error: true,  msg: \"`task_id` is required\", data: null};\n}else{\n    msg.api_status  = \"API_SUCCESS\";\n    msg.payload      = {\n        query : \"table:task_table AND _id:\"+ params.task_id,\n        sort  : \"_id<string>\"\n    };\n    msg.user_payload = {\n        query : \"table:users AND access_token:\"+ params.access_token,\n        sort  : \"_id<string>\"\n    };\n}\nreturn msg;\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 1216.140625,
        "y": 539.9882965087891,
        "wires": [
            [
                "6c399e93.9d44f8"
            ]
        ]
    },
    {
        "id": "6c399e93.9d44f8",
        "type": "switch",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "property": "api_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_ERROR",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 1449.6406105458739,
        "y": 610.1757782883942,
        "wires": [
            [
                "cd010ffb.4f51b8"
            ],
            [
                "e01d318f.b3cd3"
            ]
        ]
    },
    {
        "id": "cd010ffb.4f51b8",
        "type": "http response",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "x": 1582.6288917958739,
        "y": 576.4062430895866,
        "wires": []
    },
    {
        "id": "b8e43478.c28bc",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "validate task",
        "func": "var task_obj = msg.payload ;\n\nif(isEmpty(task_obj)){\n    msg.api_status = \"API_ERROR\";\n    msg.payload    = {status: 400, error: true, msg: \"Unable to find task with `task_id`\", data: null};\n}else{\n    msg.api_status = \"API_SUCCESS\";\n    msg.task_obj   = task_obj[0];\n    msg.payload    = msg.user_payload ;\n    node.warn(\"msg.payload\");\n    node.warn(msg.payload);\n}\n\nreturn msg;\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 1771.640625,
        "y": 716.24609375,
        "wires": [
            [
                "6afeed4d.be0444"
            ]
        ]
    },
    {
        "id": "e01d318f.b3cd3",
        "type": "cloudant in",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 1607.1328125,
        "y": 662.0546875,
        "wires": [
            [
                "b8e43478.c28bc"
            ]
        ]
    },
    {
        "id": "6afeed4d.be0444",
        "type": "switch",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "property": "api_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_ERROR",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 1935.3827918060126,
        "y": 714.9218680895866,
        "wires": [
            [
                "e1a28102.9bcd2"
            ],
            [
                "1bbe8862.b7ada"
            ]
        ]
    },
    {
        "id": "e1a28102.9bcd2",
        "type": "http response",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "x": 2075.3828125,
        "y": 673.90625,
        "wires": []
    },
    {
        "id": "facf232b.79e7a",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "validate user",
        "func": "var user_obj = msg.payload ;\n\nif(isEmpty(user_obj)){\n    msg.api_status = \"API_ERROR\";\n    msg.payload    = {status: 400, error: true, msg: \"Unable to find user with `access_token`\", data: null};\n    // msg.api_status = \"API_SUCCESS\";\n    // msg.payload = {status: 200, error: false, msg: \"Record fetched successfully\", data: msg.task_obj};\n}else{\n    msg.api_status = \"API_SUCCESS\";\n    msg.payload = {status: 200, error: false, msg: \"Record fetched successfully\", data: msg.task_obj};\n}\n\n\nreturn msg;\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 2268.375,
        "y": 773.4921875,
        "wires": [
            [
                "965f9c99.f3cd38"
            ]
        ]
    },
    {
        "id": "965f9c99.f3cd38",
        "type": "switch",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "property": "api_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_ERROR",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2426.375,
        "y": 779.4140625,
        "wires": [
            [
                "c44eb2de.292ec"
            ],
            [
                "c44eb2de.292ec"
            ]
        ]
    },
    {
        "id": "c44eb2de.292ec",
        "type": "http response",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "x": 2618.38671875,
        "y": 776.9062652587891,
        "wires": []
    },
    {
        "id": "b1da3b49.b457f",
        "type": "http response",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "x": 2289.0156860351562,
        "y": 728.0000610351562,
        "wires": []
    },
    {
        "id": "7b07167e.c074f8",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "update_task",
        "func": "// msg.payload_table = body.table ;\n// msg.payload_data  = body.table_data ;\n// msg.access_token  = body.access_token ;\nvar access_token = msg.access_token ;\n    \n    if(isEmpty(access_token)){\n        msg.api_status = \"API_ERROR\";\n        msg.payload = {status: 400, error: true, msg: \"`access_token` is missing.\", data: null};\n    }else{\n        msg.api_status = \"API_SUCCESS\";\n        msg.payload = {\n            query : \"table:users AND access_token:\" + access_token ,\n            sort  : \"_id<string>\"\n        };\n    }\n    \nreturn msg;\n\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 1298.015625,
        "y": 749,
        "wires": [
            [
                "df683bac.efd4b"
            ]
        ]
    },
    {
        "id": "19f4b7f4.88b17",
        "type": "cloudant out",
        "z": "e49ea6ba.2c95f8",
        "name": "Update record",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "payonly": true,
        "operation": "insert",
        "x": 2167.0156860351562,
        "y": 683.0001831054688,
        "wires": []
    },
    {
        "id": "dd661e8b.78c7f",
        "type": "change",
        "z": "e49ea6ba.2c95f8",
        "name": "api result",
        "rules": [
            {
                "t": "move",
                "p": "api_result",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2147.0156860351562,
        "y": 730.0000610351562,
        "wires": [
            [
                "b1da3b49.b457f"
            ]
        ]
    },
    {
        "id": "c7dad7ff.16c6a8",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "update_user",
        "func": "var req_body        = msg.payload_data ,\n    access_token    = msg.access_token ;\n\nif(isEmpty(access_token)){\n    msg.api_status = \"API_ERROR\" ;\n    msg.payload = {status: 400, error: true, msg: \"`access_token` is missing\", data: []};\n    return msg;\n    \n}else{\n    msg.api_status = \"API_SUCESS\" ;\n    msg.payload = {\n        query : \"table:\"+ req_body.table +\"AND access_token:\"+ access_token +\" AND _id:\" + req_body.user_id ,\n        sort  : \"_id<string>\"\n    };\n    msg.req_body = req_body;\n    return msg;\n}\n\n\nfunction isEmpty(obj){\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 1295.265625,
        "y": 866.25,
        "wires": [
            [
                "10835207.d904fe"
            ]
        ]
    },
    {
        "id": "10835207.d904fe",
        "type": "switch",
        "z": "e49ea6ba.2c95f8",
        "name": "split",
        "property": "API_STATUS",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "SUCESS",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 1442.265625,
        "y": 926.25,
        "wires": [
            [
                "7f8883ef.98501c"
            ],
            [
                "35c85f6c.f0ee3"
            ]
        ]
    },
    {
        "id": "48e7d63a.0774d8",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "update_short_detail",
        "func": "var body            = msg.payload_data ,\n    access_token    = msg.access_token ;\n    \nif(isEmpty(access_token)){\n    msg.api_status = \"API_ERROR\";\n    msg.api_status = {status: 400, error: true, msg: \"`access_token` is required to update detail\", data: body};\n}else if(isEmpty(body.detail_id)){\n    msg.api_status = \"API_ERROR\";\n    msg.api_status = {status: 400, error: true, msg: \"`detail_id` is required to update detail\", data: body};\n}else if(isEmpty(body.task_id)){\n    msg.api_status = \"API_ERROR\";\n    msg.api_status = {status: 400, error: true, msg: \"`task_id` is required to update task detail\", data: body};\n}else{\n    msg.api_status = \"API_SUCCESS\";\n    msg.payload = {\n        query : \"table:details AND _id:\" + body.detail_id ,\n        sort  : \"_id<string>\"\n    };\n    \n    msg.task_payload = {\n        query : \"table:task_table AND _id:\" + body.task_id ,\n        sort  : \"_id<string>\"\n    };\n}\n\nreturn msg;\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 1314.140625,
        "y": 1006.5,
        "wires": [
            [
                "e18e2d4b.77adc8"
            ]
        ]
    },
    {
        "id": "35c85f6c.f0ee3",
        "type": "cloudant in",
        "z": "e49ea6ba.2c95f8",
        "name": "User",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 1595.765625,
        "y": 929.25,
        "wires": [
            [
                "4c4f9af9.1a7594"
            ]
        ]
    },
    {
        "id": "4c4f9af9.1a7594",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "payload",
        "func": "var req_body = msg.req_body;\n    user_obj = msg.payload[0] ;\n\nif(isEmpty(user_obj)){\n    msg.api_status = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, msg: \"Unable to find user with `access_token` and `user_id`.\", data: req_body};    \n}else{\n    var payload ={\n      _id               : user_obj._id,\n      _rev              : user_obj._rev,\n      table             : user_obj.table,\n      long_url          : user_obj.long_url,\n      access_token      : user_obj.access_token ,\n      security_level    : user_obj.security_level,\n      phone             : Number(req_body.phone) || user_obj.phone ,\n      virtual_phone     : user_obj.virtual_phone,\n      email             : req_body.email || user_obj.email,\n      converstation_id  : user_obj.converstation_id || \"\",\n      firstname         : req_body.firstname || user_obj.firstname,\n      lastname          : req_body.lastname || user_obj.lastname,\n      code              : user_obj.code,\n      password          : user_obj.password,\n      image             : user_obj.image,\n      type              : user_obj.type,\n      device_id         : user_obj.device_id,\n      push_accepted     : user_obj.push_accepted\n    };\n    \n    msg.api_status = \"API_SUCCESS\";\n    msg.payload = payload ;\n    msg.api_result = {status: 200, error: false, msg: \"Record udpated successfully\", data: msg.payload};    \n}\n\nreturn msg;\n\nfunction isEmpty(obj){\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 1729.765625,
        "y": 928.25,
        "wires": [
            [
                "7ba72a8e.593a74"
            ]
        ]
    },
    {
        "id": "c154de15.9077e",
        "type": "cloudant out",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "payonly": true,
        "operation": "insert",
        "x": 2065.765869140625,
        "y": 875.25,
        "wires": []
    },
    {
        "id": "f8edde8b.5df6a8",
        "type": "change",
        "z": "e49ea6ba.2c95f8",
        "name": "api result",
        "rules": [
            {
                "t": "move",
                "p": "api_result",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2057.7657470703125,
        "y": 918.25,
        "wires": [
            [
                "3da69c34.ee4274"
            ]
        ]
    },
    {
        "id": "3da69c34.ee4274",
        "type": "http response",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "x": 2237.765869140625,
        "y": 917.25,
        "wires": []
    },
    {
        "id": "7f8883ef.98501c",
        "type": "http response",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "x": 1594.62890625,
        "y": 885.41015625,
        "wires": []
    },
    {
        "id": "1bbe8862.b7ada",
        "type": "cloudant in",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 2095,
        "y": 742,
        "wires": [
            [
                "facf232b.79e7a"
            ]
        ]
    },
    {
        "id": "a4f13815.b0fe48",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "else case",
        "func": "msg.payload = {staus: 400, error: true, msg:\"Un specified table type\", data: null};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1240.83349609375,
        "y": 1324.000244140625,
        "wires": [
            [
                "5cc228f7.fcd0b"
            ]
        ]
    },
    {
        "id": "5cc228f7.fcd0b",
        "type": "http response",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "x": 1379.8334045410156,
        "y": 1325.6669184366863,
        "wires": []
    },
    {
        "id": "838bf1ee.c1fd88",
        "type": "change",
        "z": "e49ea6ba.2c95f8",
        "name": "detail_payload",
        "rules": [
            {
                "t": "move",
                "p": "detail_payload",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2599.500244140625,
        "y": 93.00000762939453,
        "wires": [
            [
                "aa4a6956.fe0018"
            ]
        ]
    },
    {
        "id": "2e261587.96cd5a",
        "type": "change",
        "z": "e49ea6ba.2c95f8",
        "name": "detail_arr",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "details_arr",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2993.833251953125,
        "y": 96.66666412353516,
        "wires": [
            [
                "c8af2e68.1fd53"
            ]
        ]
    },
    {
        "id": "a387d87a.359278",
        "type": "debug",
        "z": "af6617e3.50aa38",
        "name": "login page return again",
        "active": true,
        "console": "false",
        "complete": "payload",
        "x": 965.833438873291,
        "y": 1051.0000524520874,
        "wires": []
    },
    {
        "id": "f27ac629.e98548",
        "type": "debug",
        "z": "af6617e3.50aa38",
        "name": "menu page return ",
        "active": true,
        "console": "false",
        "complete": "payload",
        "x": 1285.8335189819336,
        "y": 980.0000629425049,
        "wires": []
    },
    {
        "id": "96c62f5d.c1b21",
        "type": "debug",
        "z": "e49ea6ba.2c95f8",
        "name": "Comes her to log every thing",
        "active": true,
        "console": "true",
        "complete": "true",
        "x": 2847.8333435058594,
        "y": 224.3333511352539,
        "wires": []
    },
    {
        "id": "aa4a6956.fe0018",
        "type": "cloudant in",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 2796.33349609375,
        "y": 96.66666412353516,
        "wires": [
            [
                "2e261587.96cd5a"
            ]
        ]
    },
    {
        "id": "ca78d31a.4ecc58",
        "type": "switch",
        "z": "af6617e3.50aa38",
        "name": "",
        "property": "api_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_SUCCESS",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 699.8333435058594,
        "y": 733.6667175292969,
        "wires": [
            [
                "7594a021.c3e068"
            ],
            [
                "95694690.c42d6",
                "36e56878.f61d38"
            ]
        ]
    },
    {
        "id": "95694690.c42d6",
        "type": "http response",
        "z": "af6617e3.50aa38",
        "name": "",
        "x": 894.8334197998047,
        "y": 698.6667041778564,
        "wires": []
    },
    {
        "id": "7ba72a8e.593a74",
        "type": "switch",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "property": "api_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_SUCCESS",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 1868.5,
        "y": 927.6666870117188,
        "wires": [
            [
                "c154de15.9077e",
                "f8edde8b.5df6a8"
            ],
            [
                "a01cd629.868e9"
            ]
        ]
    },
    {
        "id": "a01cd629.868e9",
        "type": "http response",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "x": 2047.5001932779949,
        "y": 982.9999974568685,
        "wires": []
    },
    {
        "id": "e18e2d4b.77adc8",
        "type": "switch",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "property": "api_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_SUCCESS",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 1483.8333740234375,
        "y": 1006.3333740234375,
        "wires": [
            [
                "6d963dc2.679144"
            ],
            [
                "263f1466.fbe094"
            ]
        ]
    },
    {
        "id": "6d963dc2.679144",
        "type": "cloudant in",
        "z": "e49ea6ba.2c95f8",
        "name": "master_table",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 1637.5,
        "y": 999.3333740234375,
        "wires": [
            [
                "1c207205.904e6e"
            ]
        ]
    },
    {
        "id": "263f1466.fbe094",
        "type": "http response",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "x": 1617.5000101725261,
        "y": 1041.333351135254,
        "wires": []
    },
    {
        "id": "1c207205.904e6e",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "detail_processing",
        "func": "if(isEmpty(msg.payload)){\n    msg.api_status = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, msg: \"Unable to fetch detail using with detail_id\", data: null};\n}else{\n    msg.api_status = \"API_SUCCESS\";\n    var detail_obj = msg.payload[0] ,\n        req_body   = msg.payload_data;\n        \n    //for user_incoming from detail_obj\n    detail_obj.user_incoming.note    = req_body.message ;\n    detail_obj.user_incoming.message = req_body.message ;\n    \n    //for watson_incoming from detail_obj\n    detail_obj.watson_incoming.note    = req_body.message ;\n    detail_obj.watson_incoming.message = req_body.message ;\n        \n    msg.payload = detail_obj;\n}\nreturn msg;\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 1825.5,
        "y": 1037.6666870117188,
        "wires": [
            [
                "b95e89ba.d73c7"
            ]
        ]
    },
    {
        "id": "b95e89ba.d73c7",
        "type": "switch",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "property": "api_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_SUCCESS",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 1963.5,
        "y": 1092,
        "wires": [
            [
                "c6f40e50.02806",
                "fbbcb12.5eac55"
            ],
            [
                "9db0580b.d421"
            ]
        ]
    },
    {
        "id": "9db0580b.d421",
        "type": "http response",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "x": 2101.50048828125,
        "y": 1137.3333740234375,
        "wires": []
    },
    {
        "id": "c6f40e50.02806",
        "type": "cloudant out",
        "z": "e49ea6ba.2c95f8",
        "name": "update_detail_master_table",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "payonly": true,
        "operation": "insert",
        "x": 2171.5003662109375,
        "y": 1038.6666870117188,
        "wires": []
    },
    {
        "id": "fbbcb12.5eac55",
        "type": "change",
        "z": "e49ea6ba.2c95f8",
        "name": "task_payload",
        "rules": [
            {
                "t": "move",
                "p": "task_payload",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2118.5001220703125,
        "y": 1085.6666259765625,
        "wires": [
            [
                "ff2b604a.513cb"
            ]
        ]
    },
    {
        "id": "ff2b604a.513cb",
        "type": "cloudant in",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 2272.166748046875,
        "y": 1128,
        "wires": [
            [
                "65f0bedf.2bea3"
            ]
        ]
    },
    {
        "id": "65f0bedf.2bea3",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "task_processing",
        "func": "if(isEmpty(msg.payload)){\n    msg.api_status = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, msg: \"Detail has been updated but Unable to fetch task_obj using with task_id\", data: null};\n}else{\n    msg.api_status = \"API_SUCCESS\";\n    var task_obj = msg.payload[0] ,\n        req_body   = msg.payload_data;\n        \n    //from detail_obj\n    task_obj.task_name  = req_body.task_name ;\n    task_obj.status     = JSON.parse(req_body.task_status) ? 1 : 0 ;\n        \n    msg.payload = task_obj;\n}\nreturn msg;\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 2451.0001220703125,
        "y": 1127,
        "wires": [
            [
                "ae743f71.4c9e9"
            ]
        ]
    },
    {
        "id": "ae743f71.4c9e9",
        "type": "switch",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "property": "api_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_SUCCESS",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2614.3336181640625,
        "y": 1126,
        "wires": [
            [
                "b7e294a2.029438",
                "1a05cf20.f25629"
            ],
            [
                "e0c251c1.ba9628"
            ]
        ]
    },
    {
        "id": "b7e294a2.029438",
        "type": "cloudant out",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "payonly": true,
        "operation": "insert",
        "x": 2798.166748046875,
        "y": 1094.3333740234375,
        "wires": []
    },
    {
        "id": "e0c251c1.ba9628",
        "type": "http response",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "x": 2781.166748046875,
        "y": 1184.6666259765625,
        "wires": []
    },
    {
        "id": "1a05cf20.f25629",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "res",
        "func": "msg.payload = {status: 200, error: false, msg: \"Record updated successfully\", data: msg.payload};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2779.166748046875,
        "y": 1134.3333740234375,
        "wires": [
            [
                "57495bf1.d424bc"
            ]
        ]
    },
    {
        "id": "57495bf1.d424bc",
        "type": "http response",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "x": 2910.1667378743487,
        "y": 1134.6666844685874,
        "wires": []
    },
    {
        "id": "ceff2481.58ec4",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "formatted_user",
        "func": "msg.payload = {\n    query: \"table:users\",\n    sort : \"_id<string>\"\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1266,
        "y": 774.3333740234375,
        "wires": [
            [
                "684d89d6.75e1f"
            ]
        ]
    },
    {
        "id": "81a9737c.8c3538",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "formatted_timeout",
        "func": "msg.payload = {\n    query: \"table:timeout\",\n    sort : \"_id<string>\"\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1273,
        "y": 829.3333740234375,
        "wires": [
            [
                "ac60093f.16a0d8"
            ]
        ]
    },
    {
        "id": "7169cd86.26438c",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "formatted_location",
        "func": "msg.payload = {\n    query: \"table:location\",\n    sort : \"_id<string>\"\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1273,
        "y": 882.3333740234375,
        "wires": [
            [
                "32d45afc.439f76"
            ]
        ]
    },
    {
        "id": "348f0a42.759d4e",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "formatted_task",
        "func": "msg.payload = {\n    query: \"table:task_table\",\n    sort : \"_id<string>\"\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1262,
        "y": 932.3333740234375,
        "wires": [
            [
                "8548fdff.1d5eb8"
            ]
        ]
    },
    {
        "id": "8548fdff.1d5eb8",
        "type": "cloudant in",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 1479,
        "y": 929.3333740234375,
        "wires": [
            [
                "6459d7fb.998d78"
            ]
        ]
    },
    {
        "id": "32d45afc.439f76",
        "type": "cloudant in",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 1479,
        "y": 881.3333740234375,
        "wires": [
            [
                "415d8df.2520974"
            ]
        ]
    },
    {
        "id": "ac60093f.16a0d8",
        "type": "cloudant in",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 1477,
        "y": 835.3333740234375,
        "wires": [
            [
                "ffd19b3c.f00088"
            ]
        ]
    },
    {
        "id": "684d89d6.75e1f",
        "type": "cloudant in",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 1474,
        "y": 780.3333740234375,
        "wires": [
            [
                "518f0758.972ab8"
            ]
        ]
    },
    {
        "id": "518f0758.972ab8",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "response",
        "func": "var users   = msg.payload , updated_user = [];\n\nif(users === null || users === undefined){\n    msg.payload = {status: 400, error: true, msg: \"Validation error\", data: []};\n}else if(!users.length){\n    msg.payload = {status: 200, error: false, msg: \"No record found\", data: users};\n}else{\n    for(var i=0; i< users.length; i++){\n        updated_user.push({id : users[i]._id, name: generate_name(users[i]) || 'N/A'});\n    }\n    msg.payload = {status: 200, error: false, msg: \"Record fetched successfully\", data: updated_user};\n}\n\nreturn msg;\n\nfunction generate_name(obj){\n    return (obj.firstname + \" \" + obj.lastname).trim();\n}",
        "outputs": 1,
        "noerr": 0,
        "x": 1673,
        "y": 779.3333740234375,
        "wires": [
            [
                "4bdcca8b.e236cc"
            ]
        ]
    },
    {
        "id": "ffd19b3c.f00088",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "response",
        "func": "var timeout   = msg.payload , updated_timeout = [];\n\nif(timeout === null || timeout === undefined){\n    msg.payload = {status: 400, error: true, msg: \"Validation error\", data: []};\n}else if(!timeout.length){\n    msg.payload = {status: 200, error: false, msg: \"No record found\", data: timeout};\n}else{\n    for(var i=0; i< timeout.length; i++){\n        updated_timeout.push({id : timeout[i]._id, name: timeout[i].name || 'N/A'});\n    }\n    msg.payload = {status: 200, error: false, msg: \"Record fetched successfully\", data: updated_timeout};\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1673,
        "y": 832.3333740234375,
        "wires": [
            [
                "510e3b12.fb031c"
            ]
        ]
    },
    {
        "id": "415d8df.2520974",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "response",
        "func": "var location   = msg.payload , updated_location = [];\n\nif(location === null || location === undefined){\n    msg.payload = {status: 400, error: true, msg: \"Validation error\", data: []};\n}else if(!location.length){\n    msg.payload = {status: 200, error: false, msg: \"No record found\", data: location};\n}else{\n    for(var i=0; i< location.length; i++){\n        updated_location.push({id : location[i]._id, name: location[i].location_name || 'N/A'});\n    }\n    msg.payload = {status: 200, error: false, msg: \"Record fetched successfully\", data: updated_location};\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1670,
        "y": 879.3333740234375,
        "wires": [
            [
                "cc0dbb78.1b92a8"
            ]
        ]
    },
    {
        "id": "6459d7fb.998d78",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "response",
        "func": "var tasks_arr = msg.payload , obj = {} ;\n\nif(tasks_arr === null || tasks_arr === undefined){\n    obj.status = 400 ;\n    obj.error  = true ;\n    obj.msg    = \"Unable to get the tasks\";\n    msg.paylod = obj ;\n}else{\n    if(tasks_arr.length){\n        var tasks = [];\n        for(var i=0; i < tasks_arr.length; i++){\n            tasks.push({\n                id           : tasks_arr[i]._id,\n                task_name    : tasks_arr[i].task_name || \"N/A\"     \n            });\n        }\n        obj.status = 200 ;\n        obj.error  = false ;\n        obj.msg    = \"Record fecthed successfully\";\n        obj.data   = tasks ;\n        msg.payload = obj ;\n    }else{\n        obj.status = 200 ;\n        obj.error  = false ;\n        obj.msg    = \"There is not task present\";\n        msg.paylod = obj ;\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1675,
        "y": 929.3333740234375,
        "wires": [
            [
                "31156967.6be1be"
            ]
        ]
    },
    {
        "id": "31156967.6be1be",
        "type": "http response",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "x": 1857,
        "y": 927.3333740234375,
        "wires": []
    },
    {
        "id": "cc0dbb78.1b92a8",
        "type": "http response",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "x": 1853,
        "y": 880.3333740234375,
        "wires": []
    },
    {
        "id": "510e3b12.fb031c",
        "type": "http response",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "x": 1853,
        "y": 830.3333740234375,
        "wires": []
    },
    {
        "id": "4bdcca8b.e236cc",
        "type": "http response",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "x": 1854,
        "y": 777.3333740234375,
        "wires": []
    },
    {
        "id": "5da7f6ff.9e3fd8",
        "type": "http response",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "x": 1662.166748046875,
        "y": 1024.666748046875,
        "wires": []
    },
    {
        "id": "cd835384.849fd",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "get_all_templates",
        "func": "msg.payload = {\n    query: \"table:template\",\n    sort : \"_id<string>\"\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1264.1666768391929,
        "y": 1029.0000381469727,
        "wires": [
            [
                "f09feb77.800168"
            ]
        ]
    },
    {
        "id": "f09feb77.800168",
        "type": "cloudant in",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 1485.1666259765625,
        "y": 1027.0001220703125,
        "wires": [
            [
                "5da7f6ff.9e3fd8"
            ]
        ]
    },
    {
        "id": "60bfa415.b955d4",
        "type": "http in",
        "z": "49d0aa55.a20f54",
        "name": "",
        "url": "/master_table",
        "method": "get",
        "swaggerDoc": "",
        "x": 152.8333282470703,
        "y": 206.33334350585938,
        "wires": [
            [
                "dda713d5.323718"
            ]
        ]
    },
    {
        "id": "371f61e1.c86206",
        "type": "http response",
        "z": "49d0aa55.a20f54",
        "name": "",
        "x": 616.8333129882812,
        "y": 195.3333282470703,
        "wires": []
    },
    {
        "id": "dda713d5.323718",
        "type": "cloudant in",
        "z": "49d0aa55.a20f54",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_all_",
        "design": "",
        "index": "",
        "x": 362.8333435058594,
        "y": 210.33333587646484,
        "wires": [
            [
                "371f61e1.c86206"
            ]
        ]
    },
    {
        "id": "b763ab20.37e378",
        "type": "debug",
        "z": "e49ea6ba.2c95f8",
        "name": "create user_task after creating detail",
        "active": true,
        "console": "false",
        "complete": "payload",
        "x": 4559.833740234375,
        "y": 595.6667022705078,
        "wires": []
    },
    {
        "id": "af8cd2.3096ab3",
        "type": "ibmpush",
        "z": "49d0aa55.a20f54",
        "name": "",
        "ApplicationID": "12312259665 ",
        "identifiers": "",
        "notification": "deviceid",
        "mode": "SANDBOX",
        "x": 515.8333435058594,
        "y": 361.99999237060547,
        "wires": []
    },
    {
        "id": "b9828519.21f1c",
        "type": "inject",
        "z": "49d0aa55.a20f54",
        "name": "start",
        "topic": "start",
        "payload": "Start",
        "payloadType": "flow",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 136.8333282470703,
        "y": 360.6666488647461,
        "wires": [
            [
                "dde6e574.d61268"
            ]
        ]
    },
    {
        "id": "dde6e574.d61268",
        "type": "function",
        "z": "49d0aa55.a20f54",
        "name": "payload",
        "func": "    msg.payload = {\n        \"message\": {\n            \"alert\": \"Hello World from an SMS message using node-red platoform.\"\n        }\n    };\n    msg.notificationType = 3 ;\n    msg.identifiers= \"89a5847f-3d15-301c-924f-c0b0cf0ac493\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 328.8333435058594,
        "y": 360.6666488647461,
        "wires": [
            [
                "af8cd2.3096ab3",
                "9b9e9777.70d02"
            ]
        ]
    },
    {
        "id": "9b9e9777.70d02",
        "type": "debug",
        "z": "49d0aa55.a20f54",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "true",
        "x": 501.8333435058594,
        "y": 408.33333587646484,
        "wires": []
    },
    {
        "id": "85c21473.232b98",
        "type": "inject",
        "z": "49d0aa55.a20f54",
        "name": "start",
        "topic": "start",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 131.8333282470703,
        "y": 513.6666488647461,
        "wires": [
            [
                "23384a18.99511e"
            ]
        ]
    },
    {
        "id": "23384a18.99511e",
        "type": "function",
        "z": "49d0aa55.a20f54",
        "name": "payload",
        "func": "// url, if set, is used as the url of the request. Must start with http: or https:\n// method, if set, is used as the HTTP method of the request. Must be one of GET, PUT, POST, PATCH or DELETE (default: GET)\n// headers, if set, should be an object containing field/value pairs to be added as request headers\n// payload is sent as the body of the request\n\n\nmsg.url = \"https://mobile.ng.bluemix.net/imfpush/v1/apps/3d321d52-0b21-485a-8669-7e19684b070b/messages\";\nmsg.method = \"POST\";\nmsg.headers = {\n    \"appSecret\": \"26328303-fc96-4379-a53c-7b2dbad74b00\"\n};\nmsg.payload = {\n    message: {\n        alert: \"Hello World from an SMS message using node-red rest api client.\"\n    },\n    notificationType: 3,\n    target: {\n        deviceIds: [\"89a5847f-3d15-301c-924f-c0b0cf0ac493\", \"93ab767a-dc15-3089-9cd0-372ff3403c66\"]\n    }\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 320.8333435058594,
        "y": 512.0000381469727,
        "wires": [
            [
                "5afde7fb.56e598",
                "4b95503.69894b"
            ]
        ]
    },
    {
        "id": "5afde7fb.56e598",
        "type": "http request",
        "z": "49d0aa55.a20f54",
        "name": "",
        "method": "use",
        "ret": "obj",
        "url": "",
        "tls": "",
        "x": 494.8333435058594,
        "y": 511.33336639404297,
        "wires": [
            [
                "63aa710b.29bc48"
            ]
        ]
    },
    {
        "id": "63aa710b.29bc48",
        "type": "debug",
        "z": "49d0aa55.a20f54",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "false",
        "x": 673.8333435058594,
        "y": 511.00003814697266,
        "wires": []
    },
    {
        "id": "4b95503.69894b",
        "type": "debug",
        "z": "49d0aa55.a20f54",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "false",
        "x": 488.8333435058594,
        "y": 564.0000839233398,
        "wires": []
    },
    {
        "id": "25d335c6.7a472a",
        "type": "comment",
        "z": "49d0aa55.a20f54",
        "name": "Not Working:- Below flow is not-working with IBM push node. So used Rest Api to send push notification to particular device.",
        "info": "Below flow is notworking with IBM push so used Rest Api to send push notification to particular device.",
        "x": 470.8333435058594,
        "y": 306.6666488647461,
        "wires": []
    },
    {
        "id": "a13f3d25.425918",
        "type": "comment",
        "z": "49d0aa55.a20f54",
        "name": "Working:- Following Flow is working with the rest endpoint and is working well to send push notification to particular device.",
        "info": "Below flow is notworking with IBM push so used Rest Api to send push notification to particular device.",
        "x": 464.6666564941406,
        "y": 461.6666564941406,
        "wires": []
    },
    {
        "id": "5a5d0999.634d88",
        "type": "switch",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "property": "api_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_SUCCESS",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 1598.1666259765625,
        "y": 749.6666870117188,
        "wires": [
            [
                "b7a24634.45c9f8"
            ],
            [
                "465519e9.49237"
            ]
        ]
    },
    {
        "id": "465519e9.49237",
        "type": "http response",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "x": 1722,
        "y": 790.3333740234375,
        "wires": []
    },
    {
        "id": "b7a24634.45c9f8",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "payload & verify user",
        "func": "var task_obj = msg.payload_data;\n\nif(isEmpty(msg.payload)){\n    msg.api_status = \"API_ERROR\";\n    msg.payload    = {status: 400, error: true, msg: \"Invalid access_token, Unable to find user with this access_token.\", data: null};\n}else{\n    \n    var user = msg.payload[0];\n    if(user._id === task_obj.user_id){\n        msg.api_status = \"API_SUCCESS\";\n        msg.payload = {\n            _id                         : task_obj._id,\n            _rev                        : task_obj._rev,\n            table                       : task_obj.table, \n            task_name                   : task_obj.task_name,\n            user_id                     : task_obj.user_id,\n            page_id                     : task_obj.page_id,\n            from_page_id                : task_obj.from_page_id,\n            parent_id                   : task_obj.parent_id,\n            header_template_id          : task_obj.header_template_id,\n            detail_template_id          : task_obj.detail_template_id,\n            footer_template_id          : task_obj.footer_template_id,\n            timeout_id                  : task_obj.timeout_id,\n            child_default_task_id       : task_obj.child_default_task_id,\n            child_default_task_name     : task_obj.child_default_task_name,\n            date_created                : task_obj.date_created,\n            type                        : task_obj.type,\n            status                      : task_obj.status,\n            category                    : task_obj.category,\n            additional_data_fn          : task_obj.additional_data_fn,\n            optional_data               : task_obj.optional_data,\n            required_data               : task_obj.required_data,\n            offline_expiration_time     : task_obj.offline_expiration_time,\n            display_if_empty            : task_obj.display_if_empty,\n            image                       : task_obj.image\n        };\n        msg.api_result = {status: 200, error: false, msg: \"Record udpated successfully\", data: msg.payload};\n    }else{\n        msg.api_status = \"API_ERROR\";\n        msg.payload    = {status: 400, error: true, msg: \"You are not authrozied to update this record.\", data: null};\n    }\n}\nreturn msg;\n\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 1772.1666768391929,
        "y": 742.6666437784831,
        "wires": [
            [
                "5d6000ae.2c1f1"
            ]
        ]
    },
    {
        "id": "5d6000ae.2c1f1",
        "type": "switch",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "property": "api_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_SUCCESS",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 1951.8334350585938,
        "y": 743.6666870117188,
        "wires": [
            [
                "19f4b7f4.88b17",
                "dd661e8b.78c7f"
            ],
            [
                "cff217f0.637ca8"
            ]
        ]
    },
    {
        "id": "cff217f0.637ca8",
        "type": "http response",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "x": 2138.666748046875,
        "y": 778.3333435058594,
        "wires": []
    },
    {
        "id": "df683bac.efd4b",
        "type": "cloudant in",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 1458.1666259765625,
        "y": 748.3333129882812,
        "wires": [
            [
                "5a5d0999.634d88"
            ]
        ]
    },
    {
        "id": "3d2ffc0.0712184",
        "type": "comment",
        "z": "af6617e3.50aa38",
        "name": "Following code referes to \"/api/verfiy\" endpoint. which whill check if verfiy code is valid or not if valid then re-direct to Category screen else re-direct back to login screen",
        "info": "",
        "x": 567.2421875,
        "y": 638.59375,
        "wires": []
    },
    {
        "id": "4de2c636.87f3a",
        "type": "comment",
        "z": "af6617e3.50aa38",
        "name": "Login `/api/login` flow is following. To check existing number , send verification code, re-direct to verification screen are done by following code.",
        "info": "",
        "x": 503.2421875,
        "y": 76.6015625,
        "wires": []
    },
    {
        "id": "6b3a000a.158e98",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "search",
        "func": "var query = msg.payload_content.query;\nmsg.payload = {\n    query   : \"table:users\",\n    sort: \"_id<string>\"\n};\nreturn msg;\n\n",
        "outputs": 1,
        "noerr": 0,
        "x": 1228.6367089152336,
        "y": 1137.5234279073775,
        "wires": [
            [
                "33e68751.719d3"
            ]
        ]
    },
    {
        "id": "26f84ccc.8cfa5c",
        "type": "http response",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "x": 1670.38671875,
        "y": 1134.171875,
        "wires": []
    },
    {
        "id": "c31e3f62.ff00b",
        "type": "inject",
        "z": "49d0aa55.a20f54",
        "name": "start",
        "topic": "start",
        "payload": "start",
        "payloadType": "flow",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 131.625,
        "y": 699.86328125,
        "wires": [
            [
                "34c95a5c.e5e72e"
            ]
        ]
    },
    {
        "id": "34c95a5c.e5e72e",
        "type": "function",
        "z": "49d0aa55.a20f54",
        "name": "query",
        "func": "msg.payload = {\n    //query   : \"table:users\",\n    selector: {\n        virtual_phone: {\n            \"$regex\": 7696016749\n        }\n    },\n    sort: \"_id<string>\"\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 282.640625,
        "y": 749.0234375,
        "wires": [
            [
                "607a2055.fe9e5"
            ]
        ]
    },
    {
        "id": "607a2055.fe9e5",
        "type": "cloudant in",
        "z": "49d0aa55.a20f54",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 458.640625,
        "y": 747.0703174360096,
        "wires": [
            [
                "410b598b.37cd78"
            ]
        ]
    },
    {
        "id": "410b598b.37cd78",
        "type": "debug",
        "z": "49d0aa55.a20f54",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "false",
        "x": 633.63671875,
        "y": 752.20703125,
        "wires": []
    },
    {
        "id": "33e68751.719d3",
        "type": "cloudant in",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 1379.1328125,
        "y": 1137.33203125,
        "wires": [
            [
                "cb34f308.e34588"
            ]
        ]
    },
    {
        "id": "cb34f308.e34588",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "res",
        "func": "var response = msg.payload;\n    query    = msg.payload_content.query ;\nif(isEmpty(response)){\n    msg.payload = {status: 200, error: false, msg: \"No Record found.\", data: []};\n}else{\n    if(response.length){\n        var users = [] ;\n        for(var i=0; i < response.length; i++){\n            if(response[i].virtual_phone){\n                if(response[i].virtual_phone.toString().search(query.toString()) > - 1){\n                    users.push(response[i]);\n                }\n            }\n        }\n        msg.payload = {status: 200, error: false, msg: \"Record fetched successfully\", data: users};    \n    }else{\n        msg.payload = {status: 200, error: false, msg: \"No Record found.\", data: []};\n    }\n}\nreturn msg;\n\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 1530.12890625,
        "y": 1136.7734375,
        "wires": [
            [
                "26f84ccc.8cfa5c"
            ]
        ]
    },
    {
        "id": "e1de60ba.2474d8",
        "type": "comment",
        "z": "49d0aa55.a20f54",
        "name": "Working:- This endpoint is used to get all records which is in master_table. We need this record while testing the various functionality like, counts and so on,",
        "info": "",
        "x": 570.62890625,
        "y": 128.2265625,
        "wires": []
    },
    {
        "id": "92669ca6.34be28",
        "type": "comment",
        "z": "49d0aa55.a20f54",
        "name": "Working: This test flows is used to test the search functionality by keyword as google does (Seach by keyword like 12 and so on).",
        "info": "",
        "x": 472.640625,
        "y": 638.2265575639904,
        "wires": []
    },
    {
        "id": "14dbeffe.488bf8",
        "type": "switch",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "property": "doCreate_optional_detail",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2611.390625,
        "y": 412.94140625,
        "wires": [
            [
                "d1c27c8c.6bffb"
            ],
            [
                "3be1a016.8a275"
            ]
        ]
    },
    {
        "id": "d1c27c8c.6bffb",
        "type": "change",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "option_detail",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2806.375,
        "y": 404.42578125,
        "wires": [
            [
                "cc636a5e.2f98d"
            ]
        ]
    },
    {
        "id": "cc636a5e.2f98d",
        "type": "cloudant out",
        "z": "e49ea6ba.2c95f8",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "payonly": true,
        "operation": "insert",
        "x": 3009.38671875,
        "y": 403.79296875,
        "wires": []
    },
    {
        "id": "3be1a016.8a275",
        "type": "function",
        "z": "e49ea6ba.2c95f8",
        "name": "Log",
        "func": "node.warn(\"No need to create optional second task.\");\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2749.378876615316,
        "y": 442.75780855119234,
        "wires": [
            []
        ]
    },
    {
        "id": "1fd2b2bb.fff11d",
        "type": "http in",
        "z": "26c98005.8e65c",
        "name": "",
        "url": "/test_get_page",
        "method": "get",
        "swaggerDoc": "",
        "x": 95,
        "y": 43.05078125,
        "wires": [
            [
                "1b7fcc79.44fffc"
            ]
        ]
    },
    {
        "id": "1b7fcc79.44fffc",
        "type": "function",
        "z": "26c98005.8e65c",
        "name": "get_page_view",
        "func": "var params = msg.payload ;\n\nif(isEmpty(params.access_token)){\n    msg.api_status    = \"API_ERROR\";\n    msg.payload       = {status: 400, error: true, msg: \"`access_token` is required to get_page.\", data: null};\n}else if(isEmpty(params.page_id)){\n    msg.api_status    = \"API_ERROR\";\n    msg.payload       = {status: 400, error: true, msg: \"`page_id` is required to get_page.\", data: null};\n}else{\n    msg.api_status    = \"API_SUCCESS\";\n    msg.req_data = msg.payload;\n    msg.method = \"GET\";\n    msg.url = 'https://37924750-e42d-41f1-b52e-f70ee3d5e012-bluemix.cloudant.com/master_table/_design/filterBy/_view/get_page?key=[' + params.page_id  + ']';\n}\n\nreturn msg;\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 287.625,
        "y": 108.5703125,
        "wires": [
            [
                "11257aa7.8b7d2d"
            ]
        ]
    },
    {
        "id": "dea6623a.cda5a8",
        "type": "http request",
        "z": "26c98005.8e65c",
        "name": "",
        "method": "use",
        "ret": "obj",
        "url": "",
        "tls": "",
        "x": 613.6328430175781,
        "y": 71.2578125,
        "wires": [
            [
                "1369cd81.0ef0aa"
            ]
        ]
    },
    {
        "id": "d040d7.feaa9f28",
        "type": "function",
        "z": "26c98005.8e65c",
        "name": "populate_page",
        "func": "var page_data = msg.get_page_view, \n    records = forumlate_data(page_data);\n    \n    msg.payload = records ;\n    return msg;\n\nfunction forumlate_data(db_obj){\n    if(isEmpty(db_obj)){\n        msg.payload = {status: 400, error: true, msg: \"No record found.\", data: null};\n    }else{\n        if(isEmpty(db_obj.rows)){\n            msg.payload = {status: 400, error: true, msg: \"No record found.\", data: null};\n        }else{\n            var res_obj = formulate_page_data(db_obj.rows),\n                user    = formulate_user(msg.user_obj);\n\n            return {\n                page_id : msg.req_data.page_id,\n                user    : user,\n                task    : res_obj.task ,\n                details : res_obj.details\n            };\n        }\n    }\n}\n\nfunction formulate_user(obj){\n    var user = {};\n    if(isEmpty(obj.rows)){\n        return {};\n    }else{\n        for(var i=0; i<obj.rows.length; i++){\n            user.user_id = obj.rows[i].value._id ;\n            user.firstname = obj.rows[i].value.firstname || \"\" ;\n            user.lastname = obj.rows[i].value.lastname || \"\";\n            user.email = obj.rows[i].value.email || \"\";\n            user.phone = obj.rows[i].value.phone || \"\";\n            user.virtual_phone = obj.rows[i].value.virtual_phone || \"\";\n            user.type = obj.rows[i].value.type || {};\n        }\n    }\n    return user;\n}\n\nfunction formulate_page_data(rows){\n    var task_obj = {}, details= [];\n    for(var i=0; i < rows.length; i++){\n        if(rows[i].value.table == \"task_table\"){\n            task_obj = {\n                \"task_id\":\t\t    rows[i].value._id,\n                \"task_name\":\t\trows[i].value.task_name,\n                \"parent_id\":        rows[i].value.parent_id,\n                \"template\": \t\t{\n                    \"header_template\" : formulate_template(rows[i].value.header_template_id),\n                    \"detail_template\" : formulate_template(rows[i].value.detail_template_id),\n                    \"footer_template\" : formulate_template(rows[i].value.footer_template_id)\n                },\n                \"from_page_id\":\t\trows[i].value.from_page_id,\n                \"child_task_id\":    rows[i].value.child_default_task_id,\n                \"date_created\":     rows[i].value.date_created\n            };\n        }\n        \n        if(rows[i].value.table == \"details\"){\n            details.push({\n                \"_id\": \t            rows[i].value._id,\n                \"image\":\t\t    rows[i].value.image,\n                \"to_page_id\": \t    rows[i].value.to_page_id,\n                \"user_id\": \t\t    rows[i].value.user_id,\n                \"task_id\":          rows[i].value.task_id,\n                \"page_id\":          rows[i].value.page_id,\n                \"from_user_id\":     rows[i].value.from_user_id,\n            \t\"user_incoming\":    rows[i].value.user_incoming,\n                \"watson_incoming\":  rows[i].value.watson_incoming,\n                \"type\":             rows[i].value.type,\n                \"date_created\":     rows[i].value.date_created,\n                \"from_user\":        rows[i].value.from_user,\n                \"count\":            rows[i].value.count\n            });\n        }\n    }\n    return {task: task_obj, details: details};\n}\n\nfunction formulate_template(template_id){\n    var template_data = msg.payload;\n    \n    if(isEmpty(template_data.rows)){\n        return template_id;\n    }else{\n        for(var ind=0; ind<template_data.rows.length; ind++){\n            if(template_id == template_data.rows[ind].value._id){\n                return template_data.rows[ind].value;\n            }\n        }\n    }\n}\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 1618.6406555175781,
        "y": 68.8203125,
        "wires": [
            [
                "5664af1.40634d",
                "91a37f8f.1b0078"
            ]
        ]
    },
    {
        "id": "5664af1.40634d",
        "type": "http response",
        "z": "26c98005.8e65c",
        "name": "",
        "x": 1789.6250305175781,
        "y": 32.46484375,
        "wires": []
    },
    {
        "id": "91a37f8f.1b0078",
        "type": "debug",
        "z": "26c98005.8e65c",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "false",
        "x": 1809.6367492675781,
        "y": 84,
        "wires": []
    },
    {
        "id": "1369cd81.0ef0aa",
        "type": "function",
        "z": "26c98005.8e65c",
        "name": "get_user_by_token_view",
        "func": "msg.get_page_view = msg.payload;\nmsg.method = \"GET\";\nmsg.url = 'https://37924750-e42d-41f1-b52e-f70ee3d5e012-bluemix.cloudant.com/master_table/_design/filterBy/_view/get_user_by_token?key=[\"'+ msg.req_data.access_token +'\"]';\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 835.6250305175781,
        "y": 70.515625,
        "wires": [
            [
                "da45d989.cc6728"
            ]
        ]
    },
    {
        "id": "da45d989.cc6728",
        "type": "http request",
        "z": "26c98005.8e65c",
        "name": "",
        "method": "use",
        "ret": "obj",
        "url": "",
        "tls": "",
        "x": 1051.7656555175781,
        "y": 70.75,
        "wires": [
            [
                "86b4e943.dc8c5"
            ]
        ]
    },
    {
        "id": "86b4e943.dc8c5",
        "type": "function",
        "z": "26c98005.8e65c",
        "name": "template_view",
        "func": "msg.user_obj = msg.payload;\nmsg.method = \"GET\";\nmsg.url = \"https://37924750-e42d-41f1-b52e-f70ee3d5e012-bluemix.cloudant.com/master_table/_design/filterBy/_view/get_templates\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1233.6328430175781,
        "y": 71.51171875,
        "wires": [
            [
                "f93bbd92.ed147"
            ]
        ]
    },
    {
        "id": "f93bbd92.ed147",
        "type": "http request",
        "z": "26c98005.8e65c",
        "name": "",
        "method": "use",
        "ret": "obj",
        "url": "",
        "tls": "",
        "x": 1422.0156555175781,
        "y": 70.75,
        "wires": [
            [
                "d040d7.feaa9f28"
            ]
        ]
    },
    {
        "id": "11257aa7.8b7d2d",
        "type": "switch",
        "z": "26c98005.8e65c",
        "name": "",
        "property": "api_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_SUCCESS",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "API_ERROR",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 458.8333435058594,
        "y": 109.66666412353516,
        "wires": [
            [
                "dea6623a.cda5a8"
            ],
            [
                "6e1afed8.6e3e9"
            ]
        ]
    },
    {
        "id": "6e1afed8.6e3e9",
        "type": "http response",
        "z": "26c98005.8e65c",
        "name": "",
        "x": 596.8333740234375,
        "y": 131.3333282470703,
        "wires": []
    },
    {
        "id": "cb670951.5197d8",
        "type": "function",
        "z": "26c98005.8e65c",
        "name": "url",
        "func": "var access_token = msg.payload.access_token ,\npage_id      = msg.payload.page_id ;\n\nif(isEmpty(page_id)){\n    msg.API_STATUS = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, msg: \"`page_id` is missing.\", data: null};\n}else if(isEmpty(access_token)){\n    msg.API_STATUS = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, msg: \"`access_token` is missing.\", data: null};\n}else{\n    msg.method = \"GET\";\n    msg.url = \"https://b822c7af-1fbc-44ad-b335-38e998b35393-bluemix.cloudant.com/master_table/_design/filterBy/_view/test_page?include_docs=true\";\n    msg.API_STATUS = \"API_SUCCESS\";\n    msg.req_data = msg.payload;    \n}\n\n\nreturn msg;\n\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 282.6666564941406,
        "y": 289.6666488647461,
        "wires": [
            [
                "f1168aa8.001388"
            ]
        ]
    },
    {
        "id": "e991574a.9b5f08",
        "type": "http in",
        "z": "26c98005.8e65c",
        "name": "",
        "url": "/test_page",
        "method": "get",
        "swaggerDoc": "",
        "x": 97.67446899414062,
        "y": 289.7057101093234,
        "wires": [
            [
                "cb670951.5197d8"
            ]
        ]
    },
    {
        "id": "c2bf069f.ebca68",
        "type": "http response",
        "z": "26c98005.8e65c",
        "name": "",
        "x": 982.6665649414062,
        "y": 379.3228988647461,
        "wires": []
    },
    {
        "id": "43d77766.04d81",
        "type": "http request",
        "z": "26c98005.8e65c",
        "name": "Get_page_view",
        "method": "use",
        "ret": "obj",
        "url": "",
        "tls": "",
        "x": 576.6665344238281,
        "y": 341.6119613647461,
        "wires": [
            [
                "f4e0774f.af1f7"
            ]
        ]
    },
    {
        "id": "b347e70e.fd694",
        "type": "comment",
        "z": "26c98005.8e65c",
        "name": "New get_page api endpoint with map view resonse ",
        "info": "",
        "x": 207.67837524414062,
        "y": 236.87757110595703,
        "wires": []
    },
    {
        "id": "1d5273cc.65e644",
        "type": "debug",
        "z": "26c98005.8e65c",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "false",
        "x": 998.6704711914062,
        "y": 286.36193084716797,
        "wires": []
    },
    {
        "id": "f4e0774f.af1f7",
        "type": "function",
        "z": "26c98005.8e65c",
        "name": "format",
        "func": "var db_records   = msg.payload ;\n    access_token = msg.req_data.access_token ;\n    page_id      = msg.req_data.page_id ;\n    \nif(isEmpty(db_records)){\n    msg.payload = {status: 400, error: false, msg: \"No Record found.\", data: null};\n}else{\n    if(isEmpty(db_records.rows)){\n        msg.payload = {status: 400, error: false, msg: \"No Record found.\", data: null};   \n    }else{\n        var db_obj          =  format_db_records(db_records.rows),\n            user_obj        =  populate_user(access_token, db_obj.users),\n            task_obj        =  populate_taskobj(page_id, db_obj.tasks),\n            details         =  populate_details(task_obj._id, db_obj.details),\n            prepare_task    =  formulate_task(task_obj, db_obj),\n            prepare_details =  formulate_details(details);\n        \n        msg.payload = {\n            page_id :  page_id,\n            user    :  user_obj || {},\n            task    :  prepare_task,\n            detail  :  prepare_details\n    \t};\n    } \n}\nreturn msg;\n\nfunction formulate_details(detail_data){\n    var detailRecord = {\n        \"_id\": \t\"\",\n        \"image\":\t\t\"\",\n        \"to_page_id\": \t\"\",\n        \"user_id\": \t\t\"\",\n        \"task_id\":      \"\",\n        \"page_id\":      \"\",\n        \"from_user_id\": \"\",\n    \t\"user_incoming\":{},\n        \"watson_incoming\":{},\n        \"type\":         {},\n        \"date_created\": \"\",\n        \"from_user\":    {},\n        \"count\":{\"active\":0, \"unread\":0}\n    }, detailObj= [] ;\n    \n    if(detail_data.length){\n        for(var d=0; d<detail_data.length; d++){\n            if(check_isDisplay(detail_data[d].display_if_empty)){\n                detailObj[d] = get_obj_data(detailRecord, detail_data[d]);\n            }else{\n                detail_data.splice(d, 0);\n            }\n        }\n        msg.detailObj = removeEmptyArrayElements(detailObj);     \n    }\n    \n    return detailObj;\n}\n\nfunction formulate_task(task_obj, db_data){\n    var template_data       = db_data.templates ,\n    task_data               = task_obj,\n    templateObj             = {},\n    header_template_id      = task_data.header_template_id,\n    detail_template_id      = task_data.detail_template_id,\n    footer_template_id      = task_data.footer_template_id;\n    \n    for(var ind=0; ind<template_data.length; ind++){\n        if(header_template_id == template_data[ind]._id){\n            templateObj.header = template_data[ind];\n        }\n        if(detail_template_id == template_data[ind]._id){\n            templateObj.detail = template_data[ind];\n        }\n        if(footer_template_id == template_data[ind]._id){\n            templateObj.footer = template_data[ind];\n        }\n    }\n\n    var taskObj = {\n        \"task_id\":\t\t    task_data._id,\n        \"task_name\":\t\ttask_data.task_name,\n        \"parent_id\":        task_data.parent_id,\n        \"template\": \t\ttemplateObj,\n        \"from_page_id\":\t\ttask_data.from_page_id,\n        \"child_task_id\":    task_data.child_default_task_id,\n        \"date_created\":     task_data.date_created\n    };\n    \n    return taskObj;\n}\n\nfunction populate_details(id, arr){\n    var result = [];\n    \n    if(isEmpty(id)) return result;\n    \n    if(isEmpty(arr)){\n        return result;\n    }else{\n        for(var i=0; i<arr.length; i++){\n            if(arr[i].task_id == id){\n                result.push(arr[i]);\n            }\n        }\n    }    \n\n    return result;\n}\n\nfunction populate_taskobj(id, arr){\n    var obj = {} ;\n    \n    if(isEmpty(id)) return obj;\n    \n    if(isEmpty(arr)){\n        return obj;\n    }else{\n        for(var i=0; i<arr.length; i++){\n            if(parseInt(arr[i].page_id) === parseInt(id)){\n                obj = arr[i];\n            }\n        }\n    }    \n\n    return obj;\n}\n\nfunction populate_user(access_token, db_record){\n    var user = {};\n    \n    if(isEmpty(access_token)) return user ;\n    \n    if(isEmpty(db_record)){\n        return user;\n    }else{\n        for(var i=0; i < db_record.length; i++){\n            if(access_token == db_record[i].access_token){\n                user.user_id       = db_record[i]._id ;\n                user.firstname     = db_record[i].firstname ? db_record[i].firstname : \"\" ;\n                user.lastname      = db_record[i].lastname ? db_record[i].lastname : \"\"; \n                user.email         = db_record[i].email ? db_record[i].email : \"\";\n                user.phone         = db_record[i].phone || \"\" ; \n                user.virtual_phone = db_record[i].virtual_phone ? db_record[i].virtual_phone: \"\";\n                user.type          = db_record[i].type || {} ;\n            }\n        }\n    }\n    \n    return user ;\n}\n\nfunction format_db_records(list){\n    var users = [], templates = [], details=[], task_table = [];\n    for(var i=0; i<list.length; i++){\n        if(list[i].doc.table == \"template\"){\n            templates.push(list[i].doc);\n        }\n        if(list[i].doc.table == \"details\"){\n            details.push(list[i].doc);\n        }\n        \n        if(list[i].doc.table == \"task_table\"){\n            task_table.push(list[i].doc);\n        }\n\n        if(list[i].doc.table == \"users\"){\n            users.push(list[i].doc);\n        }\n    }\n    return {users: users, templates: templates, details: details, tasks: task_table} ;\n}\n\nfunction check_isDisplay(d){\n    \n    if(d === \"1\"){\n        return true;\n    }else if(d === 1){\n        return true;\n    }else if(d === \"true\"){\n        return true;\n    }else if(d === true){\n        return true;\n    }else{\n        return false ;\n    }\n}\n\nfunction removeEmptyArrayElements(arr) { \n   if (!isArray(arr)) {\n      return arr;\n   } else {\n       return arr.filter( function(elem) { \n          return elem !== null ;\n       } ).map(removeEmptyArrayElements);\n   }\n}\n\nfunction isArray(obj) {\n    return Object.prototype.toString.call(obj) === '[object Array]';\n}\n\nfunction get_obj_data(obj1, obj2){\n\tvar obj = {};\n\tfor (var key in obj1) {\n\t\tif(obj2.hasOwnProperty(key))\n\t\t\tobj[key] = obj2[key];\n\t\telse\n\t\t    obj[key] = obj1[key];\n\t}\n\treturn obj;\n}\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 770.8333129882812,
        "y": 341.6666488647461,
        "wires": [
            [
                "1d5273cc.65e644",
                "c2bf069f.ebca68"
            ]
        ]
    },
    {
        "id": "f1168aa8.001388",
        "type": "switch",
        "z": "26c98005.8e65c",
        "name": "",
        "property": "API_STATUS",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_ERROR",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "API_SUCCESS",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 418.8333435058594,
        "y": 289.66666412353516,
        "wires": [
            [
                "52e27f72.034f4"
            ],
            [
                "43d77766.04d81"
            ]
        ]
    },
    {
        "id": "52e27f72.034f4",
        "type": "http response",
        "z": "26c98005.8e65c",
        "name": "",
        "x": 545.6665649414062,
        "y": 282.6666488647461,
        "wires": []
    },
    {
        "id": "b3f52bb8.9ecc38",
        "type": "switch",
        "z": "26c98005.8e65c",
        "name": "get_page",
        "property": "api_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_ERROR",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 95.66665649414062,
        "y": 519.6666870117188,
        "wires": [
            [
                "60ad4f5c.c3df"
            ],
            [
                "36e436f5.e4e48a"
            ]
        ]
    },
    {
        "id": "60ad4f5c.c3df",
        "type": "http response",
        "z": "26c98005.8e65c",
        "name": "",
        "x": 320.6783752441406,
        "y": 450.89715576171875,
        "wires": []
    },
    {
        "id": "36e436f5.e4e48a",
        "type": "function",
        "z": "26c98005.8e65c",
        "name": "populate page",
        "func": "var params = msg.payload_content ;\n\nmsg.payload = {\n    query: \"table:users AND access_token:\" + params.access_token\n};\n//node.warn(msg);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 349.4205627441406,
        "y": 514.7487182617188,
        "wires": [
            [
                "4a3f4a5.33571b4"
            ]
        ]
    },
    {
        "id": "4a3f4a5.33571b4",
        "type": "cloudant in",
        "z": "26c98005.8e65c",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 512.4127502441406,
        "y": 600.8112182617188,
        "wires": [
            [
                "a26d0a34.efe9c8"
            ]
        ]
    },
    {
        "id": "a26d0a34.efe9c8",
        "type": "function",
        "z": "26c98005.8e65c",
        "name": "security",
        "func": "var user = msg.payload ;\n\nif(isEmpty(user)){\n    msg.userStatus = \"invalid\" ;\n}else{\n    msg.isNewUser = false;\n    var security_level = user[0].security_level;\n    \n    if(parseInt(security_level) === 0){\n        msg.userStatus = \"verify\" ;\n    }else{\n        msg.userStatus = \"valid\" ;\n        msg.userObj = {\n            user_id   : user[0]._id ,\n            firstname : user[0].firstname ? user[0].firstname : \"\" ,\n            lastname  : user[0].lastname ? user[0].lastname : \"\", \n            email     : user[0].email ? user[0].email : \"\" ,\n            phone     : user[0].phone || \"\" , \n            virtual_phone     : user[0].virtual_phone ? user[0].virtual_phone: \"\",\n            type      : user[0].type || {}\n        } ;\n    }\n}\n\nreturn msg;\n\nfunction isEmpty(obj){\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 676.4205627441406,
        "y": 601.2369995117188,
        "wires": [
            [
                "17642ef3.466ad1"
            ]
        ]
    },
    {
        "id": "17642ef3.466ad1",
        "type": "switch",
        "z": "26c98005.8e65c",
        "name": "",
        "property": "userStatus",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "invalid",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "verify",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "valid",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "outputs": 3,
        "x": 815.9166564941406,
        "y": 603.1784057617188,
        "wires": [
            [
                "1cab3116.442def"
            ],
            [
                "2abe8a16.c12f86"
            ],
            [
                "c0c05756.6bd928"
            ]
        ]
    },
    {
        "id": "1cab3116.442def",
        "type": "function",
        "z": "26c98005.8e65c",
        "name": "page=1",
        "func": "msg.payload = {\n    query: \"table:task_table AND _id:1_0\",\n    sort: \"_id<string>\"\n};\nmsg.payload_content.page_id = 1 ;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1012.4244441464548,
        "y": 523.2448120117188,
        "wires": [
            [
                "9bfaef9e.3d996"
            ]
        ]
    },
    {
        "id": "2abe8a16.c12f86",
        "type": "function",
        "z": "26c98005.8e65c",
        "name": "page=11",
        "func": "msg.payload = {\n    query: \"table:task_table AND _id:11_0\",\n    sort : \"_id<string>\"\n};\nmsg.payload_content.page_id = 11 ;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1010.4283752441406,
        "y": 594.2369995117188,
        "wires": [
            [
                "9bfaef9e.3d996"
            ]
        ]
    },
    {
        "id": "c0c05756.6bd928",
        "type": "function",
        "z": "26c98005.8e65c",
        "name": "page",
        "func": "if(msg.payload_content.page_id.page_id === undefined){\n    msg.payload = {\n        query: \"table:task_table AND page_id:\" +  msg.payload_content.page_id,\n        sort : \"_id<string>\"\n    };    \n}else{\n    msg.payload = {\n        query: \"table:task_table AND page_id:\" +  msg.payload_content.page_id.page_id,\n        sort : \"_id<string>\"\n    };    \n}\n\nnode.warn(msg.payload);\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 1003.4166564941406,
        "y": 673.2487182617188,
        "wires": [
            [
                "9bfaef9e.3d996"
            ]
        ]
    },
    {
        "id": "1005050c.90701b",
        "type": "switch",
        "z": "26c98005.8e65c",
        "name": "",
        "property": "api_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_ERROR",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 1191.4544982910156,
        "y": 692.7487258911133,
        "wires": [
            [
                "7cd3eb59.952e74"
            ],
            [
                "57438bcd.63f554"
            ]
        ]
    },
    {
        "id": "9bfaef9e.3d996",
        "type": "cloudant in",
        "z": "26c98005.8e65c",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 1188.1210021972656,
        "y": 596.4153747558594,
        "wires": [
            [
                "46648c84.b582c4"
            ]
        ]
    },
    {
        "id": "46648c84.b582c4",
        "type": "function",
        "z": "26c98005.8e65c",
        "name": "populate_record",
        "func": "if(isEmpty(msg.payload)){\n    msg.api_status = \"API_ERROR\";\n    msg.payload = {status : 400, error: true, msg: \"Unable to get the page with the `page_id`\", data: null};\n}else{\n    msg.api_status = \"API_SUCCESS\";\n    msg.task_obj = msg.payload[0];\n    msg.payload = {\n        query : \"table:details AND task_id:\" + msg.task_obj._id ,\n        sort  : \"_id<string>\"\n    };\n    node.warn(msg.payload);\n}\nreturn msg;\n\nfunction isEmpty(obj){\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 1384.1212463378906,
        "y": 597.7487106323242,
        "wires": [
            [
                "1005050c.90701b"
            ]
        ]
    },
    {
        "id": "7cd3eb59.952e74",
        "type": "http response",
        "z": "26c98005.8e65c",
        "name": "",
        "x": 1350.1210021972656,
        "y": 674.4153518676758,
        "wires": []
    },
    {
        "id": "57438bcd.63f554",
        "type": "cloudant in",
        "z": "26c98005.8e65c",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 1352.4542541503906,
        "y": 729.7487106323242,
        "wires": [
            [
                "b8666da7.15f09"
            ]
        ]
    },
    {
        "id": "b8666da7.15f09",
        "type": "function",
        "z": "26c98005.8e65c",
        "name": "template_payload",
        "func": "// if(isEmpty(msg.payload)){\n//     msg.api_status  = \"API_ERROR\";\n//     msg.payload     = {status: 400, error: true, msg: \"unable to fetch task_obj using page_id\", data: null};\n// }else{\n    msg.api_status  = \"API_SUCCESS\";\n    msg.detail    = msg.payload || [];\n    msg.payload     = {\n        query   : \"table:template\",\n        sort    : \"_id<string>\" \n    };\n//}\n\nreturn msg;\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 1548.4547424316406,
        "y": 728.0820617675781,
        "wires": [
            [
                "c208ca41.4f98b8"
            ]
        ]
    },
    {
        "id": "c208ca41.4f98b8",
        "type": "switch",
        "z": "26c98005.8e65c",
        "name": "",
        "property": "api_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_ERROR",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 1728.7877502441406,
        "y": 714.7487182617188,
        "wires": [
            [
                "9c49acdc.df238"
            ],
            [
                "ebffe75d.8046a8"
            ]
        ]
    },
    {
        "id": "9c49acdc.df238",
        "type": "http response",
        "z": "26c98005.8e65c",
        "name": "",
        "x": 1882.7882385253906,
        "y": 657.0820617675781,
        "wires": []
    },
    {
        "id": "ebffe75d.8046a8",
        "type": "cloudant in",
        "z": "26c98005.8e65c",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 1891.7879943847656,
        "y": 725.4153747558594,
        "wires": [
            [
                "914c2172.568ec"
            ]
        ]
    },
    {
        "id": "914c2172.568ec",
        "type": "function",
        "z": "26c98005.8e65c",
        "name": "detail_arr",
        "func": "msg.tempteObj = msg.payload;\n\nif(isEmpty(msg.tempteObj)){\n    msg.api_status = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, msg: \"unable to populate templates using with this page_id\", data: null};\n}else{\n    msg.api_status = \"API_SUCCESS\";\n    msg.payload = {\n        query: \"table:details\",\n        sort: \"_id<string>\"\n    };    \n}\n\nreturn msg;\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 2035.7879943847656,
        "y": 763.0820617675781,
        "wires": [
            [
                "9013a5d7.c012c8"
            ]
        ]
    },
    {
        "id": "9013a5d7.c012c8",
        "type": "switch",
        "z": "26c98005.8e65c",
        "name": "",
        "property": "api_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_SUCCESS",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2178.5377502441406,
        "y": 762.2330932617188,
        "wires": [
            [
                "8beb1f1c.caea9"
            ],
            [
                "556bc08e.205b"
            ]
        ]
    },
    {
        "id": "8beb1f1c.caea9",
        "type": "cloudant in",
        "z": "26c98005.8e65c",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 2344.7877502441406,
        "y": 700.7487182617188,
        "wires": [
            [
                "387ae6d8.3d772a"
            ]
        ]
    },
    {
        "id": "556bc08e.205b",
        "type": "http response",
        "z": "26c98005.8e65c",
        "name": "",
        "x": 2331.5299377441406,
        "y": 768.7096557617188,
        "wires": []
    },
    {
        "id": "387ae6d8.3d772a",
        "type": "function",
        "z": "26c98005.8e65c",
        "name": "prepare taskObj",
        "func": "var template_data       = msg.tempteObj ,\n    task_data           = msg.task_obj,\n    templateObj         = {},\n    header_template_id  = task_data.header_template_id,\n    detail_template_id  = task_data.detail_template_id,\n    footer_template_id  = task_data.footer_template_id;\n    \nif(msg.payload_content.page_id.page_id === undefined){\n    var page_id         = msg.payload_content.page_id;    \n}else{\n    var page_id         = msg.payload_content.page_id.page_id;    \n}\n\n\nfor(var ind=0; ind<template_data.length; ind++){\n    if(header_template_id == template_data[ind]._id){\n        templateObj.header = template_data[ind];\n    }\n    if(detail_template_id == template_data[ind]._id){\n        templateObj.detail = template_data[ind];\n    }\n    if(footer_template_id == template_data[ind]._id){\n        templateObj.footer = template_data[ind];\n    }\n}\n\n\nvar taskObj = {\n    \"task_id\":\t\t    task_data._id,\n    \"task_name\":\t\ttask_data.task_name,\n    \"parent_id\":        task_data.parent_id,\n    \"template\": \t\ttemplateObj,\n    \"from_page_id\":\t\ttask_data.from_page_id,\n    \"child_task_id\":    task_data.child_default_task_id,\n    \"date_created\":     task_data.date_created\n};\n\nmsg.detail_arr  = msg.payload ;\nmsg.taskObj     = taskObj;\n\nreturn msg;\n\n",
        "outputs": 1,
        "noerr": 0,
        "x": 2505.7877502441406,
        "y": 816.748779296875,
        "wires": [
            [
                "830579b7.ab6628"
            ]
        ]
    },
    {
        "id": "830579b7.ab6628",
        "type": "function",
        "z": "26c98005.8e65c",
        "name": "prepare detail_obj",
        "func": "var detail_data = msg.detail,\n    detailObj   = [];\n    \n//**********    detailObj     *******//\nvar detailRecord = {\n    \"_id\": \t\"\",\n    \"image\":\t\t\"\",\n    \"to_page_id\": \t\"\",\n    \"user_id\": \t\t\"\",\n    \"task_id\":      \"\",\n    \"page_id\":      \"\",\n    \"from_user_id\": \"\",\n\t\"user_incoming\":{},\n    \"watson_incoming\":{},\n    \"type\":         {},\n    \"date_created\": \"\",\n    \"from_user\":    {},\n    \"count\":{\"active\":0, \"unread\":0}\n};\n\nif(detail_data.length){\n    for(var d=0; d<detail_data.length; d++){\n        detail_data[d]._id = detail_data[d]._id;\n        detail_data[d].to_page_id = detail_data[d].to_page_id;\n        \n        if(check_isDisplay(detail_data[d].display_if_empty)){\n            detailObj[d] = get_obj_data(detailRecord, detail_data[d]);\n        }else{\n            detail_data.splice(d, 0)    ;\n        }\n    }\n    msg.detailObj = removeEmptyArrayElements(detailObj);     \n}else{\n    msg.detailObj = [] ;\n}\n\nmsg.user_task_payload = {query: \"table:user_task\", sort: \"_id<string>\"};\nreturn msg;\n\nfunction check_isDisplay(d){\n    \n    if(d === \"1\"){\n        return true;\n    }else if(d === 1){\n        return true;\n    }else if(d === \"true\"){\n        return true;\n    }else if(d === true){\n        return true;\n    }else{\n        return false ;\n    }\n}\n\nfunction removeEmptyArrayElements(arr) { \n   if (!isArray(arr)) {\n      return arr;\n   } else {\n       return arr.filter( function(elem) { \n          return elem !== null ;\n       } ).map(removeEmptyArrayElements);\n   }\n}\n\nfunction isArray(obj) {\n    return Object.prototype.toString.call(obj) === '[object Array]';\n}\n\nfunction get_obj_data(obj1, obj2){\n\tvar obj = {};\n\tfor (var key in obj1) {\n\t\tif(obj2.hasOwnProperty(key))\n\t\t\tobj[key] = obj2[key];\n\t\telse\n\t\t    obj[key] = obj1[key];\n\t}\n\treturn obj;\n}",
        "outputs": 1,
        "noerr": 0,
        "x": 2690.4542541503906,
        "y": 754.4154052734375,
        "wires": [
            [
                "7096a7a8.e345b8"
            ]
        ]
    },
    {
        "id": "7096a7a8.e345b8",
        "type": "change",
        "z": "26c98005.8e65c",
        "name": "change",
        "rules": [
            {
                "t": "move",
                "p": "user_task_payload",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2854.7877502441406,
        "y": 675.4154663085938,
        "wires": [
            [
                "538b31b9.0a2fe"
            ]
        ]
    },
    {
        "id": "538b31b9.0a2fe",
        "type": "cloudant in",
        "z": "26c98005.8e65c",
        "name": "",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "search": "_idx_",
        "design": "filterBy",
        "index": "filterBy",
        "x": 2902.7882385253906,
        "y": 762.4154357910156,
        "wires": [
            [
                "239b7485.a3fe4c"
            ]
        ]
    },
    {
        "id": "239b7485.a3fe4c",
        "type": "function",
        "z": "26c98005.8e65c",
        "name": "response",
        "func": "if(msg.payload_content.page_id.page_id === undefined){\n    var page_id         = msg.payload_content.page_id;    \n}else{\n    var page_id         = msg.payload_content.page_id.page_id;    \n}\n\nvar userObj         = msg.userObj;\nvar taskObj         = msg.taskObj;\nvar user_task_arr   = [] ;\nvar apiResult       = {} ;\nvar details         = [];\n\ntry{\n    if(!isEmpty(msg.payload)){\n        user_task_arr = msg.payload.sort(function(){\n            user_task_arr = user_task_arr.sort(function(a, b){\n                return (a.createdAt - b.createdAt);\t\n            });\n        });\n    }\n    \n    details =  msg.detail_arr.sort(function(a,b){\n        details = details.sort(function(a,b){\n        \tif(typeof a.page_id === 'number'){\n        \t\treturn (a.page_id - b.page_id);\t\n        \t}else{\n        \t\treturn (a.createdAt - b.createdAt);\t\n        \t}\n        \t\n        });\n    });\n    \n    if(page_id == 1 ){\n        page_id = 1 ;\n    \tapiResult.access_token = msg.payload_content.access_token;\n    } \n\n    var apiResult = {\n        \"page_id\":  page_id,\n        \"user\":     userObj,\n        \"task\":     taskObj,\n        \"detail\":   getpage(page_id)\n\t};\n    msg.payload = apiResult;\n}catch(e){\n    node.warn(e);\n    msg.api_status = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, msg: \"Exception occured while populating page\", data: null, exception: e};\n}\n\n\nreturn msg;\n\nfunction getpage(page_id){\n    var result = get_page_array(page_id) ,\n        detail = result.detail_array ;\n\n    if(detail.length){\n        return detail ;\n    }else{\n        return [] ;\n    }\n}\n\nfunction get_page_array(page_id){\n    var detail_array = msg.detailObj;\n    \n    for(var itr = 0 ; itr < detail_array.length; itr++){\n        var count = {} , current_count_active = 0, current_count_unread = 0, active = 0, unread = 0;\n        \n        if(detail_array[itr].to_page_id){\n            count = get_sub_child_count(detail_array[itr].to_page_id);\n            \n            if(check_obj(count) > 0){\n                current_count_active = count.active ;\n                current_count_unread = count.unread ;\n                if(!isEmpty(userObj)){\n                    update_user_task_record({user_id: userObj.user_id, task_id: taskObj.task_id, synch : 1, count: count}, false);    \n                } \n            }\n        }else{\n            var user_task_obj = return_user_task_obj(detail_array[itr].user_id, detail_array[itr].task_id, detail_array[itr].page_id);\n            if (check_obj(user_task_obj) > 0){\n                 // do count_if check using user_task fields as do in update_user_task\n                current_count_active = user_task_obj.count.active ;\n                current_count_unread = user_task_obj.count.unread ;\n            }else{ // otherwise use defaults\n                 // do count_if check using detail fields as do in update_user_task\n                current_count_active = detail_array[itr].count.active ;\n                current_count_unread = detail_array[itr].count.unread ;\n            }\n        }\n        active = active + current_count_active ;\n        unread = unread + current_count_unread ;\n        \n        if(detail_array[itr].count){\n            detail_array[itr].count.active = active ;\n            detail_array[itr].count.unread = unread ;\n        }\n    }\n\n    return {\n        detail_array :   detail_array,\n    };\n}\n\nfunction check_obj(obj){\n    return Object.keys(obj).length ;\n}\n\nfunction return_user_task_obj(user_id, task_id){\n    var obj = {};\n    if(user_task_arr !== null && user_task_arr !== undefined){\n        for(var i=0; i< user_task_arr.length; i++){\n            if(\n                user_task_arr[i].user_id        === user_id &&\n                user_task_arr[i].parent_id      === task_id\n            ){\n                    obj = user_task_arr[i];\n            }\n        }\n    }\n    return obj ;\n}\n\nfunction update_user_task_record(obj, update_parent){\n    var user_task_obj = return_user_task_obj(obj.user_id, obj.task_id),\n        create_user_task_flag = true, ancestors_array= [];\n    \n    if (check_obj(user_task_obj) > 0){\n    \tif (user_task_obj.user_id == obj.user_id){\n    \t    create_user_task_flag = false ;// if one already exists then dont create again    \n    \t} \n    \t\n    \tuser_task_obj.synchronized          = obj.synch ;\n        user_task_obj.date_updated          = new Date().toJSON();\n\n        if(!user_task_obj.update_read){\n            if( user_task_obj.count_status.unread  && !user_task_obj.count_if.unread ){\n                user_task_obj.count.unread += 1 ;  \n            }\n        }\n    \n        if(!user_task_obj.update_active){\n            if( user_task_obj.count_status.active && user_task_obj.count_if.active){\n                user_task_obj.count.active += 1 ;  \n            }\n        }\n    \n        if(user_task_obj.parent_id && update_parent) update_user_task_record({user_id: user_task_obj.user_id, task_id: user_task_obj.parent_id, synch:1, count: {active:0, unread:0}}, false );\n        \n        user_task_obj.update_read   = 1 ;\n        user_task_obj.update_active = 1 ;\n        \n        \n    }\n\n    if ( create_user_task_flag ) {\n        \n        if(taskObj.parent_id){\n            var if_user_task = return_user_task_obj(obj.user_id, taskObj.parent_id);\n           \n            if(check_obj(if_user_task) > 0){\n                ancestors_array = if_user_task.ancestors ;    \n\n                if( !if_exists_in_arr(taskObj.parent_id, ancestors_array) ) {\n                    ancestors_array.push(taskObj.parent_id);\n                }\n            }else{\n                \n                if( !if_exists_in_arr(taskObj.parent_id, ancestors_array) ) ancestors_array.push(taskObj.parent_id);\n            }\n        }else{\n            node.warn(\"else_user_task\");     \n        }\n        \n        msg.updated_user_task = {\n            table           : \"user_task\",\n        \ttask_id \t\t: obj.task_id,\n        \tuser_id\t\t\t: obj.user_id,\n        \tpage_id         : parseInt(page_id),\n        \tupdate_read     : 0,\n        \tupdate_active   : 0, \n        \tsynchronized    : 1,\n            status          : 0, \n        \tdate_updated\t: null,\t\n        \tparent_id\t\t: obj.task_id,\n        \tancestors       : ancestors_array, \n        \tcount_status\t: {\n        \t   active       : 1,\n        \t   unread       : 0,\n        \t},\n        \tcount\t\t\t: {\n        \t    active      : 0,\n        \t    unread      : 0,\n        \t},\n        \tcount_if\t\t: {\n        \t    active      : 1,\n        \t    unread      : 0\n        \t},\n        \ttemplates\t\t: {},\n        \ttimeout\t\t\t: {},\n        \tcreatedAt       : new Date().getTime()\n        };\n    }else{\n        msg.updated_user_task = user_task_obj ;\n    }\n}\n\nfunction get_sub_child_count(to_page_id){\n    var count = {active:0, unread: 0} ;\n\n    for(var itr = 0; itr < details.length; itr++){\n        if(to_page_id == details[itr].page_id){\n            if(details[itr].count_status){\n                count.active += details[itr].count_status.active ;\n                count.unread += details[itr].count_status.unread ;\n            }\n        }\n    }\n    \n    return count;\n}\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}\n\nfunction if_exists_in_arr(key, array){\n    return array.indexOf(key) > -1;\n}\n",
        "outputs": 1,
        "noerr": 0,
        "x": 3026.2877502441406,
        "y": 856.4154052734375,
        "wires": [
            [
                "784836b3.db1c88"
            ]
        ]
    },
    {
        "id": "784836b3.db1c88",
        "type": "switch",
        "z": "26c98005.8e65c",
        "name": "",
        "property": "api_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_ERROR",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 3149.1207580566406,
        "y": 750.4153747558594,
        "wires": [
            [
                "5b095abb.a234b4"
            ],
            [
                "4165e911.501be8",
                "2057458d.359d1a",
                "f946824f.669d6"
            ]
        ]
    },
    {
        "id": "5b095abb.a234b4",
        "type": "http response",
        "z": "26c98005.8e65c",
        "name": "",
        "x": 3294.1212463378906,
        "y": 665.4153747558594,
        "wires": []
    },
    {
        "id": "2057458d.359d1a",
        "type": "http response",
        "z": "26c98005.8e65c",
        "name": "API Result",
        "x": 3317.1207580566406,
        "y": 722.4153747558594,
        "wires": []
    },
    {
        "id": "4165e911.501be8",
        "type": "change",
        "z": "26c98005.8e65c",
        "name": "change",
        "rules": [
            {
                "t": "move",
                "p": "updated_user_task",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3307.1212463378906,
        "y": 766.4153442382812,
        "wires": [
            [
                "f3066581.c3e318"
            ]
        ]
    },
    {
        "id": "f946824f.669d6",
        "type": "debug",
        "z": "26c98005.8e65c",
        "name": "get_page_payload",
        "active": true,
        "console": "false",
        "complete": "payload",
        "x": 3336.1212463378906,
        "y": 820.4153747558594,
        "wires": []
    },
    {
        "id": "f3066581.c3e318",
        "type": "function",
        "z": "26c98005.8e65c",
        "name": "save?",
        "func": "var payload = msg.payload ;\nif(isEmpty(payload)){\n    msg.status = \"no_need_to_save\";\n}else{\n    msg.status = \"needtosave\";\n}\nreturn msg;\n\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 3509.6212463378906,
        "y": 662.4154052734375,
        "wires": [
            [
                "54ecdf2c.56492"
            ]
        ]
    },
    {
        "id": "54ecdf2c.56492",
        "type": "switch",
        "z": "26c98005.8e65c",
        "name": "",
        "property": "status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "needtosave",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 3521.6212463378906,
        "y": 718.4154052734375,
        "wires": [
            [
                "d3e6f8f3.b2f188"
            ],
            [
                "b6fa4e71.ea998"
            ]
        ]
    },
    {
        "id": "d3e6f8f3.b2f188",
        "type": "cloudant out",
        "z": "26c98005.8e65c",
        "name": "Update User Task",
        "cloudant": "",
        "database": "master_table",
        "service": "live-platformApp-cloudantNoSQLDB",
        "payonly": true,
        "operation": "insert",
        "x": 3574.1210021972656,
        "y": 774.7487182617188,
        "wires": []
    },
    {
        "id": "b6fa4e71.ea998",
        "type": "debug",
        "z": "26c98005.8e65c",
        "name": "update_task_payload",
        "active": true,
        "console": "false",
        "complete": "payload",
        "x": 3593.2877502441406,
        "y": 834.7487487792969,
        "wires": []
    },
    {
        "id": "367952ef.69bbde",
        "type": "switch",
        "z": "84d8e4c3.e48e3",
        "name": "get_page",
        "property": "api_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_ERROR",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 1397.37890625,
        "y": 95.91796875,
        "wires": [
            [
                "55ad4735.ff3c08"
            ],
            [
                "235366ce.ef726a"
            ]
        ]
    },
    {
        "id": "55ad4735.ff3c08",
        "type": "http response",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "x": 1622.390625,
        "y": 27.1484375,
        "wires": []
    },
    {
        "id": "235366ce.ef726a",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "url",
        "func": "var access_token = msg.payload_content.access_token ,\n    page_id      = msg.payload_content.page_id ;\n\nif(isEmpty(page_id)){\n    msg.API_STATUS = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, msg: \"`page_id` is missing.\", data: null};\n}else if(isEmpty(access_token)){\n    msg.API_STATUS = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, msg: \"`access_token` is missing.\", data: null};\n}else{\n    msg.method = \"GET\";\n    msg.url = \"https://b822c7af-1fbc-44ad-b335-38e998b35393-bluemix.cloudant.com/master_table/_design/filterBy/_view/test_page?include_docs=true\";\n    msg.API_STATUS = \"API_SUCCESS\";\n    msg.req_data = msg.payload;    \n}\n\n\nreturn msg;\n\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 1623,
        "y": 95,
        "wires": [
            [
                "64412460.c8aa6c"
            ]
        ]
    },
    {
        "id": "64412460.c8aa6c",
        "type": "switch",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "property": "API_STATUS",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "API_ERROR",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "API_SUCCESS",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 1759.1666870117188,
        "y": 95.00001525878906,
        "wires": [
            [
                "ae83e8df.fbccf8"
            ],
            [
                "b6c053e3.48243"
            ]
        ]
    },
    {
        "id": "ae83e8df.fbccf8",
        "type": "http response",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "x": 1885.9999084472656,
        "y": 88,
        "wires": []
    },
    {
        "id": "b6c053e3.48243",
        "type": "http request",
        "z": "84d8e4c3.e48e3",
        "name": "Get_page_view",
        "method": "use",
        "ret": "obj",
        "url": "",
        "tls": "",
        "x": 1916.9998779296875,
        "y": 146.9453125,
        "wires": [
            [
                "96c18525.ec09c8"
            ]
        ]
    },
    {
        "id": "96c18525.ec09c8",
        "type": "function",
        "z": "84d8e4c3.e48e3",
        "name": "format",
        "func": "var db_records   = msg.payload ;\n    access_token = msg.payload_content.access_token ;\n    page_id      = msg.payload_content.page_id ;\n    \nif(isEmpty(db_records)){\n    msg.payload = {status: 400, error: false, msg: \"No Record found.\", data: null};\n}else{\n    if(isEmpty(db_records.rows)){\n        msg.payload = {status: 400, error: false, msg: \"No Record found.\", data: null};   \n    }else{\n        var db_obj          =  format_db_records(db_records.rows),\n            user_obj        =  populate_user(access_token, db_obj.users),\n            task_obj        =  populate_taskobj(page_id, db_obj.tasks);\n            \n            if(isEmpty(user_obj)){\n               page_id = 1; \n            }else{\n                if(!user_obj.security_level){\n                    page_id = 11; \n                }\n            }\n            \n            var details         =  populate_details(task_obj._id, db_obj.details),\n            prepare_task    =  formulate_task(task_obj, db_obj),\n            prepare_details =  formulate_details(details);\n\n        msg.payload = {\n            page_id :  page_id,\n            user    :  user_obj || {},\n            task    :  prepare_task,\n            detail  :  getpage(prepare_details)\n    \t};\n    } \n}\n\nreturn msg;\n\nfunction getpage(details){\n    var result = get_page_array(details) ,\n        detail = result.detail_array ;\n \n    if(detail.length){\n        return detail ;\n    }else{\n        return [] ;\n    }\n}\n\nfunction get_page_array(detail_array){\n    \n    for(var itr = 0 ; itr < detail_array.length; itr++){\n        var count = {} , current_count_active = 0, current_count_unread = 0, active = 0, unread = 0;\n        \n        if(detail_array[itr].to_page_id){\n            count = get_sub_child_count(detail_array[itr].to_page_id);\n            \n            if(check_obj(count) > 0){\n                current_count_active = count.active ;\n                current_count_unread = count.unread ;\n            }\n        }else{\n            current_count_active = detail_array[itr].count.active ;\n            current_count_unread = detail_array[itr].count.unread ;\n        }\n        active = active + current_count_active ;\n        unread = unread + current_count_unread ;\n        \n        if(detail_array[itr].count){\n            detail_array[itr].count.active = active ;\n            detail_array[itr].count.unread = unread ;\n        }\n    }\n\n    return {\n        detail_array :   detail_array,\n    };\n}\n\nfunction get_sub_child_count(to_page_id){\n    var count = {active:0, unread: 0}, details = db_obj.details;\n    \n    for(var itr = 0; itr < details.length; itr++){\n        if(to_page_id == details[itr].page_id){\n            if(details[itr].count_status){\n                count.active += details[itr].count_status.active ;\n                count.unread += details[itr].count_status.unread ;\n            }\n        }\n    }\n    return count;\n}\n\nfunction formulate_details(detail_data){\n    var detailRecord = {\n        \"_id\": \t\"\",\n        \"image\":\t\t\"\",\n        \"to_page_id\": \t\"\",\n        \"user_id\": \t\t\"\",\n        \"task_id\":      \"\",\n        \"page_id\":      \"\",\n        \"from_user_id\": \"\",\n    \t\"user_incoming\":{},\n        \"watson_incoming\":{},\n        \"type\":         {},\n        \"date_created\": \"\",\n        \"from_user\":    {},\n        \"count\":{\"active\":0, \"unread\":0}\n    }, detailObj= [] ;\n    \n    if(detail_data.length){\n        for(var d=0; d<detail_data.length; d++){\n            if(check_isDisplay(detail_data[d].display_if_empty)){\n                detailObj.push( get_obj_data(detailRecord, detail_data[d]) );\n            }else{\n                detail_data.splice(d, 0);\n            }\n        }\n        msg.detailObj = removeEmptyArrayElements(detailObj);     \n    }\n    \n    return detailObj;\n}\n\nfunction formulate_task(task_obj, db_data){\n    var template_data       = db_data.templates ,\n    task_data               = task_obj,\n    templateObj             = {},\n    header_template_id      = task_data.header_template_id,\n    detail_template_id      = task_data.detail_template_id,\n    footer_template_id      = task_data.footer_template_id;\n    \n    for(var ind=0; ind<template_data.length; ind++){\n        if(header_template_id == template_data[ind]._id){\n            templateObj.header = template_data[ind];\n        }\n        if(detail_template_id == template_data[ind]._id){\n            templateObj.detail = template_data[ind];\n        }\n        if(footer_template_id == template_data[ind]._id){\n            templateObj.footer = template_data[ind];\n        }\n    }\n\n    var taskObj = {\n        \"task_id\":\t\t    task_data._id,\n        \"task_name\":\t\ttask_data.task_name,\n        \"parent_id\":        task_data.parent_id,\n        \"template\": \t\ttemplateObj,\n        \"from_page_id\":\t\ttask_data.from_page_id,\n        \"child_task_id\":    task_data.child_default_task_id,\n        \"date_created\":     task_data.date_created\n    };\n    \n    return taskObj;\n}\n\nfunction populate_details(id, arr){\n    var result = [];\n    \n    if(isEmpty(id)) return result;\n    \n    if(isEmpty(arr)){\n        return result;\n    }else{\n        for(var i=0; i<arr.length; i++){\n            if(arr[i].task_id == id){\n                result.push(arr[i]);\n            }\n        }\n    }    \n    \n    return result;\n}\n\nfunction populate_taskobj(id, arr){\n    if(isEmpty(id)) return {};\n    \n    if(isEmpty(arr)){\n        return {};\n    }else{\n        for(var i=0; i<arr.length; i++){\n            if(parseInt(arr[i].page_id) === parseInt(id)){\n                return arr[i];\n            }\n        }\n    }\n}\n\nfunction populate_user(access_token, db_record){\n    var user = {};\n    \n    if(isEmpty(access_token)) return user ;\n    \n    if(isEmpty(db_record)){\n        return user;\n    }else{\n        for(var i=0; i < db_record.length; i++){\n            if(access_token == db_record[i].access_token){\n                user.user_id       = db_record[i]._id ;\n                user.firstname     = db_record[i].firstname ? db_record[i].firstname : \"\" ;\n                user.lastname      = db_record[i].lastname ? db_record[i].lastname : \"\"; \n                user.email         = db_record[i].email ? db_record[i].email : \"\";\n                user.phone         = db_record[i].phone || \"\" ; \n                user.virtual_phone = db_record[i].virtual_phone ? db_record[i].virtual_phone: \"\";\n                user.type          = db_record[i].type || {} ;\n                user.security_level= db_record[i].security_level;\n            }\n        }\n    }\n    \n    return user ;\n}\n\nfunction format_db_records(list){\n    var users = [], templates = [], details=[], task_table = [], sorted_detail = [];\n    for(var i=0; i<list.length; i++){\n        if(list[i].doc.table == \"template\"){\n            templates.push(list[i].doc);\n        }\n        if(list[i].doc.table == \"details\"){\n            details.push(list[i].doc);\n        }\n        \n        if(list[i].doc.table == \"task_table\"){\n            task_table.push(list[i].doc);\n        }\n\n        if(list[i].doc.table == \"users\"){\n            users.push(list[i].doc);\n        }\n    }\n    \n    if(!isEmpty(details)){\n        sorted_detail =  details.sort(function(a,b){\n            sorted_detail = sorted_detail.sort(function(a,b){\n            \tif(typeof a.page_id === 'number'){\n            \t\treturn (a.page_id - b.page_id);\t\n            \t}else{\n            \t\treturn (a.createdAt - b.createdAt);\t\n            \t}\n            });\n        });\n    }else{\n        sorted_detail = details ;\n    }\n    \n    return {users: users, templates: templates, details: sorted_detail, tasks: task_table} ;\n}\n\nfunction check_isDisplay(d){\n    \n    if(d === \"1\"){\n        return true;\n    }else if(d === 1){\n        return true;\n    }else if(d === \"true\"){\n        return true;\n    }else if(d === true){\n        return true;\n    }else{\n        return false ;\n    }\n}\n\nfunction removeEmptyArrayElements(arr) { \n   if (!isArray(arr)) {\n      return arr;\n   } else {\n       return arr.filter( function(elem) { \n          return elem !== null ;\n       } ).map(removeEmptyArrayElements);\n   }\n}\n\nfunction isArray(obj) {\n    return Object.prototype.toString.call(obj) === '[object Array]';\n}\n\nfunction get_obj_data(obj1, obj2){\n\tvar obj = {};\n\tfor (var key in obj1) {\n\t\tif(obj2.hasOwnProperty(key))\n\t\t\tobj[key] = obj2[key];\n\t\telse\n\t\t    obj[key] = obj1[key];\n\t}\n\treturn obj;\n}\n\nfunction check_obj(obj){\n    return Object.keys(obj).length ;\n}\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}",
        "outputs": 1,
        "noerr": 0,
        "x": 2111.1666564941406,
        "y": 147,
        "wires": [
            [
                "22372348.1740ac"
            ]
        ]
    },
    {
        "id": "22372348.1740ac",
        "type": "http response",
        "z": "84d8e4c3.e48e3",
        "name": "",
        "x": 2260,
        "y": 148.65624237060547,
        "wires": []
    },
    {
        "id": "e0350137.dc90a",
        "type": "function",
        "z": "af6617e3.50aa38",
        "name": "log_obj",
        "func": "var cloneObj = Object.assign({}, msg);\nmsg.payload = {\n    type    : \"Login API Flow\",\n    node    : \"/api/login endpoint\",\n    msgObj  : cloneObj\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 279.62499618530273,
        "y": 136.24999904632568,
        "wires": [
            [
                "1afecf70.9f5011"
            ]
        ]
    },
    {
        "id": "1afecf70.9f5011",
        "type": "http request",
        "z": "af6617e3.50aa38",
        "name": "Log",
        "method": "POST",
        "ret": "obj",
        "url": "http://mastersoftwaretechnologies.com/roger_project/log.php",
        "tls": "",
        "x": 417.63673400878906,
        "y": 135.69141960144043,
        "wires": [
            [
                "2c1f03b3.2b7ffc"
            ]
        ]
    },
    {
        "id": "a6c6e916.aae368",
        "type": "function",
        "z": "af6617e3.50aa38",
        "name": "log_obj",
        "func": "var cloneObj = Object.assign({}, msg);\nmsg.payload = {\n    type    : \"Login API Flow\",\n    node    : \"merge data for update\",\n    msgObj  : cloneObj\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 398.76564025878906,
        "y": 298.75001525878906,
        "wires": [
            [
                "dcddf5f1.e538c8"
            ]
        ]
    },
    {
        "id": "dcddf5f1.e538c8",
        "type": "http request",
        "z": "af6617e3.50aa38",
        "name": "Log",
        "method": "POST",
        "ret": "obj",
        "url": "http://mastersoftwaretechnologies.com/roger_project/log.php",
        "tls": "",
        "x": 535.77734375,
        "y": 298.19141006469727,
        "wires": [
            [
                "6069f984.4c20a"
            ]
        ]
    },
    {
        "id": "fe9697e6.d86228",
        "type": "function",
        "z": "af6617e3.50aa38",
        "name": "log_obj",
        "func": "var cloneObj = Object.assign({}, msg);\nmsg.payload = {\n    type    : \"Login API Flow\",\n    node    : \"return menu page\",\n    msgObj  : cloneObj\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 918.515625,
        "y": 419.75,
        "wires": [
            [
                "3d83685c.7935a8"
            ]
        ]
    },
    {
        "id": "3d83685c.7935a8",
        "type": "http request",
        "z": "af6617e3.50aa38",
        "name": "Log",
        "method": "POST",
        "ret": "obj",
        "url": "http://mastersoftwaretechnologies.com/roger_project/log.php",
        "tls": "",
        "x": 1055.527328491211,
        "y": 419.1913948059082,
        "wires": [
            [
                "f8ecc878.bc0618"
            ]
        ]
    },
    {
        "id": "bf2647f3.c91ff8",
        "type": "function",
        "z": "af6617e3.50aa38",
        "name": "log_obj",
        "func": "var cloneObj = Object.assign({}, msg);\nmsg.payload = {\n    type    : \"Login API Flow\",\n    node    : \"sucess_login: api_response \",\n    msgObj  : cloneObj\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1374.765625,
        "y": 425.75,
        "wires": [
            [
                "e83380c6.4f795"
            ]
        ]
    },
    {
        "id": "e83380c6.4f795",
        "type": "http request",
        "z": "af6617e3.50aa38",
        "name": "Log",
        "method": "POST",
        "ret": "obj",
        "url": "http://mastersoftwaretechnologies.com/roger_project/log.php",
        "tls": "",
        "x": 1511.777328491211,
        "y": 425.1913948059082,
        "wires": [
            [
                "6ddfebdd.0b9ac4"
            ]
        ]
    },
    {
        "id": "a8e74667.379d28",
        "type": "function",
        "z": "af6617e3.50aa38",
        "name": "log_obj",
        "func": "var cloneObj = Object.assign({}, msg);\nmsg.payload = {\n    type    : \"Login API Flow\",\n    node    : \"send sms code to twilio \",\n    msgObj  : cloneObj\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1361.5157432556152,
        "y": 335.75000381469727,
        "wires": [
            [
                "fd549b68.d0ce18"
            ]
        ]
    },
    {
        "id": "fd549b68.d0ce18",
        "type": "http request",
        "z": "af6617e3.50aa38",
        "name": "Log",
        "method": "POST",
        "ret": "obj",
        "url": "http://mastersoftwaretechnologies.com/roger_project/log.php",
        "tls": "",
        "x": 1498.5274467468262,
        "y": 335.19139862060547,
        "wires": [
            [
                "b545c0d0.cebe58"
            ]
        ]
    },
    {
        "id": "62f8c1d6.ad07c",
        "type": "function",
        "z": "af6617e3.50aa38",
        "name": "log_obj",
        "func": "var cloneObj = Object.assign({}, msg);\nmsg.payload = {\n    type    : \"Login API Flow\",\n    node    : \"/api/verify endpoint\",\n    msgObj  : cloneObj\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 284.765625,
        "y": 720,
        "wires": [
            [
                "7cd2dca7.5462b4"
            ]
        ]
    },
    {
        "id": "7cd2dca7.5462b4",
        "type": "http request",
        "z": "af6617e3.50aa38",
        "name": "Log",
        "method": "POST",
        "ret": "obj",
        "url": "http://mastersoftwaretechnologies.com/roger_project/log.php",
        "tls": "",
        "x": 422.7773628234863,
        "y": 719.4414205551147,
        "wires": [
            [
                "fe3ef29d.c82998"
            ]
        ]
    },
    {
        "id": "4e71a5c9.e274ec",
        "type": "function",
        "z": "af6617e3.50aa38",
        "name": "log_obj",
        "func": "var cloneObj = Object.assign({}, msg);\nmsg.payload = {\n    type    : \"Login API Flow\",\n    node    : \"verify screen: return menu page\",\n    msgObj  : cloneObj\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 976.0156860351562,
        "y": 943.5000038146973,
        "wires": [
            [
                "f9076bb9.bad468"
            ]
        ]
    },
    {
        "id": "f9076bb9.bad468",
        "type": "http request",
        "z": "af6617e3.50aa38",
        "name": "Log",
        "method": "POST",
        "ret": "obj",
        "url": "http://mastersoftwaretechnologies.com/roger_project/log.php",
        "tls": "",
        "x": 1114.0274238586426,
        "y": 942.941424369812,
        "wires": [
            [
                "f27ac629.e98548"
            ]
        ]
    },
    {
        "id": "d69c3893.3b6158",
        "type": "function",
        "z": "af6617e3.50aa38",
        "name": "log_obj",
        "func": "var cloneObj = Object.assign({}, msg);\nmsg.payload = {\n    type    : \"Login API Flow\",\n    node    : \"verify screen: return login page\",\n    msgObj  : cloneObj\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 650.765625,
        "y": 1049.5,
        "wires": [
            [
                "6d728e1e.5c5a6"
            ]
        ]
    },
    {
        "id": "6d728e1e.5c5a6",
        "type": "http request",
        "z": "af6617e3.50aa38",
        "name": "Log",
        "method": "POST",
        "ret": "obj",
        "url": "http://mastersoftwaretechnologies.com/roger_project/log.php",
        "tls": "",
        "x": 788.7773628234863,
        "y": 1048.9414205551147,
        "wires": [
            [
                "a387d87a.359278"
            ]
        ]
    },
    {
        "id": "36e56878.f61d38",
        "type": "function",
        "z": "af6617e3.50aa38",
        "name": "log_obj",
        "func": "var cloneObj = Object.assign({}, msg);\nmsg.payload = {\n    type    : \"Login API Flow\",\n    node    : \"verify screen: Error case response\",\n    msgObj  : cloneObj\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 904.515625,
        "y": 739.5,
        "wires": [
            [
                "f65ef2e4.abe69"
            ]
        ]
    },
    {
        "id": "f65ef2e4.abe69",
        "type": "http request",
        "z": "af6617e3.50aa38",
        "name": "Log",
        "method": "POST",
        "ret": "obj",
        "url": "http://mastersoftwaretechnologies.com/roger_project/log.php",
        "tls": "",
        "x": 1042.5273628234863,
        "y": 738.9414205551147,
        "wires": [
            [
                "9eae7e0f.71804"
            ]
        ]
    },
    {
        "id": "9eae7e0f.71804",
        "type": "debug",
        "z": "af6617e3.50aa38",
        "name": "Error log",
        "active": true,
        "console": "false",
        "complete": "payload",
        "x": 1188.515625,
        "y": 739.5,
        "wires": []
    }
]